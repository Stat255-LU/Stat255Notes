<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Building and Assessing Models – STAT 255 Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch6.html" rel="next">
<link href="./Ch4.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Ch5.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Building and Assessing Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">STAT 255 Notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Visualizing and Summarizing Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Statistical Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Simulation-Based Inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Inference from Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Building and Assessing Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Predictive Modeling</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-outcomes" id="toc-learning-outcomes" class="nav-link active" data-scroll-target="#learning-outcomes">Learning Outcomes</a></li>
  <li><a href="#checking-regression-assumptions" id="toc-checking-regression-assumptions" class="nav-link" data-scroll-target="#checking-regression-assumptions"><span class="header-section-number">5.1</span> Checking Regression Assumptions</a>
  <ul class="collapse">
  <li><a href="#checking-model-assumptions" id="toc-checking-model-assumptions" class="nav-link" data-scroll-target="#checking-model-assumptions"><span class="header-section-number">5.1.1</span> Checking Model Assumptions</a></li>
  <li><a href="#summary-of-checks-for-model-assumptions" id="toc-summary-of-checks-for-model-assumptions" class="nav-link" data-scroll-target="#summary-of-checks-for-model-assumptions"><span class="header-section-number">5.1.2</span> Summary of Checks for Model Assumptions</a></li>
  <li><a href="#example-n-v-s-lakes" id="toc-example-n-v-s-lakes" class="nav-link" data-scroll-target="#example-n-v-s-lakes"><span class="header-section-number">5.1.3</span> Example: N v S Lakes</a></li>
  <li><a href="#example-ph-model" id="toc-example-ph-model" class="nav-link" data-scroll-target="#example-ph-model"><span class="header-section-number">5.1.4</span> Example: pH Model</a></li>
  <li><a href="#example-house-prices" id="toc-example-house-prices" class="nav-link" data-scroll-target="#example-house-prices"><span class="header-section-number">5.1.5</span> Example: House Prices</a></li>
  <li><a href="#impact-of-model-assumption-violations" id="toc-impact-of-model-assumption-violations" class="nav-link" data-scroll-target="#impact-of-model-assumption-violations"><span class="header-section-number">5.1.6</span> Impact of Model Assumption Violations</a></li>
  </ul></li>
  <li><a href="#transformations" id="toc-transformations" class="nav-link" data-scroll-target="#transformations"><span class="header-section-number">5.2</span> Transformations</a>
  <ul class="collapse">
  <li><a href="#example-modeling-car-prices" id="toc-example-modeling-car-prices" class="nav-link" data-scroll-target="#example-modeling-car-prices"><span class="header-section-number">5.2.1</span> Example: Modeling Car Prices</a></li>
  <li><a href="#log-transformation" id="toc-log-transformation" class="nav-link" data-scroll-target="#log-transformation"><span class="header-section-number">5.2.2</span> Log Transformation</a></li>
  <li><a href="#inference-for-log-model" id="toc-inference-for-log-model" class="nav-link" data-scroll-target="#inference-for-log-model"><span class="header-section-number">5.2.3</span> Inference for Log Model</a></li>
  <li><a href="#log-model-interpretations" id="toc-log-model-interpretations" class="nav-link" data-scroll-target="#log-model-interpretations"><span class="header-section-number">5.2.4</span> Log Model Interpretations</a></li>
  <li><a href="#model-comparisons" id="toc-model-comparisons" class="nav-link" data-scroll-target="#model-comparisons"><span class="header-section-number">5.2.5</span> Model Comparisons</a></li>
  <li><a href="#log-model-visualization" id="toc-log-model-visualization" class="nav-link" data-scroll-target="#log-model-visualization"><span class="header-section-number">5.2.6</span> Log Model Visualization</a></li>
  <li><a href="#comments-on-transformations" id="toc-comments-on-transformations" class="nav-link" data-scroll-target="#comments-on-transformations"><span class="header-section-number">5.2.7</span> Comments on Transformations</a></li>
  </ul></li>
  <li><a href="#polynomial-regression" id="toc-polynomial-regression" class="nav-link" data-scroll-target="#polynomial-regression"><span class="header-section-number">5.3</span> Polynomial Regression</a></li>
  <li><a href="#models-with-interaction" id="toc-models-with-interaction" class="nav-link" data-scroll-target="#models-with-interaction"><span class="header-section-number">5.4</span> Models with Interaction</a>
  <ul class="collapse">
  <li><a href="#definition-of-interaction" id="toc-definition-of-interaction" class="nav-link" data-scroll-target="#definition-of-interaction"><span class="header-section-number">5.4.1</span> Definition of Interaction</a></li>
  <li><a href="#interaction-term" id="toc-interaction-term" class="nav-link" data-scroll-target="#interaction-term"><span class="header-section-number">5.4.2</span> Interaction Term</a></li>
  <li><a href="#interaction-models-in-r" id="toc-interaction-models-in-r" class="nav-link" data-scroll-target="#interaction-models-in-r"><span class="header-section-number">5.4.3</span> Interaction Models in R</a></li>
  <li><a href="#r2-for-interaction-model" id="toc-r2-for-interaction-model" class="nav-link" data-scroll-target="#r2-for-interaction-model"><span class="header-section-number">5.4.4</span> <span class="math inline">\(R^2\)</span> for Interaction Model</a></li>
  <li><a href="#considerations-for-using-interactions" id="toc-considerations-for-using-interactions" class="nav-link" data-scroll-target="#considerations-for-using-interactions"><span class="header-section-number">5.4.5</span> Considerations for Using Interactions</a></li>
  <li><a href="#interaction-vs-correlation" id="toc-interaction-vs-correlation" class="nav-link" data-scroll-target="#interaction-vs-correlation"><span class="header-section-number">5.4.6</span> Interaction vs Correlation</a></li>
  </ul></li>
  <li><a href="#building-models-for-interpretation" id="toc-building-models-for-interpretation" class="nav-link" data-scroll-target="#building-models-for-interpretation"><span class="header-section-number">5.5</span> Building Models for Interpretation</a>
  <ul class="collapse">
  <li><a href="#modeling-sat-scores" id="toc-modeling-sat-scores" class="nav-link" data-scroll-target="#modeling-sat-scores"><span class="header-section-number">5.5.1</span> Modeling SAT Scores</a></li>
  <li><a href="#modeling-car-price" id="toc-modeling-car-price" class="nav-link" data-scroll-target="#modeling-car-price"><span class="header-section-number">5.5.2</span> Modeling Car Price</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Building and Assessing Models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="learning-outcomes" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="learning-outcomes">Learning Outcomes</h3>
<p><strong>Conceptual Learning Outcomes</strong><br>
24. State the assumptions of the normal error regression model and check their validity using residual plots, qq plots, and other information.<br>
25. Interpret regression coefficients in models involving log transformations.<br>
26. Calculate predicted values for models involving log transformations.<br>
27. Interpret regression coefficient estimates on models with interaction terms.<br>
28. Calculate predicted values for models with interaction terms.<br>
29. Draw conclusions about models involving polynomial terms and interactions based on graphical representations of data. 31. Identify instances of confounding and Simpson’s paradox and draw conclusions in these situations.<br>
30. Explain how multicollinearity impacts predictions and confidence/prediction intervals.<br>
31. Determine whether it is appropriate to add terms to a model using information such as <span class="math inline">\(R^2\)</span>, F-statistic, residual plots, correlation, and other visual representations.</p>
<p><strong>Computational Learning Outcomes</strong><br>
I. Build regression models involving nonlinear terms and interactions in R.</p>
</section>
<section id="checking-regression-assumptions" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="checking-regression-assumptions"><span class="header-section-number">5.1</span> Checking Regression Assumptions</h2>
<p>We’ve seen that tests and intervals based on the normal error regression model depend on four assumptions. If these assumptions are not reasonable then the tests and intervals may not be reliable.</p>
<p>The statement <span class="math inline">\(Y_i = \beta_0 + \beta_1X_{i1}+ \ldots + \beta_pX_{ip} + \epsilon_i\)</span>, with <span class="math inline">\(\epsilon_i\sim\mathcal{N}(0,\sigma)\)</span> implies the following:</p>
<ol type="1">
<li><p>Linearity: the expected value of <span class="math inline">\(Y\)</span> is a linear function of <span class="math inline">\(X_1, X_2, \ldots, X_p\)</span>. (This assumption is only relevant for models including at least one quantitative explanatory variable.)</p></li>
<li><p>Normality: Given the values of <span class="math inline">\(X_1, X_2, \ldots, X_p\)</span>, <span class="math inline">\(Y\)</span> follows a normal distribution.</p></li>
<li><p>Constant Variance: Regardless of the values of <span class="math inline">\(X_1, X_2, \ldots, X_p\)</span>, the variance (or standard deviation) in the normal distribution for <span class="math inline">\(Y\)</span> is the same.</p></li>
<li><p>Independence: The response value for each observation is not affected by any of the other observations (expect due to explanatory variables included in the model).</p></li>
</ol>
<p><strong>Illustration of Model Assumptions</strong></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLR_Model_Assumptions.png" class="img-fluid figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p>We know that these assumptions held true in the ice cream example, because we generated the data in a way that was consistent with these.</p>
<p>In practice, we will have only the data, without knowing the exact mechanism that produced it. We should only rely on the t-distribution based p-values and confidence intervals in the R output if these appear to be reasonable assumptions.</p>
<p>Of course, these assumptions will almost never be truly satisfied, but they should at least be a reasonable approximation if we are to draw meaningful conclusions.</p>
<section id="checking-model-assumptions" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="checking-model-assumptions"><span class="header-section-number">5.1.1</span> Checking Model Assumptions</h3>
<p>The following plots are useful when assessing the appropriateness of the normal error regression model.</p>
<ol type="1">
<li><p>Scatterplot of residuals against predicted values</p></li>
<li><p>Histogram of standardized residuals</p>
<ul>
<li>heavy skewness indicates a problem with normality assumption</li>
</ul></li>
<li><p>Normal quantile plot</p>
<ul>
<li>severe departures from diagonal line indicate problem with normality assumption</li>
</ul></li>
</ol>
<p><strong>Residual vs Predicted Plots</strong></p>
<p>A residual vs predicted plot is useful for detecting issues with the linearity or constant variance assumption.</p>
<ul>
<li>curvature indicates a problem with linearity assumption<br>
</li>
<li>“funnel” or “megaphone” shape indicates problem with constant variance assumption</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Violations, <span class="fu">aes</span>(<span class="at">y=</span>no_viol_Model<span class="sc">$</span>residuals, <span class="at">x=</span>no_viol_Model<span class="sc">$</span>fitted.values)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"No Violation"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Predicted Values"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Violations, <span class="fu">aes</span>(<span class="at">y=</span>lin_viol_Model<span class="sc">$</span>residuals, <span class="at">x=</span>no_viol_Model<span class="sc">$</span>fitted.values)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Violation of Linearity Assumption"</span>)<span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Predicted Values"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Violations, <span class="fu">aes</span>(<span class="at">y=</span>cvar_viol_Model<span class="sc">$</span>residuals, <span class="at">x=</span>no_viol_Model<span class="sc">$</span>fitted.values)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Violation of Constant Variance Assumption"</span>)<span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Predicted Values"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, P3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>If there is only one explanatory variable, plotting the residuals against that variable reveals the same information as a residual vs predicted plot.</p>
<p><strong>Histogram of Residuals</strong></p>
<p>A histogram of the residuals is useful for assessing the normality assumption.</p>
<ul>
<li>Severe skewness indicates violation of normality assumption</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Violations, <span class="fu">aes</span>(<span class="at">x=</span>no_viol_Model<span class="sc">$</span>residuals)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"No Violation"</span>) <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">"Residual"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Violations, <span class="fu">aes</span>(<span class="at">x=</span>norm_viol_Model<span class="sc">$</span>residuals)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Violation of Normality Assumption"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Residual"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p><strong>Normal Quantile-Quantile (QQ) Plot</strong></p>
<p>Sometimes histograms can be inconclusive, especially when sample size is smaller.</p>
<p>A Normal quantile-quantile plot displays quantiles of the residuals against the expected quantiles of a normal distribution.</p>
<ul>
<li>Severe departures from diagonal line indicate a problem with normality assumption.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Violations, <span class="fu">aes</span>(<span class="at">sample =</span> <span class="fu">scale</span>(no_viol_Model<span class="sc">$</span>residuals))) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Normal Quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residual Quantiles"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"No Violation"</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Violations, <span class="fu">aes</span>(<span class="at">sample =</span> <span class="fu">scale</span>(norm_viol_Model<span class="sc">$</span>residuals))) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Normal Quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residual Quantiles"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Violation of Normality Assumption"</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p><strong>Checking Model Assumptions - Independence</strong></p>
<p>Independence is often difficult to assess through plots of data, but it is important to think about whether there were factors in the data collection that would cause some observations to be more highly correlated than others.</p>
<p>For example:</p>
<ol type="1">
<li>People in the study who are related.<br>
</li>
<li>Some plants grown in the same greenhouse and others in different greenhouses.<br>
</li>
<li>Some observations taken in same time period and others at different times.</li>
</ol>
<p>All of these require more complicated models that account for correlation using spatial and time structure.</p>
</section>
<section id="summary-of-checks-for-model-assumptions" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="summary-of-checks-for-model-assumptions"><span class="header-section-number">5.1.2</span> Summary of Checks for Model Assumptions</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Model assumption</th>
<th>How to detect violation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Linearity</td>
<td>Curvature in residual plot</td>
</tr>
<tr class="even">
<td>Constant Variance</td>
<td>Funnel shape in residual plot</td>
</tr>
<tr class="odd">
<td>Normality</td>
<td>Skewness in histogram of residuals or departure from diag. line in QQ plot</td>
</tr>
<tr class="even">
<td>Independence</td>
<td>No graphical check, carefully examine data collection</td>
</tr>
</tbody>
</table>
</section>
<section id="example-n-v-s-lakes" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="example-n-v-s-lakes"><span class="header-section-number">5.1.3</span> Example: N v S Lakes</h3>
<p>Recall our sample of 53 Florida Lakes, 33 in the north, and 20 in the south.</p>
<p><span class="math inline">\(\text{Mercury}_i = \beta_0 + \beta_1\times{\text{South}_i} + \epsilon_i\)</span>, where <span class="math inline">\(\epsilon_i\sim\mathcal{N}(0, \sigma)\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>LakesBP</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>When we use the normal error regression model, we are assuming the following:</p>
<ol type="1">
<li><p>Linearity: there is an expected mercury concentration for lakes in North Florida, and another for lakes in South Florida.</p></li>
<li><p>Normality: mercury concentrations of individual lakes in the north are normally distributed, and so are mercury concentrations in the south. These normal distributions might have different means.</p></li>
<li><p>Constant Variance: the normal distribution for mercury concentrations in North Florida has the same standard deviation as the normal distribution for mercury concentrations in South Florida</p></li>
<li><p>Independence: no two lakes are any more alike than any others, except for being in the north or south, which we account for in the model. We might have concerns about this, do to some lakes being geographically closer to each other than others.</p></li>
</ol>
<p>We should only use the p-values and confidence intervals provided by R, which depend on the t-distribution approximation, if we believe these assumptions are reasonable.</p>
<p>A residual by predicted plot, histogram of residuals, and normal quantile-quantile plot are shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>FloridaLakes, <span class="fu">aes</span>(<span class="at">y=</span>M_Lakes_merc_loc<span class="sc">$</span>residuals, <span class="at">x=</span>M_Lakes_merc_loc<span class="sc">$</span>fitted.values)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual vs Predicted Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Predicted Values"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>FloridaLakes, <span class="fu">aes</span>(<span class="at">x=</span>M_Lakes_merc_loc<span class="sc">$</span>residuals)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Histogram of Residuals"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Residual"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>FloridaLakes, <span class="fu">aes</span>(<span class="at">sample =</span> <span class="fu">scale</span>(M_Lakes_merc_loc<span class="sc">$</span>residuals))) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Normal Quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residual Quantiles"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Normal QQ Plot"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, P3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Notice that we see two lines of predicted values and residuals. This makes sense since all lakes in North Florida will have the same predicted value, as will all lakes in Southern Florida.</p>
<p>There appears to be a little more variability in residuals for Southern Florida (on the right), than Northern Florida, causing some concern about the constant variance assumption.</p>
<p>Overall, though, the assumptions seem mostly reasonable.</p>
<p>We shouldn’t be concerned about using theory-based hypothesis tests or confidence intervals for the mean mercury level or difference in mean mercury levels. There might be some concern that prediction intervals could be either too wide or too narrow, but this is not a major concern, since the constant variance assumption is not severe.</p>
</section>
<section id="example-ph-model" class="level3" data-number="5.1.4">
<h3 data-number="5.1.4" class="anchored" data-anchor-id="example-ph-model"><span class="header-section-number">5.1.4</span> Example: pH Model</h3>
<p>Recall the regression line estimating the relationship between a lake’s mercury level and pH.</p>
<p><span class="math inline">\(\text{Mercury}_i = \beta_0 + \beta_1\times\text{pH}_i + \epsilon_i\)</span>, where <span class="math inline">\(\epsilon_i\sim\mathcal{N}(0, \sigma)\)</span>.</p>
<p>The model assumes:</p>
<ol type="1">
<li><p>Linearity: the expected mercury level of a lake is a linear function of pH.</p></li>
<li><p>Normality: for any given pH, the mercury levels of lakes with that pH follow a normal distribution. For example, mercury levels for lakes with pH of 6 is are normally distributed, and mercury levels for lakes with pH of 9 are normally distributed, though these normal distributions may have different means.</p></li>
<li><p>Constant Variance: the variance (or standard deviation) in the normal distribution for mercury level is the same for each pH. For example, there is the same amount of variability associated with lakes with pH level 6, as pH level 8.</p></li>
<li><p>Independence: no two lakes are any more alike than any others, except with respect to pH, which is accounted for in the model. This may not be a reasonable assumption, but it’s unclear what the effects of such a violation would be.</p></li>
</ol>
<p>We should only use the p-values and confidence intervals provided by R, which depend on the t-distribution approximation, if we believe these assumptions are reasonable.</p>
<p>The plots for checking these assumptions are shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>FloridaLakes, <span class="fu">aes</span>(<span class="at">y=</span>M_pH<span class="sc">$</span>residuals, <span class="at">x=</span>M_pH<span class="sc">$</span>fitted.values)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual vs Predicted Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Predicted Values"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>FloridaLakes, <span class="fu">aes</span>(<span class="at">x=</span>M_pH<span class="sc">$</span>residuals)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Histogram of Residuals"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Residual"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>FloridaLakes, <span class="fu">aes</span>(<span class="at">sample =</span> <span class="fu">scale</span>(M_pH<span class="sc">$</span>residuals))) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Normal Quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residual Quantiles"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Normal QQ Plot"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, P3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The residual vs predicted plot does not show any linear trend, and variability appears to be about the same for low predicted values as for high ones. Thus, the linearity and constant variance assumptions appear reasonable.</p>
<p>The histogram shows some right-skewness, and the right-most points on the normal-qq plot are above the line, indicating a possible concern with the normality assumption. There is some evidence of right-skewness, which might impact the appropriatness of the normal error regression model.</p>
<p>Nevertheless, we obtained similar results using the simulation-based results as the normal error regression model, suggesting that the concern about normality did not have much impact on the estimation of <span class="math inline">\(\beta_1\)</span>. It is possible that this concern could have implications for other kinds of inference, such as confidence intervals for an expected response, and prediction intervals, which we’ll explore later in the chapter.</p>
</section>
<section id="example-house-prices" class="level3" data-number="5.1.5">
<h3 data-number="5.1.5" class="anchored" data-anchor-id="example-house-prices"><span class="header-section-number">5.1.5</span> Example: House Prices</h3>
<p>Recall the model for estimating price of a house, using size, waterfront status, and an interaction term.</p>
<p><span class="math inline">\(\text{Price}_i = \beta_0 + \beta_1\text{Sq.Ft.}_{i}+ \beta_2\text{Waterfront}_{i}+ \beta_3\times\text{Sq.Ft.}_i\times\text{Waterfront}_{i} + \epsilon_i\)</span>, where <span class="math inline">\(\epsilon_i\sim\mathcal{N}(0,\sigma)\)</span>.</p>
<p>The model assumes:</p>
<ol type="1">
<li><p>Linearity: the expected price of a house is a linear function of its size. The slope and intercept of this function may be different for houses on the waterfront, compared to houses not on the waterfront.</p></li>
<li><p>Normality: prices of houses of a given size and waterfront status are normally distributed.</p></li>
<li><p>Constant Variance: the variance (or standard deviation) in the normal distribution for prices is the same for all sizes and waterfront statuses.</p></li>
<li><p>Independence: no two houses are any more alike than any others, except with respect to size and waterfront status.</p></li>
</ol>
<p>We should only use the p-values and confidence intervals provided by R, which depend on the t-distribution approximation, if we believe these assumptions are reasonable.</p>
<p>Several reasons come to mind that might cause us to doubt the validity of these assumptions, but let’s investigate them emperically, using our data on 100 houses.</p>
<p>The plots for checking these assumptions are shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Houses, <span class="fu">aes</span>(<span class="at">y=</span>M_House_Int<span class="sc">$</span>residuals, <span class="at">x=</span>M_House_Int<span class="sc">$</span>fitted.values)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual vs Predicted Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Predicted Values"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Houses, <span class="fu">aes</span>(<span class="at">x=</span>M_House_Int<span class="sc">$</span>residuals)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Histogram of Residuals"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Residual"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Houses, <span class="fu">aes</span>(<span class="at">sample =</span> <span class="fu">scale</span>(M_House_Int<span class="sc">$</span>residuals))) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Normal Quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residual Quantiles"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Normal QQ Plot"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, P3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Although we might have had some initial concerns about the model assumptions, the plots do not raise any serious concerns. There is no sign of a nonlinear relationship in the residual vs predicted plot, so the linearity assumption appears reasonable.</p>
<p>There is possibly more variability associated with prices or more expensive houses than less expensive ones, so we might have some concerns about constant variance, but since there are only a few very high-priced houses, and the increasing variance is not too severe, this may not be much of a concern.</p>
<p>There are a few houses on each end of the normal qq plot that deviate from their expected line, but not very many. It’s not uncommon to have a few points deviate from the line on the end, so we do not have severe concerns about normality. The histogram of residuals is roughly symmetric.</p>
<p>Thus, the normal error regression model appears to be reasonable for these data.</p>
</section>
<section id="impact-of-model-assumption-violations" class="level3" data-number="5.1.6">
<h3 data-number="5.1.6" class="anchored" data-anchor-id="impact-of-model-assumption-violations"><span class="header-section-number">5.1.6</span> Impact of Model Assumption Violations</h3>
<p>In this chapter, we’ve studied the normal error regression model and its underlying assumptions. We’ve seen that when these assumptions are realistic, we can use distributions derived from probability theory, such as t and F distributions to approximate sampling distributions, in place of the simulation-based methods seen in Chapters 3 and 4.</p>
<p>Of course, real data don’t come exactly from processes like the fictional ice cream dispenser described in Section 5.1, so it’s really a question of whether this model is a realistic approximation (or simplification) of the true mechanism that led to the data we observe. We can use diagnostics like residual and Normal-QQ plots, as well as our intuition and background knowledge to assess whether the normal error regression model is a reasonable approximation.</p>
<p>The p-values provided by the <code>lm</code> summary output, and <code>anova</code> commands, and the and intervals produced by the <code>confint</code>, and <code>predict</code> command, as well as many other R commands, depend on the assumptions of the normal error regression model, and should only be used when these assumptions are reasonable.</p>
<p>In situations where some model assumptions appear to be violated, we might be okay using certain tests/intervals, but not others. In general, we should proceed with caution in these situations.</p>
<p>The table below provides guidance on the potential impact of model assumption violation on predicted values, confidence intervals, and prediction intervals.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Model assumption Violated</th>
<th>Predicted Values</th>
<th>Confidence Intervals</th>
<th>Prediction Intervals</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Linearity</td>
<td>Unreliable</td>
<td>Unreliable</td>
<td>Unreliable</td>
</tr>
<tr class="even">
<td>Constant Variance</td>
<td>Reliable</td>
<td>Somewhat unreliable - Some too wide, others too narrow</td>
<td>Very unreliable - Some too wide, others too narrow</td>
</tr>
<tr class="odd">
<td>Normality</td>
<td>Reliable</td>
<td>Possibly unreliable - might be symmetric when they shouldn’t be. Might be okay when skewness isn’t bad and sample size is large.</td>
<td>Very unreliable - will be symmetric when they shouldn’t be</td>
</tr>
<tr class="even">
<td>Independence</td>
<td>might be reliable</td>
<td>unreliable - either too wide or too narrow</td>
<td>unreliable - either too wide or too narrow</td>
</tr>
</tbody>
</table>
<p>When model assumptions are a concern, consider a using a transformation of the data, a more advanced model, or a more flexible technique, such as a nonparametric approach or statistical machine learning algorithm.</p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="transformations" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="transformations"><span class="header-section-number">5.2</span> Transformations</h2>
<p>When there are violations of model assumptions, we can sometimes correct for these by modeling a a function of the response variable, rather than the response variable itself. When the histogram of residuals and normal qq plot show signs of right-skewness, modeling <span class="math inline">\(log(Y)\)</span> is often helpful.</p>
<section id="example-modeling-car-prices" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="example-modeling-car-prices"><span class="header-section-number">5.2.1</span> Example: Modeling Car Prices</h3>
<p>We’ll look at the assumptions associated with the model for predicting car price, using acceleration time as the explanatory variable.</p>
<p>Diagnostic plots are shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Cars2015, <span class="fu">aes</span>(<span class="at">y=</span>Cars_M_A060<span class="sc">$</span>residuals, <span class="at">x=</span>Cars_M_A060<span class="sc">$</span>fitted.values)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Predicted Values"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Cars2015, <span class="fu">aes</span>(<span class="at">x=</span>Cars_M_A060<span class="sc">$</span>residuals)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Histogram of Residuals"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Residual"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Cars2015, <span class="fu">aes</span>(<span class="at">sample =</span> <span class="fu">scale</span>(Cars_M_A060<span class="sc">$</span>residuals))) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Normal Quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residual Quantiles"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Normal QQ Plot"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, P3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>There is a funnel-shape in the residual plot, indicating a concern about the constant variance assumption. There appears to be more variability in prices for more expensive cars than for cheaper cars. There is also some concern about the normality assumption, as the histogram and QQ plot indicate right-skew in the residuals.</p>
</section>
<section id="log-transformation" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="log-transformation"><span class="header-section-number">5.2.2</span> Log Transformation</h3>
<p>When residual plots yield model inadequacy, we might try to correct these by applying a transformation to the response variable.</p>
<p>When working a nonnegative, right-skewed response variable, it is often helpful to work with the logarithm of the response variable.</p>
<p>Note: In R, <code>log()</code> denotes the natural (base e) logarithm, often denoted <code>ln()</code>. We can actually use any logarithm, but the natural logarithm is commonly used.</p>
<p>We’ll use the model:</p>
<p><span class="math display">\[
\text{Log Price} = \beta_0 + \beta_1\times \text{Acc060} + \epsilon_i , \text{ where } \epsilon_i\sim\mathcal{N}(0, \sigma)
\]</span></p>
<p>The plot shows log(price) on the y-axis. We see that the relationship appears more linear than when we plot price itself.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Cars2015, <span class="fu">aes</span>(<span class="at">x=</span>Acc060, <span class="at">y=</span><span class="fu">log</span>(Price))) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Acceleration Time"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Log of Price"</span>) <span class="sc">+</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Acceleration Time and Log Price"</span>) <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Log Transformation Model - What We’re Assuming</strong></p>
<ol type="1">
<li><p>Linearity: the log of expected price of a car is a linear function of its acceleration time.</p></li>
<li><p>Normality: for any given acceleration time, the log of prices of actual cars follow a normal distribution.</p></li>
<li><p>Constant Variance: the normal distribution for log of price is the same for all acceleration times.</p></li>
<li><p>Independence: no two cars are any more alike than any others.</p></li>
</ol>
<p>We should only use the p-values and confidence intervals provided by R, which depend on the t-distribution approximation, if we believe these assumptions are reasonable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Cars_M_Log <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Cars2015, <span class="fu">log</span>(Price)<span class="sc">~</span>Acc060)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cars_M_Log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(Price) ~ Acc060, data = Cars2015)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.84587 -0.19396  0.00908  0.18615  0.53350 

Coefficients:
            Estimate Std. Error t value            Pr(&gt;|t|)    
(Intercept)  5.13682    0.13021   39.45 &lt;0.0000000000000002 ***
Acc060      -0.22064    0.01607  -13.73 &lt;0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.276 on 108 degrees of freedom
Multiple R-squared:  0.6359,    Adjusted R-squared:  0.6325 
F-statistic: 188.6 on 1 and 108 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p><strong>Assumption Check for Model on Log Price</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Cars2015, <span class="fu">aes</span>(<span class="at">y=</span>Cars_M_Log<span class="sc">$</span>residuals, <span class="at">x=</span>Cars_M_Log<span class="sc">$</span>fitted.values)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Cars Log Model Residual Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Predicted Values"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Cars2015, <span class="fu">aes</span>(<span class="at">x=</span>Cars_M_Log<span class="sc">$</span>residuals)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Histogram of Residuals"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Residual"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Cars2015, <span class="fu">aes</span>(<span class="at">sample =</span> <span class="fu">scale</span>(Cars_M_Log<span class="sc">$</span>residuals))) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Normal Quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residual Quantiles"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Cars Model QQ Plot"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, P3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>There is still some concern about constant variance, though perhaps not as much. The normality assumption appears more reasonable.</p>
</section>
<section id="inference-for-log-model" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="inference-for-log-model"><span class="header-section-number">5.2.3</span> Inference for Log Model</h3>
<p>R output for the model is shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>Cars_M_Log <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Cars2015, <span class="fu">log</span>(Price)<span class="sc">~</span>Acc060)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cars_M_Log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(Price) ~ Acc060, data = Cars2015)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.84587 -0.19396  0.00908  0.18615  0.53350 

Coefficients:
            Estimate Std. Error t value            Pr(&gt;|t|)    
(Intercept)  5.13682    0.13021   39.45 &lt;0.0000000000000002 ***
Acc060      -0.22064    0.01607  -13.73 &lt;0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.276 on 108 degrees of freedom
Multiple R-squared:  0.6359,    Adjusted R-squared:  0.6325 
F-statistic: 188.6 on 1 and 108 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>Prediction Equation:</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{\text{Price}} &amp; = e^{5.13582-0.22064 \times \text{Acc060}}
\end{aligned}
\]</span></p>
<p>Predicted price for car that takes 7 seconds to accelerate:</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{\text{Price}} &amp; = e^{5.13582-0.22064 \times \text{7}} = 36.3
\end{aligned}
\]</span></p>
<p>Predicted price for car that takes 10 seconds to accelerate:</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{\text{Price}} &amp; = e^{5.13582-0.22064 \times \text{10}}= 18.7
\end{aligned}
\]</span></p>
<p>Predictions are for log(Price), so we need to exponentiate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(Cars_M_Log, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">Acc060=</span><span class="fu">c</span>(<span class="dv">7</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
3.592343 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">predict</span>(Cars_M_Log, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">Acc060=</span><span class="fu">c</span>(<span class="dv">7</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
36.31908 </code></pre>
</div>
</div>
<p>A car that accelerates from 0 to 60 mph in 7 seconds is expected to cost 36.3 thousand dollars.</p>
</section>
<section id="log-model-interpretations" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="log-model-interpretations"><span class="header-section-number">5.2.4</span> Log Model Interpretations</h3>
<p><span class="math display">\[
\begin{aligned}
\text{Log of Expected Price} &amp; = \beta_0 + \beta_1\times \text{Acc060}\  \text{, Thus:} \\
\text{ Expected Price} &amp; = e^{\beta_0 + \beta_1\times \text{Acc060} } \\
&amp; e^{\beta_0}e^{\beta_1 \times \text{Acc060}} \\
&amp; e^{\beta_0}(e^{\beta_1})^\text{Acc060}
\end{aligned}
\]</span></p>
<ul>
<li><p><span class="math inline">\(e^{\beta_0}\)</span> is theoretically the expected price of a car that can accelerate from 0 to 60 mph in no time, but this is not a meaningful interpretation.</p></li>
<li><p>For each additional second it takes a car to accelerate, price is expected to multiply by a factor of <span class="math inline">\(e^{b_1}\)</span>.</p></li>
</ul>
<p>Exponentiating the model coefficients gives:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(Cars_M_Log<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)      Acc060 
170.1730148   0.8020062 </code></pre>
</div>
</div>
<ul>
<li>For each additional second in acceleration time, price is expected to multiply by a a factor of <span class="math inline">\(e^{-0.22} = 0.80\)</span>. Thus, each 1-second increase in acceleration time is estimated to be associated with a 20% drop in price, on average.</li>
</ul>
<p><strong>Confidence Intervals for</strong> <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(Cars_M_Log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %     97.5 %
(Intercept)  4.8787105  5.3949208
Acc060      -0.2524862 -0.1887916</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(Cars_M_Log))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  2.5 %     97.5 %
(Intercept) 131.4610408 220.284693
Acc060        0.7768669   0.827959</code></pre>
</div>
</div>
<ul>
<li>We are 95% confident that the price of a car changes, on average, by multiplicative factor between <span class="math inline">\(e^{-0.252} = 0.7773\)</span> and <span class="math inline">\(e^{-0.189}=0.828\)</span> for each additional second in acceleration time. That is, we believe the price decreases between 17% and 23% on average for each additional second in acceleration time.</li>
</ul>
<p><strong>Log Model CI for Expected Response</strong></p>
<p>If we just use the <code>predict</code> function, we get a confidence interval for <code>log(price)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(Cars_M_Log, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">Acc060=</span><span class="fu">c</span>(<span class="dv">7</span>)), <span class="at">interval=</span><span class="st">"confidence"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit     lwr      upr
1 3.592343 3.53225 3.652436</code></pre>
</div>
</div>
<p>To get an interval for price itself, we exponentiate, using <code>exp</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">predict</span>(Cars_M_Log, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">Acc060=</span><span class="fu">c</span>(<span class="dv">7</span>)), <span class="at">interval=</span><span class="st">"confidence"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 36.31908 34.20083 38.56852</code></pre>
</div>
</div>
<p>We are 95% confident that the mean price amoung all cars that accelerate from 0 to 60 mph in 7 seconds is between <span class="math inline">\(e^{3.53225} =34.2\)</span> and <span class="math inline">\(e^{3.652436}=38.6\)</span> thousand dollars.</p>
<p><strong>Log Model Prediction Interval</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(Cars_M_Log, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">Acc060=</span><span class="fu">c</span>(<span class="dv">7</span>)), <span class="at">interval=</span><span class="st">"prediction"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 3.592343 3.042041 4.142645</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">predict</span>(Cars_M_Log, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">Acc060=</span><span class="fu">c</span>(<span class="dv">7</span>)), <span class="at">interval=</span><span class="st">"prediction"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 36.31908 20.94796 62.96917</code></pre>
</div>
</div>
<p>We are 95% confident that the expected price for a car that accelerates from 0 to 60 mph in 7 seconds is between <span class="math inline">\(e^{3.04} =20.9\)</span> and <span class="math inline">\(e^{4.14}=63.9\)</span> thousand dollars.</p>
</section>
<section id="model-comparisons" class="level3" data-number="5.2.5">
<h3 data-number="5.2.5" class="anchored" data-anchor-id="model-comparisons"><span class="header-section-number">5.2.5</span> Model Comparisons</h3>
<p>We’ll compare the intervals we obtain using the <code>log</code> transformation to those from the model without the transformation.</p>
<p><strong>95% Confidence interval for average price of cars that take 7 seconds to accelerate:</strong></p>
<p>Original Model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(Cars_M_A060, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">Acc060=</span><span class="dv">7</span>), <span class="at">interval=</span><span class="st">"confidence"</span>, <span class="at">level=</span><span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      fit      lwr      upr
1 39.5502 37.21856 41.88184</code></pre>
</div>
</div>
<p>Transformed Model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">predict</span>(Cars_M_Log, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">Acc060=</span><span class="fu">c</span>(<span class="dv">7</span>)), <span class="at">interval=</span><span class="st">"confidence"</span>, <span class="at">level=</span><span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 36.31908 34.20083 38.56852</code></pre>
</div>
</div>
<p><strong>95% Prediction interval for price of an individual car that takes 7 seconds to accelerate:</strong></p>
<p>Original Model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(Cars_M_A060, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">Acc060=</span><span class="dv">7</span>), <span class="at">interval=</span><span class="st">"prediction"</span>, <span class="at">level=</span><span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      fit      lwr      upr
1 39.5502 18.19826 60.90215</code></pre>
</div>
</div>
<p>Transformed Model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">predict</span>(Cars_M_Log, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">Acc060=</span><span class="fu">c</span>(<span class="dv">7</span>)), <span class="at">interval=</span><span class="st">"prediction"</span>, <span class="at">level=</span><span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 36.31908 20.94796 62.96917</code></pre>
</div>
</div>
<p>Notice that the transformed interval is not symmetric and allows for a longer “tail” on the right than the left.</p>
</section>
<section id="log-model-visualization" class="level3" data-number="5.2.6">
<h3 data-number="5.2.6" class="anchored" data-anchor-id="log-model-visualization"><span class="header-section-number">5.2.6</span> Log Model Visualization</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The log model suggests an nonlinear trend in price with respect to acceleration time and gives wider confidence and prediction intervals for cars that accelerate faster and tend to be more expensive. It also gives non-symmetric intervals. These results appear to be consistent with the observed data.</p>
</section>
<section id="comments-on-transformations" class="level3" data-number="5.2.7">
<h3 data-number="5.2.7" class="anchored" data-anchor-id="comments-on-transformations"><span class="header-section-number">5.2.7</span> Comments on Transformations</h3>
<ul>
<li><p>We could have used another transformation, such as <span class="math inline">\(\sqrt{\text{Price}}\)</span></p></li>
<li><p>The log tranform leads to a nice interpretation involving percent change. Other transformations might yield better predictions, but are often hard to interpret.</p></li>
<li><p>There is often a tradeoff between model complexity and interpretability. We’ll talk more about this.</p></li>
<li><p>We did an example of a transformation in a model with a single explanatory variable.</p></li>
<li><p>If the explanatory variable is categorical:<br>
</p>
<ul>
<li><span class="math inline">\(e^{\beta_0}\)</span> represents the expected response in the baseline category<br>
</li>
<li><span class="math inline">\(e^{\beta_j}\)</span> represents the number of times larger the expected response in category <span class="math inline">\(j\)</span> is, compared to the baseline category.</li>
</ul></li>
<li><p>When working with multiple regression models, it is still important to mention holding other variables constant when interpreting parameters associated with one of the variables.</p></li>
</ul>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="polynomial-regression" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="polynomial-regression"><span class="header-section-number">5.3</span> Polynomial Regression</h2>
</section>
<section id="models-with-interaction" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="models-with-interaction"><span class="header-section-number">5.4</span> Models with Interaction</h2>
<section id="definition-of-interaction" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="definition-of-interaction"><span class="header-section-number">5.4.1</span> Definition of Interaction</h3>
<p>We previously used a multiple regression model of the form</p>
<p><span class="math display">\[
\widehat{Price} = b_0 + b_1\times\text{SqFt} + b_2\times\text{Waterfront}
\]</span></p>
<p>Recall that this model assumes the slope relating price and square footage is the same (<span class="math inline">\(b_1\)</span>) for houses on the waterfront as for houses not on the waterfront. An illustration of the model is shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>Plot_House_price_sqft_wf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This assumption of the rate of change in price with respect to living space being the same for waterfront houses, as for non-waterfront houses might be unrealistic.</p>
<p>Let’s fit separate lines waterfront and non-waterfront houses, without requiring them to have the same slope.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Houses, <span class="fu">aes</span>(<span class="at">x=</span>sqft_living, <span class="at">y=</span>price, <span class="at">color=</span>waterfront)) <span class="sc">+</span> <span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>)) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It appears that the prices of the houses on the waterfront are increasing more rapidly, with respect to square feet of living space, than the non-waterfront houses. The effect of additional square feet on the price of the house appears to depend on whether or not the house is on the waterfront. This is an example of an <strong>interaction</strong> between square footage and waterfront status.</p>
<p>An <strong>interaction</strong> between two explanatory variables occurs when the effect of one explanatory variable on the response depends on the other explanatory variable.</p>
</section>
<section id="interaction-term" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="interaction-term"><span class="header-section-number">5.4.2</span> Interaction Term</h3>
<p>If we want to allow for different slopes between waterfront and non-waterfront houses, we’ll need to change the mathematical equation of our model. To do that, we’ll add a coefficient <span class="math inline">\(b_3\)</span>, multiplied by the product of our two explanatory variables.</p>
<p>The model equation is</p>
<p><span class="math display">\[
\widehat{Price} = b_0 + b_1\times\text{Sq. Ft.} + b_2\times\text{waterfront} + b_3\times\text{Sq.Ft}\times\text{Waterfront}
\]</span></p>
<p>The last term is called an <strong>interaction term.</strong></p>
<p>For a house on the waterfront (<span class="math inline">\(\text{waterfront}=1\)</span>), the equation relating price to square feet is</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{Price} &amp; = b_0 + b_1\times\text{Sq. Ft.} + b_2\times\text{1} + b_3\times\text{Sq.Ft}\times\text{1} \\
&amp; = (b_0+b_2) + (b_1+b_3)\times{\text{Sq. Ft.}}
\end{aligned}
\]</span> For a house not on the waterfront (<span class="math inline">\(\text{waterfront}=0\)</span>), the equation relating price to square feet is</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{Price} &amp; = b_0 + b_1\times\text{Sq. Ft.} + b_2\times\text{0} + b_3\times\text{Sq.Ft}\times\text{0} \\
&amp; = b_0 + b_1\times{\text{Sq. Ft}}
\end{aligned}
\]</span></p>
<p>The intercept is <span class="math inline">\(b_0\)</span> for non-waterfront houses, and <span class="math inline">\(b_0 + b_2\)</span> for waterfront houses.</p>
<p>The slope is <span class="math inline">\(b_1\)</span> for non-waterfront houses, and <span class="math inline">\(b_1 + b_3\)</span> for waterfront houses.</p>
<p>Thus, the model allows both the slope and intercept to differ between waterfront and non-waterfront houses.</p>
</section>
<section id="interaction-models-in-r" class="level3" data-number="5.4.3">
<h3 data-number="5.4.3" class="anchored" data-anchor-id="interaction-models-in-r"><span class="header-section-number">5.4.3</span> Interaction Models in R</h3>
<p>To fit an interaction model in R, use <code>*</code> instead of <code>+</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>M_House_Int <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Houses, price<span class="sc">~</span>sqft_living<span class="sc">*</span>waterfront)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>M_House_Int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ sqft_living * waterfront, data = Houses)

Coefficients:
              (Intercept)                sqft_living  
                -114.3735                     0.3099  
            waterfrontYes  sqft_living:waterfrontYes  
                 -90.1153                     0.2729  </code></pre>
</div>
</div>
<p>The regression equation is</p>
<p><span class="math display">\[
\widehat{Price} = 67.4 + 0.2184\times\text{Sq. Ft.}  -364.6\times\text{waterfront} + 0.4327\times\text{Sq.Ft}\times\text{Waterfront}
\]</span></p>
<p>For a house on the waterfront (<span class="math inline">\(\text{waterfront}=1\)</span>), the equation is</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{Price} &amp; = 67.4 + 0.2184\times\text{Sq. Ft.} -364.6 \times\text{1} + 0.4327\times\text{Sq.Ft}\times\text{1} \\
&amp; = (67.4 - 364.6) + (0.2184+0.4327)\times{\text{Sq. Ft.}} \\
&amp; = -297.2 + 0.6511\times{\text{Sq. Ft.}}
\end{aligned}
\]</span> For a house not on the waterfront (<span class="math inline">\(\text{waterfront}=0\)</span>), the equation is</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{Price} &amp; = 67.4 + 0.2184\times\text{Sq. Ft.} -364.6 \times\text{0} + 0.4327\times\text{Sq.Ft}\times\text{0} \\
&amp; = 67.4 0 + 0.2184\times{\text{Sq. Ft.}}
\end{aligned}
\]</span> <strong>Interpretation</strong></p>
<p>When interpreting <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span>, we need to state that the interpretations apply only to the “baseline” category (in this case non-waterfront houses).</p>
<p>In a model with interaction, it does not make sense to talk about holding one variable constant when interpreting the effect of the other, since the effect of one variable depends on the value or category of the other. Instead, we must state the value or category of one variable when interpreting the effect of the other.</p>
<p><strong>Interpretations:</strong></p>
<ul>
<li><p><span class="math inline">\(b_0\)</span> - On average, a house with 0 square feet that is not on the waterfront is expected to cost 67 thousand dollars. This is not a sensible interpretation since there are no houses with 0 square feet.</p></li>
<li><p><span class="math inline">\(b_1\)</span> - For each additional square foot in size, the price of a non-waterfront house is expected to increase by 0.2184 thousand dollars.</p></li>
<li><p><span class="math inline">\(b_2\)</span> - On average, the price of a waterfront house with 0 square feet is expected to be 364.6 thousand dollars less than the price of a non-waterfront house with 0 square feet. This is not a sensible interpretation in this case.</p></li>
<li><p><span class="math inline">\(b_3\)</span> - For each additional square foot in size, the price of a waterfront house is expected to increase by 0.4327 thousand dollars more than a non-waterfront house.</p></li>
</ul>
<p>Alternatively, we could interpret <span class="math inline">\(b_0+b_2\)</span> and <span class="math inline">\(b_1+b_3\)</span> together.</p>
<ul>
<li><p><span class="math inline">\(b_0 + b_2\)</span> - On average, a house with 0 square feet that is on the waterfront is expected to cost -297.2 thousand dollars. This is not a sensible interpretation since there are no houses with 0 square feet.</p></li>
<li><p><span class="math inline">\(b_1 + b_3\)</span> - For each additional square foot in size, the price of a waterfront house is expected to increase by 0.6511 thousand dollars.</p></li>
</ul>
<p><strong>Prediction</strong></p>
<p>We calculate predicted prices for the following houses:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>Houses[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">16</span>), ] <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, price, sqft_living, waterfront)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
     ID price sqft_living waterfront
  &lt;int&gt; &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;     
1    90  335.        1030 No        
2  2141 1700         2500 Yes       </code></pre>
</div>
</div>
<p><span class="math display">\[
\widehat{Price}_1 = 67.4 + 0.2184\times5420  -364.6\times0 + 0.4327\times5420 \times 0 = 1191 \text{ thousand dollars}
\]</span></p>
<p><span class="math display">\[
\widehat{Price}_{16} = 67.4 + 0.2184\times4450  -364.6\times1 + 0.4327\times4450 \times 1 = 2600 \text{ thousand dollars}
\]</span></p>
</section>
<section id="r2-for-interaction-model" class="level3" data-number="5.4.4">
<h3 data-number="5.4.4" class="anchored" data-anchor-id="r2-for-interaction-model"><span class="header-section-number">5.4.4</span> <span class="math inline">\(R^2\)</span> for Interaction Model</h3>
<p>We can calculate residuals, as well as SSR, SSM, SST, and <span class="math inline">\(R^2\)</span>, in the same manner we’ve seen previously.</p>
<p>We’ll perform these calculations using R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>SSR_int <span class="ot">&lt;-</span> <span class="fu">sum</span>(M_House_Int<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>SSR_int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20429024</code></pre>
</div>
</div>
<p><span class="math display">\[
SSM = SST-SSR = 69,045,634 - 10,139,974 =58,905,660.
\]</span></p>
<p><span class="math display">\[
R^2 = \frac{58,905,660}{69,045,634}=0.8531.
\]</span></p>
<p>Approximately 85.3% of the total variability in sale price is explained by the model using square feet and waterfront status, as well as an interaction between them as the explanatory variables.</p>
<p>We calculate <span class="math inline">\(R^2\)</span> directly in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(M_House_Int)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7770731</code></pre>
</div>
</div>
<p>We see that adding an interaction term improved the proportion of variability in house price explained by the model from 0.76 to 0.85. This is a fairly notable increase.</p>
</section>
<section id="considerations-for-using-interactions" class="level3" data-number="5.4.5">
<h3 data-number="5.4.5" class="anchored" data-anchor-id="considerations-for-using-interactions"><span class="header-section-number">5.4.5</span> Considerations for Using Interactions</h3>
<p>It might be tempting to think we should always add an interaction term to a model when using two or more explanatory variables. After all, an interaction term is just another term added to the model, meaning that <span class="math inline">\(R^2\)</span> will never go down.</p>
<p>Adding an interaction term is not always a good idea, though. We saw that doing so makes interpretations more complicated. Increasing the complexity of a model also increases the risk of overfitting, potentially hurting predictive performance on new data.</p>
<p>We should only add an interaction term if we have strong reason to believe that the rate of change in the response variable with respect to one explanatory variable really does depend on the other variable. This might come from background knowledge about the subject, or consultation with an expert in the area. It could also come from data visualization, and the increase in variability in the response variable explained when an interaction term is added to the model.</p>
<p>In the house price dataset, we might expect that the price of waterfront houses might increase more rapidly as they get bigger than the price of non-waterfront houses. The fact that the lines shown in the scatterplot are not close to being parallel provides further evidence of a difference in rate of increase, providing justification for the use of an interaction term in the model. Furthermore, <span class="math inline">\(R^2\)</span> increases notably (from 0.76 to 0.85), when an interaction term is added. All of these reasons support using an interaction term in this context.</p>
<p>When examining a scatterplot, we should note that even if there is truly no interaction among all houses, the lines probably won’t be exactly parallel, due to random deviations among the sample of houses chosen. If the lines are reasonably close to parallel, then an interaction term is likely not needed.</p>
<p>We’ll look more at criteria for determining whether to add an interaction term to a model in the coming sections.</p>
</section>
<section id="interaction-vs-correlation" class="level3" data-number="5.4.6">
<h3 data-number="5.4.6" class="anchored" data-anchor-id="interaction-vs-correlation"><span class="header-section-number">5.4.6</span> Interaction vs Correlation</h3>
<p>It is easy to confuse the concept of interaction with that of correlation. These are, in fact, very different concepts.</p>
<p>A correlation between two variables means that as one increases, the other is more likely to increase or decrease. We only use the word correlation to describe two quantitative variables, but we could discuss the similar notion of a relationship between categorical variables.</p>
<p>An interaction between two explanatory variables means that the effect of one on the response depends on the other.</p>
<p><strong>Examples of Correlations (or relationships)</strong></p>
<ol type="1">
<li><p>Houses on the waterfront tend to be bigger than houses not on the waterfront, so there is a relationship between square feet and waterfront status.</p></li>
<li><p>Houses with large amounts of living space in square feet are likely to have more bedrooms, so there is a correlation between living space and bedrooms.</p></li>
<li><p>Suppose that some genres of movies (drama, comedy, action, etc.) tend to be longer than others. This is an example of a relationship between genre and length.</p></li>
</ol>
<p>The fact that there is a correlation between explanatory variables is NOT a reason to add an interaction term involving those variables in a model. Correlation is something entirely different than interaction!</p>
<p><strong>Examples of Interactions</strong></p>
<ol type="1">
<li><p>As houses on the waterfront increase in size, their price increases more rapidly than for houses not on the waterfront. This means there is an interaction between size and waterfront location.</p></li>
<li><p>Suppose that the effect of additional bedrooms on price is different for houses with lots of living space than for houses with little living space. This would be an example of an interaction between living space and number of bedrooms.</p></li>
<li><p>Suppose that audiences become more favorable to dramas as they get longer, but less favorable to comedies as they get longer. In this scenario, the effect of movie length on audience rating depends on the genre of the movie, indicating an interaction between length and genre.</p></li>
</ol>
</section>
</section>
<section id="building-models-for-interpretation" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="building-models-for-interpretation"><span class="header-section-number">5.5</span> Building Models for Interpretation</h2>
<p>So far, we’ve dealt with models with 2 or fewer variables. Some real questions require accounting for more than two variables. In these situations, we’ll need to develop a model that is complex enough to capture the important aspects of the mechanism we’re modeling, but also simple enough for us to be able to explain and interpret. We’ll need to decide how many variables to include in the model, and whether to use transformations, or to include interaction terms.</p>
<p>We’ll examine strategies for modeling in two different contexts. In this chapter, we’ll focus on building models for situations when we want to make interpretations and draw conclusions about relationships between variables. In Chapter 7, we focus on modeling solely for the purpose of prediction, when we are not interested in making interpretations or conclusions about relationships between variables.</p>
<p>When building a model for the purpose of interpretation, we are typically interested in investigating a research question pertaining to relationships between explanatory and response variables. We’ll need to think about things like:</p>
<ul>
<li>which explanatory variables should we include in the model, and how many?<br>
</li>
<li>should we include any interaction terms?<br>
</li>
<li>should we use any nonlinear terms?<br>
</li>
<li>should we use a transformation of the response variable?</li>
</ul>
<p>We’ll go through a couple example to see how we can address these questions in building a model.</p>
<p>Keep in mind, there is no single correct model, but there are common characteristics of a good model. While two statisticians might use different models for a given set of data, they will hopefully lead to reasonably similar conclusions if constructed carefully.</p>
<section id="modeling-sat-scores" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="modeling-sat-scores"><span class="header-section-number">5.5.1</span> Modeling SAT Scores</h3>
<p>We’ll now look at a dataset containing education data on all 50 states. It includes the following variables.</p>
<p><code>state</code> - a factor with names of each state</p>
<p><code>expend</code> - expenditure per pupil in average daily attendance in public elementary and secondary schools, 1994-95 (in thousands of US dollars)</p>
<p><code>ratio</code> - average pupil/teacher ratio in public elementary and secondary schools, Fall 1994</p>
<p><code>salary</code> - estimated average annual salary of teachers in public elementary and secondary schools, 1994-95 (in thousands of US dollars)</p>
<p><code>frac</code> - percentage of all eligible students taking the SAT, 1994-95</p>
<p><code>sat</code> - average total SAT score, 1994-95</p>
<p><code>region</code> - region of the country</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(SAT)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>SAT <span class="ot">&lt;-</span> SAT <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(verbal, math))</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Lock5Data)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"USStates"</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>SAT <span class="ot">&lt;-</span> SAT <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(USStates <span class="sc">%&gt;%</span> <span class="fu">select</span>(State, Region), <span class="at">by=</span><span class="fu">c</span>(<span class="st">"state"</span><span class="ot">=</span><span class="st">"State"</span>)) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">region =</span> Region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>SAT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            state expend ratio salary frac  sat region
1         Alabama  4.405  17.2 31.144    8 1029      S
2          Alaska  8.963  17.6 47.951   47  934      W
3         Arizona  4.778  19.3 32.175   27  944      W
4        Arkansas  4.459  17.1 28.934    6 1005      S
5      California  4.992  24.0 41.078   45  902      W
6        Colorado  5.443  18.4 34.571   29  980      W
7     Connecticut  8.817  14.4 50.045   81  908     NE
8        Delaware  7.030  16.6 39.076   68  897     NE
9         Florida  5.718  19.1 32.588   48  889      S
10        Georgia  5.193  16.3 32.291   65  854      S
11         Hawaii  6.078  17.9 38.518   57  889      W
12          Idaho  4.210  19.1 29.783   15  979      W
13       Illinois  6.136  17.3 39.431   13 1048     MW
14        Indiana  5.826  17.5 36.785   58  882     MW
15           Iowa  5.483  15.8 31.511    5 1099     MW
16         Kansas  5.817  15.1 34.652    9 1060     MW
17       Kentucky  5.217  17.0 32.257   11  999     MW
18      Louisiana  4.761  16.8 26.461    9 1021      S
19          Maine  6.428  13.8 31.972   68  896     NE
20       Maryland  7.245  17.0 40.661   64  909     NE
21  Massachusetts  7.287  14.8 40.795   80  907     NE
22       Michigan  6.994  20.1 41.895   11 1033     MW
23      Minnesota  6.000  17.5 35.948    9 1085     MW
24    Mississippi  4.080  17.5 26.818    4 1036      S
25       Missouri  5.383  15.5 31.189    9 1045     MW
26        Montana  5.692  16.3 28.785   21 1009      W
27       Nebraska  5.935  14.5 30.922    9 1050     MW
28         Nevada  5.160  18.7 34.836   30  917      W
29  New Hampshire  5.859  15.6 34.720   70  935     NE
30     New Jersey  9.774  13.8 46.087   70  898     NE
31     New Mexico  4.586  17.2 28.493   11 1015      W
32       New York  9.623  15.2 47.612   74  892     NE
33 North Carolina  5.077  16.2 30.793   60  865      S
34   North Dakota  4.775  15.3 26.327    5 1107     MW
35           Ohio  6.162  16.6 36.802   23  975     MW
36       Oklahoma  4.845  15.5 28.172    9 1027      S
37         Oregon  6.436  19.9 38.555   51  947      W
38   Pennsylvania  7.109  17.1 44.510   70  880     NE
39   Rhode Island  7.469  14.7 40.729   70  888     NE
40 South Carolina  4.797  16.4 30.279   58  844      S
41   South Dakota  4.775  14.4 25.994    5 1068     MW
42      Tennessee  4.388  18.6 32.477   12 1040      S
43          Texas  5.222  15.7 31.223   47  893      S
44           Utah  3.656  24.3 29.082    4 1076      W
45        Vermont  6.750  13.8 35.406   68  901     NE
46       Virginia  5.327  14.6 33.987   65  896      S
47     Washington  5.906  20.2 36.151   48  937      W
48  West Virginia  6.107  14.8 31.944   17  932      S
49      Wisconsin  6.930  15.9 37.746    9 1073     MW
50        Wyoming  6.160  14.9 31.285   10 1001      W</code></pre>
</div>
</div>
<p>Note that the dataset is quite old (from 1994-95), so the financial information may be out of date. Nevertheless, it is useful for exploring relationships between SAT scores and other variables.</p>
<p><strong>Research Question</strong></p>
<p>A good statistical research question should be one that has practical implications that people would care about. It should be complex enough to be worth investigating. If the answer is obvious, then there would be no need to use statistics, or scientific reasoning in general.</p>
<p>For the SAT score dataset, we’ll focus on the question:</p>
<p><strong>Do students in states that prioritize education spending achieve better SAT scores?</strong></p>
<p>While this may seem like a straightforward question, we’ll see that answering it properly requires careful thought and analysis.</p>
<section id="initial-model" class="level4" data-number="5.5.1.1">
<h4 data-number="5.5.1.1" class="anchored" data-anchor-id="initial-model"><span class="header-section-number">5.5.1.1</span> Initial Model</h4>
<p>One way to measure a state’s investment in education is in how much it pays its teachers. The plot displays average SAT score against average teacher salary for all 50 US states.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>SAT, <span class="fu">aes</span>(<span class="at">y=</span>sat, <span class="at">x=</span>salary)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average SAT score vs Average Teacher Salary"</span>) <span class="sc">+</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Average Teacher Salary in Thousands"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Fitting a simple linear regression model to the data, we obtain the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>SAT_M1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>SAT, sat<span class="sc">~</span>salary)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(SAT_M1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sat ~ salary, data = SAT)

Residuals:
     Min       1Q   Median       3Q      Max 
-147.125  -45.354    4.073   42.193  125.279 

Coefficients:
            Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept) 1158.859     57.659  20.098 &lt; 0.0000000000000002 ***
salary        -5.540      1.632  -3.394              0.00139 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 67.89 on 48 degrees of freedom
Multiple R-squared:  0.1935,    Adjusted R-squared:  0.1767 
F-statistic: 11.52 on 1 and 48 DF,  p-value: 0.001391</code></pre>
</div>
</div>
<p>On average, SAT score is expected to decrease by about 5.5 points for each additional one thousand dollars in average teacher salary in the state. The low p-value suggests a relationship like this is unlikely to occur by chance, though the practical importance of a 5-point decrease in SAT score (out of 1600) seems minimal. Furthermore, only 19% of the total variation in SAT score is explained by teaching salary. Nevertheless, a person looking to argue against raising teacher salaries might use the negative estimate and low p-value as a justification for their position.</p>
</section>
<section id="a-deeper-investigation" class="level4" data-number="5.5.1.2">
<h4 data-number="5.5.1.2" class="anchored" data-anchor-id="a-deeper-investigation"><span class="header-section-number">5.5.1.2</span> A Deeper Investigation</h4>
<p>Notice that there are large discrepancies in the <code>frac</code> variable, representing the percentage of students taking the SAT. In Connecticut, 81% of high school students took the SAT, compared to only 6% in Arkansas.</p>
<p>Let’s break the data down by the percentage of students who take the SAT. We’ll (somewhat arbitrarily), divide the states into</p>
<p>Low = 0%-22%<br>
Medium = 22-49%<br>
High = 49-81%</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>SAT <span class="ot">&lt;-</span> <span class="fu">mutate</span>(SAT, <span class="at">fracgrp =</span> <span class="fu">cut</span>(frac, </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">22</span>, <span class="dv">49</span>, <span class="dv">81</span>), </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"medium"</span>, <span class="st">"high"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting SAT score against average teacher salary in each state, we see that the picture changes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>SAT, <span class="fu">aes</span>( <span class="at">y=</span>sat, <span class="at">x=</span>salary )) <span class="sc">+</span><span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="sc">~</span>fracgrp) <span class="sc">+</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Average Teacher Salary in Thousands"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>There appears to be a slight positive relationship between teacher salary and SAT score in each state.</p>
<p>While breaking up the data into these three groups helps us visualize, we’ll simply add the <code>frac</code> variable to the model as a quantitative variable, rather than breaking it into these arbitrary categories.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>SAT_M2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>SAT, sat<span class="sc">~</span>salary<span class="sc">+</span>frac)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(SAT_M2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sat ~ salary + frac, data = SAT)

Residuals:
    Min      1Q  Median      3Q     Max 
-78.313 -26.731   3.168  18.951  75.590 

Coefficients:
            Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept) 987.9005    31.8775  30.991 &lt; 0.0000000000000002 ***
salary        2.1804     1.0291   2.119               0.0394 *  
frac         -2.7787     0.2285 -12.163   0.0000000000000004 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 33.69 on 47 degrees of freedom
Multiple R-squared:  0.8056,    Adjusted R-squared:  0.7973 
F-statistic: 97.36 on 2 and 47 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>For each one thousand dollar increase in average teacher salary, a state’s average SAT score is expected to increase by 2.18 points, assuming percentage of students taking the test is the same.</p>
<p>For each one percent increase in percentage of students taking the SAT, a state’s average score is expected to decrease by 2.78 points, assuming average teacher salary is the same.</p>
<p>Both of these estimates are associated with low p-values. While the effect of a 2 point increase per $1,000 in average teacher salary might seem small, the ~3 point decrease for each percentage point of students taking the exam is quite meaningful. According to the model, if the percentage of students taking the SAT is 10 percentage points higher than another, and the states pay their teachers the same, then the state with more people taking the exam is expected to have an average score almost 30 points lower.</p>
<p>Adding percentage of students taking the exam increased the <span class="math inline">\(R^2\)</span> value substantially.</p>
<p>We see that the relationship between SAT score and salary appears to reverse when we account for percentage of students taking the test. States with low percentages of people taking the SAT tend to get higher scores, as the people taking the test tend to be those who are best prepared and have strong incentive for taking it, perhaps because they are trying to get into an elite college. At the same time, states that pay their teachers more tend to have higher percentages of people taking the SAT. This may be because states that prioritize education are more likely to cover the cost of students taking the test, or even to require it. It may also be that many of the states that require the SAT are coastal states, where cost of living, and thus teacher salaries, tend to be higher in general. Thus, it appears initially that teacher salaries are negatively correlated with SAT scores, but after accounting for percentage taking the test, the trend reverses. Situations where an apparent trend disappears or reverses after accounting for another variable are called <strong>Simpson’s Paradox.</strong></p>
</section>
<section id="student-to-teacher-ratio" class="level4" data-number="5.5.1.3">
<h4 data-number="5.5.1.3" class="anchored" data-anchor-id="student-to-teacher-ratio"><span class="header-section-number">5.5.1.3</span> Student-to-Teacher Ratio</h4>
<p>Let’s see what other possible explanatory variables we might want to add to the model. Keep in mind that our goal is to understand the relationship between teacher salary and SAT scores in the state, so we should only use variables that help us understand this relationship.<br>
In addition to teacher salaries, student-to-teacher ratio might be an indication of a state’s investment in education. We’ll add student-to-teacher ratio to the model and explore whether there is evidence that hiring enough teachers to keep student-to-teacher ratio low has a benefit, in terms of SAT score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>SAT_M3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>SAT, sat<span class="sc">~</span>salary<span class="sc">+</span>frac<span class="sc">+</span>ratio)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(SAT_M3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sat ~ salary + frac + ratio, data = SAT)

Residuals:
    Min      1Q  Median      3Q     Max 
-89.244 -21.485  -0.798  17.685  68.262 

Coefficients:
             Estimate Std. Error t value            Pr(&gt;|t|)    
(Intercept) 1057.8982    44.3287  23.865 &lt;0.0000000000000002 ***
salary         2.5525     1.0045   2.541              0.0145 *  
frac          -2.9134     0.2282 -12.764 &lt;0.0000000000000002 ***
ratio         -4.6394     2.1215  -2.187              0.0339 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 32.41 on 46 degrees of freedom
Multiple R-squared:  0.8239,    Adjusted R-squared:  0.8124 
F-statistic: 71.72 on 3 and 46 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p><strong>Interpretations</strong></p>
<p>On average, a $1,000 dollar increase in average teacher salary is associated with a 2.5 point increase in average SAT score assuming fraction of students taking the SAT, and student to teacher ratio are held constant.</p>
<p>On average, a 1% increase in percentage of students taking the SAT is associated with a 2.9 point decrease in average SAT score assuming average teacher salary, and student to teacher ratio are held constant.</p>
<p>On average, a 1 student per teacher increase in student to teacher ratio is associated with a 4.6 point from in average SAT score, assuming average teacher salary, and percentage of students taking the SAT are held constant.</p>
<p>We see that student to teacher ratio is negatively associated with SAT score, with an expected drop of about 4.6 points in average SAT score for each additional student per teacher, assuming average teacher salary and percentage of students taking the exam are held constant. This suggests that states should try to keep student to teacher ratios low. We see teacher salary remains positively correlated with SAT score and percentage taking the test remains negatively correlated, after accounting for student to teacher ratio.</p>
</section>
<section id="multicollinearity" class="level4" data-number="5.5.1.4">
<h4 data-number="5.5.1.4" class="anchored" data-anchor-id="multicollinearity"><span class="header-section-number">5.5.1.4</span> Multicollinearity</h4>
<p>Next, let’s add the variable <code>expend</code>, which measures the state’s expenditure per pupil.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>SAT_M4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>SAT, sat<span class="sc">~</span>salary<span class="sc">+</span>frac<span class="sc">+</span>ratio<span class="sc">+</span>expend)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(SAT_M4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sat ~ salary + frac + ratio + expend, data = SAT)

Residuals:
    Min      1Q  Median      3Q     Max 
-90.531 -20.855  -1.746  15.979  66.571 

Coefficients:
             Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept) 1045.9715    52.8698  19.784 &lt; 0.0000000000000002 ***
salary         1.6379     2.3872   0.686                0.496    
frac          -2.9045     0.2313 -12.559 0.000000000000000261 ***
ratio         -3.6242     3.2154  -1.127                0.266    
expend         4.4626    10.5465   0.423                0.674    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 32.7 on 45 degrees of freedom
Multiple R-squared:  0.8246,    Adjusted R-squared:  0.809 
F-statistic: 52.88 on 4 and 45 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>It may be surprising to see that after accounting for expenditure per student, teacher salary is still positively correlated with SAT score, but that the p-value associated with teacher salary is quite large. Likewise, while student-to-teacher ratio is still negatively associated, it too has a large p-value. Also notice that <span class="math inline">\(R^2\)</span> barely increased when accounting for total expenditures.</p>
<p>This happens because expenditures are highly correlated with teacher salary. States that pay their teacher more also spend more on education per pupil. The scatterplot matrix below shows a strong correlation of 0.87 between teacher salary and expenditures.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>SAT_Num <span class="ot">&lt;-</span> <span class="fu">select_if</span>(SAT, is.numeric)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">cor</span>(SAT_Num, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(C,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       expend ratio salary  frac   sat
expend   1.00 -0.37   0.87  0.59 -0.38
ratio   -0.37  1.00   0.00 -0.21  0.08
salary   0.87  0.00   1.00  0.62 -0.44
frac     0.59 -0.21   0.62  1.00 -0.89
sat     -0.38  0.08  -0.44 -0.89  1.00</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(C)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Because these variables are highly correlated, it doesn’t make sense to talk about the effect of increasing teacher salary, while holding expenditure constant, or vice-versa. Notice the standard error on the <code>salary</code> line in model <code>SAT_M4</code> (which includes expenditures) is more than twice as high as in <code>SAT_M3</code>, which did not. This happens because the model is not able to separate the effect of salary from the effect of expenditure, and thus becomes very uncertain of the effect of both, resulting in high standard errors. In addition to reducing the t-statistic, and increasing the p-value, this leads to much wider and less informative confidence intervals associated with the effect of teacher salary.</p>
<p><strong>Confidence intervals for model involving teacher salary, percentage taking the test, and student-to-teacher ratio.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(SAT_M3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  2.5 %       97.5 %
(Intercept) 968.6691802 1147.1271438
salary        0.5304797    4.5744605
frac         -3.3727807   -2.4539197
ratio        -8.9098147   -0.3690414</code></pre>
</div>
</div>
<p><strong>Confidence intervals for model with above variables plus expenditure.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(SAT_M4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %      97.5 %
(Intercept) 939.486374 1152.456698
salary       -3.170247    6.446081
frac         -3.370262   -2.438699
ratio       -10.100417    2.851952
expend      -16.779204   25.704393</code></pre>
</div>
</div>
<p>Models with highly correlated explanatory variables suffer from <strong>multicollinearity</strong>, which increases standard errors, making the effect of variables harder to discern. When we have explanatory variables that are highly correlated (usually with correlation greater than 0.8), we should pick out just one to include in the model. In this case, we’ll stick with teacher salary.</p>
</section>
<section id="check-model-assumptions" class="level4" data-number="5.5.1.5">
<h4 data-number="5.5.1.5" class="anchored" data-anchor-id="check-model-assumptions"><span class="header-section-number">5.5.1.5</span> Check Model Assumptions</h4>
<p>Let’s return to the model with salary, ratio, and fraction taking test. We use residual plots to assess model assumptions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(SAT_M3<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">y=</span>SAT_M3<span class="sc">$</span>residuals, <span class="at">x=</span>SAT_M3<span class="sc">$</span>fitted.values)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Predicted Values"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(SAT_M3<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">x=</span>SAT_M3<span class="sc">$</span>residuals)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Histogram of Residuals"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Residual"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(SAT_M3<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">sample =</span> <span class="fu">scale</span>(SAT_M3<span class="sc">$</span>residuals))) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Normal Quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residual Quantiles"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"QQ Plot"</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, P3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>There is some sign of a quadratic trend in the residual plot, creating concern about the linearity assumption.</p>
<p>In models with multiple explanatory variables, it is helpful to also plot our residuals against the explanatory variables to see whether the model is properly accounting for relationships involving each variable. If we see nonlinear trends, we should consider adding a nonlinear function of that explanatory variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(SAT_M3<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">y=</span>SAT_M3<span class="sc">$</span>residuals, <span class="at">x=</span>SAT_M3<span class="sc">$</span>model<span class="sc">$</span>salary)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual by Predictor Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Salary"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>) </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(SAT_M3<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">y=</span>SAT_M3<span class="sc">$</span>residuals, <span class="at">x=</span>SAT_M3<span class="sc">$</span>model<span class="sc">$</span>frac)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual by Predictor Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Fraction Taking Test"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(SAT_M3<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">y=</span>SAT_M3<span class="sc">$</span>residuals, <span class="at">x=</span>SAT_M3<span class="sc">$</span>model<span class="sc">$</span>ratio)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual by Predictor Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Student to Teach Ratio"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, P3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>There is also a quadratic trend in the plot involving the fraction variable. We might account for this by adding a quadratic term for <code>frac</code> to the model.</p>
</section>
<section id="quadratic-term" class="level4" data-number="5.5.1.6">
<h4 data-number="5.5.1.6" class="anchored" data-anchor-id="quadratic-term"><span class="header-section-number">5.5.1.6</span> Quadratic Term</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>SAT_M5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>SAT, sat<span class="sc">~</span>salary<span class="sc">+</span>frac<span class="sc">+</span><span class="fu">I</span>(frac<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>ratio )</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(SAT_M5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sat ~ salary + frac + I(frac^2) + ratio, data = SAT)

Residuals:
   Min     1Q Median     3Q    Max 
-66.09 -15.20  -4.64  15.06  52.77 

Coefficients:
              Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept) 1039.21242   36.28206  28.643 &lt; 0.0000000000000002 ***
salary         1.80708    0.83150   2.173               0.0351 *  
frac          -6.64001    0.77668  -8.549      0.0000000000555 ***
I(frac^2)      0.05065    0.01025   4.942      0.0000111676728 ***
ratio         -0.04058    1.96174  -0.021               0.9836    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 26.38 on 45 degrees of freedom
Multiple R-squared:  0.8858,    Adjusted R-squared:  0.8757 
F-statistic: 87.28 on 4 and 45 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>We notice a small p-value associated with the quadratic term, indicating SAT scores do indeed show evidence of a quadratic trend with respect to the percentage of students taking the test.</p>
<p>We now examine residual plots for the model that includes the quadratic term for <code>frac</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(SAT_M5<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">y=</span>SAT_M5<span class="sc">$</span>residuals, <span class="at">x=</span>SAT_M5<span class="sc">$</span>fitted.values)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Predicted Values"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(SAT_M5<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">x=</span>SAT_M5<span class="sc">$</span>residuals)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Histogram of Residuals"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Residual"</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(SAT_M5<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">sample =</span> <span class="fu">scale</span>(SAT_M5<span class="sc">$</span>residuals))) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Normal Quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residual Quantiles"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"QQ Plot"</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, P3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(SAT_M3<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">y=</span>SAT_M5<span class="sc">$</span>residuals, <span class="at">x=</span>SAT_M5<span class="sc">$</span>model<span class="sc">$</span>salary)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual by Predictor Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Salary"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>) </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(SAT_M3<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">y=</span>SAT_M5<span class="sc">$</span>residuals, <span class="at">x=</span>SAT_M5<span class="sc">$</span>model<span class="sc">$</span>frac)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual by Predictor Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Fraction Taking Test"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(SAT_M3<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">y=</span>SAT_M5<span class="sc">$</span>residuals, <span class="at">x=</span>SAT_M5<span class="sc">$</span>model<span class="sc">$</span>ratio)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual by Predictor Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Student to Teach Ratio"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, P3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>The quadratic trend in the residual by predicted plot and second residual by fraction plot appear to have disappeared, suggesting this model has properly accounted for the quadratic trend.</p>
<p><strong>Interpretations for Model with Quadratic Term</strong></p>
<p>On average, a $1,000 dollar increase in average teacher salary is associated with a 1.8 point increase in average SAT score assuming fraction of students taking the SAT, and student to teacher ratio are held constant.</p>
<p>On average, a 1 student per teacher increase in student to teacher ratio is associated with a 0.05 point from in average SAT score, assuming average teacher salary, and percentage of students taking the SAT are held constant.</p>
<p>We cannot give a clear interpretation of the fraction variable, since it occurs in both linear and quadratic terms. In fact, the vertex of the parabola given by <span class="math inline">\(y=-6.64x + 0.05x^2\)</span> occurs at <span class="math inline">\(x=\frac{6.64}{2(0.05)}\approx 66\)</span>. So the model estimates that SAT score decreases in a quadratic fashion with respect to fraction taking the test, until that fraction reaches 66 percent of student, then is expected to increase.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>SAT, <span class="fu">aes</span>(<span class="at">x=</span>frac, <span class="at">y=</span>sat)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We do see some possible quadratic trend, but we should be really careful about extrapolation. Although the trend does seem to level off in a quadratic way, we wouldn’t expect SAT scores to start to increase if more than 80 percent of students took the exam!</p>
</section>
<section id="account-for-region" class="level4" data-number="5.5.1.7">
<h4 data-number="5.5.1.7" class="anchored" data-anchor-id="account-for-region"><span class="header-section-number">5.5.1.7</span> Account for Region?</h4>
<p>So far, we’ve considered only quantitative explanatory variables. What if we add region of the country to the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>SAT_M6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>SAT, sat<span class="sc">~</span>salary<span class="sc">+</span>frac<span class="sc">+</span><span class="fu">I</span>(frac<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>ratio <span class="sc">+</span> region )</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(SAT_M6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sat ~ salary + frac + I(frac^2) + ratio + region, 
    data = SAT)

Residuals:
    Min      1Q  Median      3Q     Max 
-45.309 -15.407  -1.996  13.852  41.859 

Coefficients:
              Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept) 1085.46629   37.25849  29.133 &lt; 0.0000000000000002 ***
salary         0.19485    0.86256   0.226             0.822378    
frac          -6.12514    0.84697  -7.232        0.00000000679 ***
I(frac^2)      0.04762    0.01217   3.914             0.000327 ***
ratio          0.83366    1.99687   0.417             0.678452    
regionNE     -11.53616   18.18986  -0.634             0.529384    
regionS      -40.07482   11.14606  -3.595             0.000845 ***
regionW      -15.89290   11.77634  -1.350             0.184386    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 23.58 on 42 degrees of freedom
Multiple R-squared:  0.9148,    Adjusted R-squared:  0.9007 
F-statistic: 64.46 on 7 and 42 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>We find that on average, SAT scores were lower in the NE, S, and W regions, compared to the baseline region of MW, though only in the S is the difference large enough to yield a small p-value.</p>
<p>Notice that the effect of teacher salary and student-to-teacher ratio are no longer statistically significant. This happens because now we are only comparing states in the same region of the country. The p-value associated with teacher salary is now testing the null hypothesis “There is no relationship between average teacher salary and SAT score among states in the same region of the country, with the same percentage of students taking the test, and same student to teacher ratio.”</p>
<p>Because we only have 50 states to begin with, breaking down by region results in small sample sizes, which contributes to the large p-values. Furthermore, it is unclear why we would need to account for region here. If our goal is to assess the impact of educational spending on SAT scores, it is probably okay to compare states in different regions of the country. Unless we have some reason for wanting to compare states in the same region, we shouldn’t include region as an explanatory variable (even though including it did raise our <span class="math inline">\(R^2\)</span> value above 0.9). In general, we should only include variables if they help us address our research question. In this case, it’s not clear that accounting for region helps us better understand the relationship between a state’s investment in education, and its students average SAT scores.</p>
<p>It is important to note that we <strong>should not</strong> decide whether to include a variable based on whether or not it yielded a small p-value. Adding or deleting variables from a model until we get a desired p-value on a variable we’re interested in can lead to <strong>Confirmation bias</strong> (that is choosing our model in a way that intentionally confirms what we expected or hoped to be true), and to detecting spurious correlations that will not be replicable in future studies. This phenomenon, known as <strong>p-hacking</strong> has led to incorrect and unethical conclusions. We should make modeling decisions about which variables to include in a model before looking at the p-values and then draw conclusions based on the results we see, keeping in mind that p-values are only a part of the picture.</p>
<p><strong>Predictions and Intervals</strong></p>
<p>Going back to Model M5, which did not include region, we can make confidence and predictions intervals corresponding to hypothetical states.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>newstate <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">salary =</span> <span class="dv">45</span>, <span class="at">frac=</span><span class="fl">0.5</span>, <span class="at">ratio=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(SAT_M5, <span class="at">newdata =</span> newstate, <span class="at">interval=</span><span class="st">"confidence"</span>, <span class="at">conf.level=</span><span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit     lwr    upr
1 1116.615 1085.93 1147.3</code></pre>
</div>
</div>
<p>We are 95% confident that the average of average SAT scores among all states with average teacher salary of 45 thousand dollars, where 50% of students take the SAT and having student-to-teacher ratio of 15 is between 1085 and 1147.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(SAT_M5, <span class="at">newdata =</span> newstate, <span class="at">interval=</span><span class="st">"prediction"</span>, <span class="at">conf.level=</span><span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 1116.615 1055.256 1177.973</code></pre>
</div>
</div>
<p>We are 95% confident that an individual state with average teacher salary of 45 thousand dollars, where 50% of students take the SAT and having student-to-teacher ratio of 15 will have an average SAT score between 1055 and 1178.</p>
</section>
</section>
<section id="modeling-car-price" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="modeling-car-price"><span class="header-section-number">5.5.2</span> Modeling Car Price</h3>
<p>We’ll build a model for the price of a new 2015 car, to help us understand what factors are related to the price of a car.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Cars2015)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>Cars2015 <span class="ot">&lt;-</span> Cars2015 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Price=</span>LowPrice)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>Cars2015 <span class="ot">&lt;-</span> Cars2015<span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>HighPrice)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(Cars2015)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 110
Columns: 19
$ Make      &lt;fct&gt; Chevrolet, Hyundai, Kia, Mitsubishi, Nissan, Dodge, Chevrole…
$ Model     &lt;fct&gt; Spark, Accent, Rio, Mirage, Versa Note, Dart, Cruze LS, 500L…
$ Type      &lt;fct&gt; Hatchback, Hatchback, Sedan, Hatchback, Hatchback, Sedan, Se…
$ Price     &lt;dbl&gt; 12.270, 14.745, 13.990, 12.995, 14.180, 16.495, 16.170, 19.3…
$ Drive     &lt;fct&gt; FWD, FWD, FWD, FWD, FWD, FWD, FWD, FWD, FWD, FWD, FWD, AWD, …
$ CityMPG   &lt;int&gt; 30, 28, 28, 37, 31, 23, 24, 24, 28, 30, 27, 27, 25, 27, 30, …
$ HwyMPG    &lt;int&gt; 39, 37, 36, 44, 40, 35, 36, 33, 38, 35, 33, 36, 36, 37, 39, …
$ FuelCap   &lt;dbl&gt; 9.0, 11.4, 11.3, 9.2, 10.9, 14.2, 15.6, 13.1, 12.4, 11.1, 11…
$ Length    &lt;int&gt; 145, 172, 172, 149, 164, 184, 181, 167, 179, 154, 156, 180, …
$ Width     &lt;int&gt; 63, 67, 68, 66, 67, 72, 71, 70, 72, 67, 68, 69, 70, 68, 69, …
$ Wheelbase &lt;int&gt; 94, 101, 101, 97, 102, 106, 106, 103, 104, 99, 98, 104, 104,…
$ Height    &lt;int&gt; 61, 57, 57, 59, 61, 58, 58, 66, 58, 59, 58, 58, 57, 58, 59, …
$ UTurn     &lt;int&gt; 34, 37, 37, 32, 37, 38, 38, 37, 39, 34, 35, 38, 37, 36, 37, …
$ Weight    &lt;int&gt; 2345, 2550, 2575, 2085, 2470, 3260, 3140, 3330, 2990, 2385, …
$ Acc030    &lt;dbl&gt; 4.4, 3.7, 3.5, 4.4, 4.0, 3.4, 3.7, 3.9, 3.4, 3.9, 3.9, 3.7, …
$ Acc060    &lt;dbl&gt; 12.8, 10.3, 9.5, 12.1, 10.9, 9.3, 9.8, 9.5, 9.2, 10.8, 11.1,…
$ QtrMile   &lt;dbl&gt; 19.4, 17.8, 17.3, 19.0, 18.2, 17.2, 17.6, 17.4, 17.1, 18.3, …
$ PageNum   &lt;int&gt; 123, 148, 163, 188, 196, 128, 119, 131, 136, 216, 179, 205, …
$ Size      &lt;fct&gt; Small, Small, Small, Small, Small, Small, Small, Small, Smal…</code></pre>
</div>
</div>
<p><strong>Exploratory Analysis</strong></p>
<p>We’ll look at a summary of the categorical variables in the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>Cars_Cat <span class="ot">&lt;-</span> <span class="fu">select_if</span>(Cars2015, is.factor)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cars_Cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Make            Model            Type    Drive          Size   
 Chevrolet: 8   CTS        :  2   7Pass    :15   AWD:25   Large   :29  
 Ford     : 7   2 Touring  :  1   Hatchback:11   FWD:63   Midsized:34  
 Hyundai  : 7   200        :  1   Sedan    :46   RWD:22   Small   :47  
 Toyoto   : 7   3 i Touring:  1   Sporty   :11                         
 Audi     : 6   3 Series GT:  1   SUV      :18                         
 Nissan   : 6   300        :  1   Wagon    : 9                         
 (Other)  :69   (Other)    :103                                        </code></pre>
</div>
</div>
<p>We examine the correlation matrix of quantitative variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>Cars_Num <span class="ot">&lt;-</span> <span class="fu">select_if</span>(Cars2015, is.numeric)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">cor</span>(Cars_Num, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(C,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Price CityMPG HwyMPG FuelCap Length Width Wheelbase Height UTurn
Price      1.00   -0.65  -0.59    0.57   0.47  0.48      0.46   0.02  0.40
CityMPG   -0.65    1.00   0.93   -0.77  -0.72 -0.78     -0.69  -0.39 -0.73
HwyMPG    -0.59    0.93   1.00   -0.75  -0.64 -0.75     -0.64  -0.54 -0.68
FuelCap    0.57   -0.77  -0.75    1.00   0.82  0.85      0.79   0.58  0.76
Length     0.47   -0.72  -0.64    0.82   1.00  0.81      0.92   0.46  0.84
Width      0.48   -0.78  -0.75    0.85   0.81  1.00      0.76   0.62  0.77
Wheelbase  0.46   -0.69  -0.64    0.79   0.92  0.76      1.00   0.49  0.81
Height     0.02   -0.39  -0.54    0.58   0.46  0.62      0.49   1.00  0.55
UTurn      0.40   -0.73  -0.68    0.76   0.84  0.77      0.81   0.55  1.00
Weight     0.55   -0.83  -0.84    0.91   0.82  0.91      0.81   0.71  0.80
Acc030    -0.76    0.64   0.51   -0.47  -0.38 -0.41     -0.31   0.21 -0.36
Acc060    -0.74    0.68   0.52   -0.49  -0.47 -0.46     -0.38   0.21 -0.41
QtrMile   -0.76    0.65   0.49   -0.45  -0.42 -0.41     -0.35   0.25 -0.37
PageNum   -0.23    0.28   0.15   -0.15  -0.23 -0.20     -0.24   0.06 -0.22
          Weight Acc030 Acc060 QtrMile PageNum
Price       0.55  -0.76  -0.74   -0.76   -0.23
CityMPG    -0.83   0.64   0.68    0.65    0.28
HwyMPG     -0.84   0.51   0.52    0.49    0.15
FuelCap     0.91  -0.47  -0.49   -0.45   -0.15
Length      0.82  -0.38  -0.47   -0.42   -0.23
Width       0.91  -0.41  -0.46   -0.41   -0.20
Wheelbase   0.81  -0.31  -0.38   -0.35   -0.24
Height      0.71   0.21   0.21    0.25    0.06
UTurn       0.80  -0.36  -0.41   -0.37   -0.22
Weight      1.00  -0.41  -0.43   -0.39   -0.20
Acc030     -0.41   1.00   0.95    0.95    0.25
Acc060     -0.43   0.95   1.00    0.99    0.26
QtrMile    -0.39   0.95   0.99    1.00    0.26
PageNum    -0.20   0.25   0.26    0.26    1.00</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">corrplot</span>(C)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>Note the high correlation between many variables in the dataset. We’ll need to be careful about multicollinearity.</p>
<section id="acc.-and-qrt.-mile-time" class="level4" data-number="5.5.2.1">
<h4 data-number="5.5.2.1" class="anchored" data-anchor-id="acc.-and-qrt.-mile-time"><span class="header-section-number">5.5.2.1</span> Acc. and Qrt. Mile Time</h4>
<p>We saw in Section 5.2 that it was better to model log(Price) than price itself, so we’ll continue modeling logprice here.</p>
<p><strong>Model Using Just Acceleration Time</strong></p>
<p>First, we fit a model using only the time it takes to accelerate from 0 to 60 mph as an explanatory variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>Cars_M1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Cars2015, <span class="fu">log</span>(Price) <span class="sc">~</span> Acc060)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cars_M1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(Price) ~ Acc060, data = Cars2015)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.84587 -0.19396  0.00908  0.18615  0.53350 

Coefficients:
            Estimate Std. Error t value            Pr(&gt;|t|)    
(Intercept)  5.13682    0.13021   39.45 &lt;0.0000000000000002 ***
Acc060      -0.22064    0.01607  -13.73 &lt;0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.276 on 108 degrees of freedom
Multiple R-squared:  0.6359,    Adjusted R-squared:  0.6325 
F-statistic: 188.6 on 1 and 108 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>Confidence Interval for Effect of Acceleration Time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(Cars_M1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  2.5 %     97.5 %
(Intercept) 131.4610408 220.284693
Acc060        0.7768669   0.827959</code></pre>
</div>
</div>
<p>We are 95% confident that a 1-second increase in acceleration time is associated with an average price decrease between 17% and 22.5%.</p>
<p><strong>Model Using Just Quarter Mile Time</strong></p>
<p>Now, let’s fit a different model using only the time it takes to drive a quarter mile as an explanatory variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>Cars_M2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Cars2015, <span class="fu">log</span>(Price) <span class="sc">~</span> QtrMile)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cars_M2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(Price) ~ QtrMile, data = Cars2015)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.91465 -0.19501  0.02039  0.17538  0.60073 

Coefficients:
            Estimate Std. Error t value            Pr(&gt;|t|)    
(Intercept)   7.8559     0.3248   24.19 &lt;0.0000000000000002 ***
QtrMile      -0.2776     0.0201  -13.81 &lt;0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.275 on 108 degrees of freedom
Multiple R-squared:  0.6385,    Adjusted R-squared:  0.6351 
F-statistic: 190.7 on 1 and 108 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>Confidence Interval for Effect of Quarter Mile Time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(Cars_M2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   2.5 %      97.5 %
(Intercept) 1355.8297704 4913.077313
QtrMile        0.7279941    0.788385</code></pre>
</div>
</div>
<p>We are 95% confident that a 1-second increase in quarter mile time is associated with a price decrease between 21% and 27%, on average.</p>
<p><strong>Model Using Both Acceleration and Quarter Mile Time</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>Cars_M3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Cars2015, <span class="fu">log</span>(Price) <span class="sc">~</span> QtrMile <span class="sc">+</span> Acc060)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cars_M3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(Price) ~ QtrMile + Acc060, data = Cars2015)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.89124 -0.20030  0.01001  0.17576  0.57462 

Coefficients:
            Estimate Std. Error t value  Pr(&gt;|t|)    
(Intercept)  6.83974    1.54354   4.431 0.0000227 ***
QtrMile     -0.17316    0.15640  -1.107     0.271    
Acc060      -0.08389    0.12455  -0.673     0.502    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2757 on 107 degrees of freedom
Multiple R-squared:   0.64, Adjusted R-squared:  0.6332 
F-statistic:  95.1 on 2 and 107 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p><strong>Confidence Intervals from 2-variable Model</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(Cars_M3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %       97.5 %
(Intercept) 43.8095999 19922.799158
QtrMile      0.6168071     1.146686
Acc060       0.7183525     1.177065</code></pre>
</div>
</div>
<p>It does not make sense to talk about holding QtrMile constant as Acc060 increases, or vice-versa. Trying to do so leads to nonsensical answers.</p>
<p>We are 95% confident that a 1-second increase in quarter mile time is associated with an average price change between a 38% decrease and 15% increase, assuming acceleration time is held constant.</p>
<p>We are 95% confident that a 1-second increase in acceleration time is associated with an average price change between a 28% decrease and 18% increase, assuming quarter mile time is held constant.</p>
<p>Because these variables are so highly correlated, it the model cannot separate the effect of one from the other, and thus is uncertain about both. Notice the very large standard errors associated with both regression coefficients, which lead to very wide confidence intervals.</p>
<p>In fact, if two variables are perfectly correlated, it will be impossible to fit them both in a model, and you will get an error message.</p>
<p><strong>Impact on Prediction</strong></p>
<p>Suppose we want to predict the price of a car that can accelerate from 0 to 60 mph in 9.5 seconds, and completes a quarter mile in 17.3 seconds.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">predict</span>(Cars_M1, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">Acc060=</span><span class="fl">9.5</span>, <span class="at">QtrMile=</span><span class="fl">17.3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
20.92084 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">predict</span>(Cars_M2, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">Acc060=</span><span class="fl">9.5</span>, <span class="at">QtrMile=</span><span class="fl">17.3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
21.18223 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">predict</span>(Cars_M3, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">Acc060=</span><span class="fl">9.5</span>, <span class="at">QtrMile=</span><span class="fl">17.3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
21.05489 </code></pre>
</div>
</div>
<p>The predicted values are similar. Multicollinearity does not hurt predictions, only interpretations.</p>
</section>
<section id="adding-weight-to-model" class="level4" data-number="5.5.2.2">
<h4 data-number="5.5.2.2" class="anchored" data-anchor-id="adding-weight-to-model"><span class="header-section-number">5.5.2.2</span> Adding Weight to Model</h4>
<p>We could use either quarter mile time or acceleration time as an explanatory variable, but we shouldn’t use both. We’ll proceed with quarter mile time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>Cars_M4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Cars2015, <span class="fu">log</span>(Price) <span class="sc">~</span> QtrMile <span class="sc">+</span> Weight)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cars_M4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(Price) ~ QtrMile + Weight, data = Cars2015)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.79365 -0.13931 -0.01368  0.15773  0.42234 

Coefficients:
               Estimate  Std. Error t value             Pr(&gt;|t|)    
(Intercept)  6.21326823  0.33491778  18.552 &lt; 0.0000000000000002 ***
QtrMile     -0.22482146  0.01748563 -12.858 &lt; 0.0000000000000002 ***
Weight       0.00020606  0.00002641   7.803      0.0000000000043 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2206 on 107 degrees of freedom
Multiple R-squared:  0.7696,    Adjusted R-squared:  0.7653 
F-statistic: 178.7 on 2 and 107 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p><span class="math inline">\(R^2\)</span> went up from 0.64 to 0.76!</p>
<p>We might consider adding an interaction term between quarter mile time and weight. This would mean that we think the effect of quarter mile time on price of a car is different for heavier cars than for lighter cars. It’s not clear to me why that would be the case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>Cars_M5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Cars2015, <span class="fu">log</span>(Price) <span class="sc">~</span> QtrMile <span class="sc">*</span> Weight)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cars_M5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(Price) ~ QtrMile * Weight, data = Cars2015)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.82013 -0.12076 -0.01464  0.14717  0.41928 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)     4.1114189  1.3270870   3.098  0.00249 **
QtrMile        -0.0963226  0.0804413  -1.197  0.23381   
Weight          0.0008110  0.0003707   2.188  0.03089 * 
QtrMile:Weight -0.0000373  0.0000228  -1.636  0.10482   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2188 on 106 degrees of freedom
Multiple R-squared:  0.7752,    Adjusted R-squared:  0.7689 
F-statistic: 121.9 on 3 and 106 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>p-value on interaction is not that small. <span class="math inline">\(R^2\)</span> didn’t go up much. There doesn’t seem to be much reason to complicate the model by adding an interaction term.</p>
</section>
<section id="adding-more-variables" class="level4" data-number="5.5.2.3">
<h4 data-number="5.5.2.3" class="anchored" data-anchor-id="adding-more-variables"><span class="header-section-number">5.5.2.3</span> Adding More Variables</h4>
<p>We’ll consider adding highway MPG to the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>Cars_M6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Cars2015, <span class="fu">log</span>(Price) <span class="sc">~</span> QtrMile <span class="sc">+</span> Weight <span class="sc">+</span> HwyMPG)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cars_M6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(Price) ~ QtrMile + Weight + HwyMPG, data = Cars2015)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.82308 -0.14513 -0.01922  0.16732  0.41390 

Coefficients:
               Estimate  Std. Error t value             Pr(&gt;|t|)    
(Intercept)  6.54954436  0.42196132  15.522 &lt; 0.0000000000000002 ***
QtrMile     -0.21699008  0.01843615 -11.770 &lt; 0.0000000000000002 ***
Weight       0.00015922  0.00004456   3.573             0.000532 ***
HwyMPG      -0.00961141  0.00737658  -1.303             0.195410    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2198 on 106 degrees of freedom
Multiple R-squared:  0.7732,    Adjusted R-squared:  0.7668 
F-statistic: 120.5 on 3 and 106 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>HwyMPG doesn’t make change <span class="math inline">\(R^2\)</span> much, and has a high correlation with weight. Let’s not include it.</p>
<p>Next, we’ll consider adding categorical explanatory variables Size, and Drive.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Cars2015, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">log</span>(Price), <span class="at">y=</span>Size)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Price by Size"</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Cars2015, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">log</span>(Price), <span class="at">y=</span>Drive)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Price by Drive"</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Information about size is already included, through the weight variable. Let’s add drive type to the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>Cars_M7 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Cars2015, <span class="fu">log</span>(Price) <span class="sc">~</span> QtrMile <span class="sc">+</span> Weight <span class="sc">+</span> Drive)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cars_M7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(Price) ~ QtrMile + Weight + Drive, data = Cars2015)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.72386 -0.10882  0.01269  0.13306  0.45304 

Coefficients:
               Estimate  Std. Error t value             Pr(&gt;|t|)    
(Intercept)  5.81406789  0.33961789  17.119 &lt; 0.0000000000000002 ***
QtrMile     -0.19007439  0.01959554  -9.700 0.000000000000000289 ***
Weight       0.00020496  0.00002583   7.936 0.000000000002420675 ***
DriveFWD    -0.22403222  0.05704513  -3.927             0.000154 ***
DriveRWD    -0.13884399  0.06227709  -2.229             0.027913 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2077 on 105 degrees of freedom
Multiple R-squared:  0.7995,    Adjusted R-squared:  0.7919 
F-statistic: 104.7 on 4 and 105 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>We found evidence of differences in price between front-wheel drive and rear-wheel drive, compared to all wheel drive cars.</p>
<p>Next, we’ll explore adding size to the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>Cars_M8 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Cars2015, <span class="fu">log</span>(Price) <span class="sc">~</span> QtrMile <span class="sc">+</span> Weight <span class="sc">+</span> Drive <span class="sc">+</span> Size)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cars_M8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(Price) ~ QtrMile + Weight + Drive + Size, data = Cars2015)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.71092 -0.12126  0.01355  0.11831  0.44439 

Coefficients:
                Estimate  Std. Error t value             Pr(&gt;|t|)    
(Intercept)   5.66594310  0.37169625  15.243 &lt; 0.0000000000000002 ***
QtrMile      -0.19256547  0.02000711  -9.625 0.000000000000000505 ***
Weight        0.00023978  0.00004101   5.847 0.000000059416930182 ***
DriveFWD     -0.21598794  0.05780323  -3.737             0.000306 ***
DriveRWD     -0.15259183  0.06410851  -2.380             0.019142 *  
SizeMidsized  0.04699095  0.06271499   0.749             0.455398    
SizeSmall     0.08875861  0.08105810   1.095             0.276071    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2085 on 103 degrees of freedom
Multiple R-squared:  0.8018,    Adjusted R-squared:  0.7903 
F-statistic: 69.46 on 6 and 103 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>Adding size barely increased <span class="math inline">\(R^2\)</span> at all. We find no evidence of differences in price between the three sizes, after accounting for the other variables.</p>
<p>Note: Information about car size is already being taken into account through the <code>Weight</code> variable.</p>
<p>We could keep looking at other variables to add, but at this point, we have a model that gives us a good sense of the factors related to price of a car, capturing 80% of total variability in car price, and is still easy to interpret.</p>
<p>For our research purposes, this model is good enough.</p>
</section>
<section id="check-of-model-assumptions" class="level4" data-number="5.5.2.4">
<h4 data-number="5.5.2.4" class="anchored" data-anchor-id="check-of-model-assumptions"><span class="header-section-number">5.5.2.4</span> Check of Model Assumptions</h4>
<p>We’ll use residuals to check the model assumptions.</p>
<p><strong>Residual by Predicted Plot, Histogram of Residuals, and Normal Quantile-Quantile Plot</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(Cars_M7<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">y=</span>Cars_M7<span class="sc">$</span>residuals, <span class="at">x=</span>Cars_M7<span class="sc">$</span>fitted.values)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Predicted Values"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(Cars_M7<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">x=</span>Cars_M7<span class="sc">$</span>residuals)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Histogram of Residuals"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Residual"</span>)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(Cars_M7<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">sample =</span> <span class="fu">scale</span>(Cars_M7<span class="sc">$</span>residuals))) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Normal Quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residual Quantiles"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"QQ Plot"</span>)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, P3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>There is slight concern about constant variance, but otherwise, the model assumptions look good.</p>
<p><strong>Residual by Predictor Plots</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(Cars_M7<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">y=</span>Cars_M7<span class="sc">$</span>residuals, <span class="at">x=</span>Cars_M7<span class="sc">$</span>model<span class="sc">$</span>QtrMile)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual by Predictor Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"QtrMile"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>) </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(Cars_M7<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">y=</span>Cars_M7<span class="sc">$</span>residuals, <span class="at">x=</span>Cars_M7<span class="sc">$</span>model<span class="sc">$</span>Weight)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual by Predictor Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Weight"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>) </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(Cars_M7<span class="sc">$</span>residuals), <span class="fu">aes</span>(<span class="at">y=</span>Cars_M7<span class="sc">$</span>residuals, <span class="at">x=</span>Cars_M7<span class="sc">$</span>model<span class="sc">$</span>Drive)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residual by Predictor Plot"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Drive"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Residuals"</span>) </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(P1, P2, P3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch5_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>These plots don’t raise any concerns.</p>
</section>
<section id="coefficients-and-exponentiation" class="level4" data-number="5.5.2.5">
<h4 data-number="5.5.2.5" class="anchored" data-anchor-id="coefficients-and-exponentiation"><span class="header-section-number">5.5.2.5</span> Coefficients and Exponentiation</h4>
<p>The model coefficients are shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>Cars_M7<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept)       QtrMile        Weight      DriveFWD      DriveRWD 
 5.8140678915 -0.1900743859  0.0002049586 -0.2240322171 -0.1388439916 </code></pre>
</div>
</div>
<p>Since we used a log transformation, we should interpret <span class="math inline">\(e^{b_j}\)</span> rather than <span class="math inline">\(b_j\)</span> itself.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(Cars_M7<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)     QtrMile      Weight    DriveFWD    DriveRWD 
334.9790161   0.8268976   1.0002050   0.7992894   0.8703638 </code></pre>
</div>
</div>
<p>The price of a car is expected to decrease by 17% for each additional second it takes to drive a quartermile, assuming weight, and drive type are held constant.</p>
<p>The price of a car is expected to increase by 0.02% for each additional pound, assuming quarter mile time, and drive type are held constant. Thus, a 100 lb increase is associated with an expected 2% increase in price, assuming quarter mile time, and drive type are held constant.</p>
<p>FWD cars are expected to cost 20% less than AWD cars, assuming quarter mile time and weight are held constant.</p>
<p>RWD cars are expected to cost 13% less than AWD cars, assuming quarter mile time and weight are held constant.</p>
</section>
<section id="confidence-and-prediction-intevals" class="level4" data-number="5.5.2.6">
<h4 data-number="5.5.2.6" class="anchored" data-anchor-id="confidence-and-prediction-intevals"><span class="header-section-number">5.5.2.6</span> Confidence and Prediction Intevals</h4>
<p>We’ll use our model to estimate the average price with the following characteristics, and also to predict the price of a new car with the given characteristics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>newcar <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">QtrMile =</span> <span class="dv">18</span>, <span class="at">Weight=</span><span class="dv">2400</span>, <span class="at">Drive =</span> <span class="st">"AWD"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is an interval for log(Price).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(Cars_M7, <span class="at">newdata=</span>newcar, <span class="at">interval=</span><span class="st">"confidence"</span>, <span class="at">level=</span><span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 2.884629 2.741423 3.027836</code></pre>
</div>
</div>
<p>Exponentiating, we obtain</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">predict</span>(Cars_M7, <span class="at">newdata=</span>newcar, <span class="at">interval=</span><span class="st">"confidence"</span>, <span class="at">level=</span><span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 17.89693 15.50904 20.65249</code></pre>
</div>
</div>
<p>We are 95% Confident that the average price of all new 2015 cars that weigh 2400 lbs, drive a quarter mile in 18 seconds on a fast track, and have all wheel drive is between 15.5 thousand and 20.7 thousand dollars.</p>
<p>Next, we calculate a prediction interval for an individual car with these characteristics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">predict</span>(Cars_M7, <span class="at">newdata=</span>newcar, <span class="at">interval=</span><span class="st">"prediction"</span>, <span class="at">level=</span><span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr     upr
1 17.89693 11.57309 27.6763</code></pre>
</div>
</div>
<p>We are 95% Confident that the price of an individual new 2015 car that weighs 2400 lbs, drives a quarter mile in 18 seconds on a fast track, and has all wheel drive will be between 11.6 thousand and 27.7 thousand dollars.</p>
</section>
<section id="model-building-summary" class="level4" data-number="5.5.2.7">
<h4 data-number="5.5.2.7" class="anchored" data-anchor-id="model-building-summary"><span class="header-section-number">5.5.2.7</span> Model Building Summary</h4>
<p>Consider the following when building a model for the purpose of interpreting parameters and understanding and drawing conclusions about a population or process.</p>
<ul>
<li>Model driven by research question</li>
<li>Include variables of interest<br>
</li>
<li>Include potential confounders (like in SAT example)<br>
</li>
<li>Avoid including highly correlated explanatory variables<br>
</li>
<li>Avoid messy transformations and interactions where possible<br>
</li>
<li>Use residual plots to assess appropriateness of model assumptions<br>
</li>
<li>Aim for high <span class="math inline">\(R^2\)</span> but not highest<br>
</li>
<li>Aim for model complex enough to capture nature of data, but simple enough to give clear interpretations<br>
</li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ch4.html" class="pagination-link" aria-label="Inference from Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Inference from Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch6.html" class="pagination-link" aria-label="Logistic Regression">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>