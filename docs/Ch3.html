<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>STAT 255 Notes - 3&nbsp; Simulation-Based Inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ch4.html" rel="next">
<link href="./Ch2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Ch3.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Simulation-Based Inference</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">STAT 255 Notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Visualizing and Summarizing Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Statistical Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Simulation-Based Inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Inference from Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Building and Assessing Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ch7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Predictive Modeling</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sampling-distributions" id="toc-sampling-distributions" class="nav-link active" data-scroll-target="#sampling-distributions"><span class="header-section-number">3.1</span> Sampling Distributions</a>
  <ul class="collapse">
  <li><a href="#population-and-sample" id="toc-population-and-sample" class="nav-link" data-scroll-target="#population-and-sample"><span class="header-section-number">3.1.1</span> Population and Sample</a></li>
  <li><a href="#sampling-variability" id="toc-sampling-variability" class="nav-link" data-scroll-target="#sampling-variability"><span class="header-section-number">3.1.2</span> Sampling Variability</a></li>
  <li><a href="#sample-size-and-standard-error" id="toc-sample-size-and-standard-error" class="nav-link" data-scroll-target="#sample-size-and-standard-error"><span class="header-section-number">3.1.3</span> Sample Size and Standard Error</a></li>
  </ul></li>
  <li><a href="#confidence-intervals" id="toc-confidence-intervals" class="nav-link" data-scroll-target="#confidence-intervals"><span class="header-section-number">3.2</span> Confidence Intervals</a>
  <ul class="collapse">
  <li><a href="#constructing-confidence-intervals" id="toc-constructing-confidence-intervals" class="nav-link" data-scroll-target="#constructing-confidence-intervals"><span class="header-section-number">3.2.1</span> Constructing Confidence Intervals</a></li>
  <li><a href="#what-does-95-confidence-mean" id="toc-what-does-95-confidence-mean" class="nav-link" data-scroll-target="#what-does-95-confidence-mean"><span class="header-section-number">3.2.2</span> What does 95% Confidence Mean?</a></li>
  </ul></li>
  <li><a href="#bootstrapping" id="toc-bootstrapping" class="nav-link" data-scroll-target="#bootstrapping"><span class="header-section-number">3.3</span> Bootstrapping</a>
  <ul class="collapse">
  <li><a href="#mercury-concentration-in-florida-lakes" id="toc-mercury-concentration-in-florida-lakes" class="nav-link" data-scroll-target="#mercury-concentration-in-florida-lakes"><span class="header-section-number">3.3.1</span> Mercury Concentration in Florida Lakes</a></li>
  <li><a href="#bootstrap-sampling" id="toc-bootstrap-sampling" class="nav-link" data-scroll-target="#bootstrap-sampling"><span class="header-section-number">3.3.2</span> Bootstrap Sampling</a></li>
  <li><a href="#bootstrap-samples-of-lakes" id="toc-bootstrap-samples-of-lakes" class="nav-link" data-scroll-target="#bootstrap-samples-of-lakes"><span class="header-section-number">3.3.3</span> Bootstrap Samples of Lakes</a></li>
  <li><a href="#bootstrap-distribution" id="toc-bootstrap-distribution" class="nav-link" data-scroll-target="#bootstrap-distribution"><span class="header-section-number">3.3.4</span> Bootstrap Distribution</a></li>
  <li><a href="#bootstrap-se-confidence-interval" id="toc-bootstrap-se-confidence-interval" class="nav-link" data-scroll-target="#bootstrap-se-confidence-interval"><span class="header-section-number">3.3.5</span> Bootstrap SE Confidence Interval</a></li>
  </ul></li>
  <li><a href="#more-bootstrap-examples" id="toc-more-bootstrap-examples" class="nav-link" data-scroll-target="#more-bootstrap-examples"><span class="header-section-number">3.4</span> More Bootstrap Examples</a>
  <ul class="collapse">
  <li><a href="#bootstrapping-other-statistics" id="toc-bootstrapping-other-statistics" class="nav-link" data-scroll-target="#bootstrapping-other-statistics"><span class="header-section-number">3.4.1</span> Bootstrapping Other Statistics</a></li>
  <li><a href="#ci-for-mean" id="toc-ci-for-mean" class="nav-link" data-scroll-target="#ci-for-mean"><span class="header-section-number">3.4.2</span> CI for Mean</a></li>
  <li><a href="#ci-for-standard-deviation" id="toc-ci-for-standard-deviation" class="nav-link" data-scroll-target="#ci-for-standard-deviation"><span class="header-section-number">3.4.3</span> CI for Standard Deviation</a></li>
  <li><a href="#ci-for-median" id="toc-ci-for-median" class="nav-link" data-scroll-target="#ci-for-median"><span class="header-section-number">3.4.4</span> CI for Median</a></li>
  <li><a href="#ci-for-difference-in-means" id="toc-ci-for-difference-in-means" class="nav-link" data-scroll-target="#ci-for-difference-in-means"><span class="header-section-number">3.4.5</span> CI for Difference in Means</a></li>
  <li><a href="#ci-for-regression-slope" id="toc-ci-for-regression-slope" class="nav-link" data-scroll-target="#ci-for-regression-slope"><span class="header-section-number">3.4.6</span> CI for Regression Slope</a></li>
  <li><a href="#ci-for-regression-response" id="toc-ci-for-regression-response" class="nav-link" data-scroll-target="#ci-for-regression-response"><span class="header-section-number">3.4.7</span> CI for Regression Response</a></li>
  <li><a href="#more-cis-in-regression" id="toc-more-cis-in-regression" class="nav-link" data-scroll-target="#more-cis-in-regression"><span class="header-section-number">3.4.8</span> More CI’s in Regression</a></li>
  <li><a href="#bootstrapping-cautions" id="toc-bootstrapping-cautions" class="nav-link" data-scroll-target="#bootstrapping-cautions"><span class="header-section-number">3.4.9</span> Bootstrapping Cautions</a></li>
  </ul></li>
  <li><a href="#hypothesis-testing" id="toc-hypothesis-testing" class="nav-link" data-scroll-target="#hypothesis-testing"><span class="header-section-number">3.5</span> Hypothesis Testing</a>
  <ul class="collapse">
  <li><a href="#mercury-levels-in-florida-lakes" id="toc-mercury-levels-in-florida-lakes" class="nav-link" data-scroll-target="#mercury-levels-in-florida-lakes"><span class="header-section-number">3.5.1</span> Mercury Levels in Florida Lakes</a></li>
  <li><a href="#model-for-mercury-level" id="toc-model-for-mercury-level" class="nav-link" data-scroll-target="#model-for-mercury-level"><span class="header-section-number">3.5.2</span> Model for Mercury Level</a></li>
  <li><a href="#hypotheses-and-key-question" id="toc-hypotheses-and-key-question" class="nav-link" data-scroll-target="#hypotheses-and-key-question"><span class="header-section-number">3.5.3</span> Hypotheses and Key Question</a></li>
  <li><a href="#permutation-test-for-difference-in-means" id="toc-permutation-test-for-difference-in-means" class="nav-link" data-scroll-target="#permutation-test-for-difference-in-means"><span class="header-section-number">3.5.4</span> Permutation Test for Difference in Means</a></li>
  <li><a href="#five-permutations-in-r" id="toc-five-permutations-in-r" class="nav-link" data-scroll-target="#five-permutations-in-r"><span class="header-section-number">3.5.5</span> Five Permutations in R</a></li>
  <li><a href="#r-code-for-permutation-test" id="toc-r-code-for-permutation-test" class="nav-link" data-scroll-target="#r-code-for-permutation-test"><span class="header-section-number">3.5.6</span> R Code for Permutation Test</a></li>
  <li><a href="#p-values" id="toc-p-values" class="nav-link" data-scroll-target="#p-values"><span class="header-section-number">3.5.7</span> p-values</a></li>
  </ul></li>
  <li><a href="#more-hypothesis-test-examples" id="toc-more-hypothesis-test-examples" class="nav-link" data-scroll-target="#more-hypothesis-test-examples"><span class="header-section-number">3.6</span> More Hypothesis Test Examples</a>
  <ul class="collapse">
  <li><a href="#other-test-statistics" id="toc-other-test-statistics" class="nav-link" data-scroll-target="#other-test-statistics"><span class="header-section-number">3.6.1</span> Other Test Statistics</a></li>
  <li><a href="#general-permutation-test-procedure" id="toc-general-permutation-test-procedure" class="nav-link" data-scroll-target="#general-permutation-test-procedure"><span class="header-section-number">3.6.2</span> General Permutation Test Procedure</a></li>
  <li><a href="#difference-in-standard-deviation" id="toc-difference-in-standard-deviation" class="nav-link" data-scroll-target="#difference-in-standard-deviation"><span class="header-section-number">3.6.3</span> Difference in Standard Deviation</a></li>
  <li><a href="#slope-of-regression-line" id="toc-slope-of-regression-line" class="nav-link" data-scroll-target="#slope-of-regression-line"><span class="header-section-number">3.6.4</span> Slope of Regression Line</a></li>
  <li><a href="#f-statistic" id="toc-f-statistic" class="nav-link" data-scroll-target="#f-statistic"><span class="header-section-number">3.6.5</span> F-Statistic</a></li>
  </ul></li>
  <li><a href="#responsible-hypothesis-testing" id="toc-responsible-hypothesis-testing" class="nav-link" data-scroll-target="#responsible-hypothesis-testing"><span class="header-section-number">3.7</span> Responsible Hypothesis Testing</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Simulation-Based Inference</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>Learning Outcomes:</strong></p>
<ol start="14" type="1">
<li>Define population, sample, and sampling distribution, and a parameter and statistic.<br>
</li>
<li>Interpret standard deviation and standard error in context.<br>
</li>
<li>Explain how to use bootstrapping to calculate confidence intervals.<br>
</li>
<li>Interpret confidence intervals in context.<br>
</li>
<li>Calculate confidence intervals in R.</li>
<li>Write null and alternative hypotheses, identify test statistics, and state conclusions in context.<br>
</li>
<li>Interpret p-values in context.<br>
</li>
<li>Explain how to use simulation to perform hypothesis tests.</li>
<li>Compare and contrast the conclusions we can draw from confidence intervals and hypothesis tests.<br>
</li>
<li>Perform hypothesis tests in R.</li>
</ol>
<section id="sampling-distributions" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sampling-distributions"><span class="header-section-number">3.1</span> Sampling Distributions</h2>
<section id="population-and-sample" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="population-and-sample"><span class="header-section-number">3.1.1</span> Population and Sample</h3>
<p>In statistics, we often do not have the time, money, or means to collect data on all individuals or units on which we want to draw conclusions. Instead, we might collect data on only a subset of the individuals, and then make inferences about all individuals we are interested in, using the information we collected.</p>
<p><strong>Vocabulary:</strong></p>
<ol type="1">
<li>A <strong>population</strong> is the entire set of individuals that we want to draw conclusions about.</li>
<li>A <strong>sample</strong> is a subset of a population.<br>
</li>
<li>A <strong>parameter</strong> is a numerical quantity pertaining to an entire population or process.<br>
</li>
<li>A <strong>statistic</strong> is a numerical quantity calculated from a sample.</li>
</ol>
<p>We’ll work with a dataset containing information on all 20,591 flights from New York to Chicago in 2013. Our population of interest is all 20,591 flights. We’re interested in the proportion of fights that arrive on time, and the average arrival delay (in minutes). Arrival delay represents how much earlier/later did the flight arrive than expected. Whether or not the flight arrived on time is a categorical variable, while arrival delay is a quantitative variable.</p>
<p>In this situation, we have information on the entire population. In statistics, this is rare. It is more common to have information on only subset of flights contained in a sample. If the sample is collected in a way that is representative of the population, such as by sampling at random, then we can use the sample to draw conclusions about the population.</p>
<p>We’ll begin by studying the behavior of sample statistics when we know the population parameters, and then use what we learn to handle more real situations where we don’t know about the entire population.</p>
<p>The parameter of interest is the proportion of on-time arrivals out of all flights in the population of 20,591. When the parameter is proportion, we’ll denote it with the letter <span class="math inline">\(p\)</span>.</p>
<p>The first 10 flights, all of which occurred on January 1 are shown below. We see that most of those flights were not on-time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Flights_NY_CHI, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 9
    year month   day carrier origin dest  sched_dep_time arr_delay ontime
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt; 
 1  2013     1     1 UA      EWR    ORD              558        12 N     
 2  2013     1     1 AA      LGA    ORD              600         8 N     
 3  2013     1     1 MQ      EWR    ORD              600        32 N     
 4  2013     1     1 AA      LGA    ORD              630        14 N     
 5  2013     1     1 AA      LGA    ORD              700         4 N     
 6  2013     1     1 UA      LGA    ORD              700        20 N     
 7  2013     1     1 UA      EWR    ORD              713        21 N     
 8  2013     1     1 AA      LGA    ORD              745       -12 Y     
 9  2013     1     1 MQ      EWR    ORD              710        49 N     
10  2013     1     1 B6      JFK    ORD              830        15 N     </code></pre>
</div>
</div>
<p>Note that a negative arrival delay denotes a flight that arrived before expected, thus on time.</p>
<p>The bar graph shows the number of flights that arrived on time throughout the year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>on_time_plot_POP <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Flights_NY_CHI, <span class="fu">aes</span>(<span class="at">x=</span>ontime)) <span class="sc">+</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ggtitle</span>(<span class="st">"On-time Flights"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>on_time_plot_POP</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that the majority of flights did arrive on time.</p>
<p>We’ll calculate the proportion of flights arriving on time, among all 20,591 flights in the population.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#proportion of flights on time</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">sum</span>(Flights_NY_CHI<span class="sc">$</span>ontime<span class="sc">==</span><span class="st">"Y"</span>)<span class="sc">/</span><span class="dv">20591</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6079841</code></pre>
</div>
</div>
<p>When the population parameter is a proportion, we’ll denote it with the letter <span class="math inline">\(p\)</span>. Here $p=$0.6079841. Keep in mind that in a real situation, we typically won’t know the value of the population parameter <span class="math inline">\(p\)</span>, and will need to estimate it from a sample.</p>
<p>The histogram shows the distribution of arrival delay times. Negative delays indicate the flight arriving ahead of schedule.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Delay_plot_POP <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Flights_NY_CHI, <span class="fu">aes</span>(<span class="at">x=</span>arr_delay)) <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"blue"</span>, <span class="at">binwidth=</span><span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of Arrival Delays"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>Delay_plot_POP</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that the distribution of arrival delays is heavily right-skewed. While most flights arrive around the scheduled time, a few were late by 3 or more hours.</p>
<p>We’ll calculate the mean arrival delay.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#proportion of flights on time</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">mean</span>(Flights_NY_CHI<span class="sc">$</span>arr_delay)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>mu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.144772</code></pre>
</div>
</div>
<p>When the population parameter represents a mean, we’ll denote it using <span class="math inline">\(\mu\)</span>. Here <span class="math inline">\(\mu=\)</span> 7.144772.</p>
<p>We also calculate the standard deviation of arrival delays.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean arrival delay in sample</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>SD_delay <span class="ot">&lt;-</span> <span class="fu">sd</span>(S1<span class="sc">$</span>arr_delay)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>SD_delay</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60.10419</code></pre>
</div>
</div>
</section>
<section id="sampling-variability" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="sampling-variability"><span class="header-section-number">3.1.2</span> Sampling Variability</h3>
<p>We typically won’t have data on the full population and won’t know the values of parameters like <span class="math inline">\(p\)</span> and <span class="math inline">\(\mu\)</span>. Instead, we’ll have data on just a sample taken from the population.</p>
<p>To illustrate, we’ll take a sample of 75 flights. The first 6 flights in the sample are shown below. The <code>ontime</code> variable tells whether or not the flight arrived on time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># take sample of 75 flights</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">08082023</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>S1 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(Flights_NY_CHI, <span class="dv">75</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(S1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
   year month   day carrier origin dest  sched_dep_time arr_delay ontime
  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt; 
1  2013     3     8 AA      LGA    ORD             1720       106 N     
2  2013    12    15 AA      JFK    ORD             1715       -24 Y     
3  2013    10    22 UA      EWR    ORD             1300       -12 Y     
4  2013     8    26 UA      EWR    ORD             2110        15 N     
5  2013     7    23 AA      LGA    ORD             1359        66 N     
6  2013     5    13 UA      EWR    ORD              900       -21 Y     </code></pre>
</div>
</div>
<p>We’ll calculate the number, and proportion of flights that arrived on time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>num_ontime <span class="ot">&lt;-</span> <span class="fu">sum</span>(S1<span class="sc">$</span>ontime <span class="sc">==</span> <span class="st">"Y"</span>) <span class="co"># count number of on-time arrivals</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>num_ontime</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 39</code></pre>
</div>
</div>
<p>Proportion of on-time arrivals in the sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion of on-time flights in sample</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>p_hat <span class="ot">&lt;-</span> num_ontime<span class="sc">/</span><span class="dv">75</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>p_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.52</code></pre>
</div>
</div>
<p>When the sample statistic is a proportion, it is commonly denoted <span class="math inline">\(\hat{p}\)</span>.</p>
<p>In our sample <span class="math inline">\(\hat{p}\)</span> = 52 percent of flights arrived on-time. The sample statistic <span class="math inline">\(\hat{p}\)</span> is an estimate of the population proportion <span class="math inline">\(p\)</span>, the proportion of all flights arriving on time.</p>
<p>We also calculate the mean arrival delay in minutes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean arrival delay in sample</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>y_bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(S1<span class="sc">$</span>arr_delay)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>y_bar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19.2</code></pre>
</div>
</div>
<p>We’ll denote this sample mean <span class="math inline">\(\bar{y}\)</span>. It is an estimate of the population mean, representing the arrival mean delay for all flights, which we’ll denote <span class="math inline">\(\mu\)</span>.</p>
<p>Of course, this was just one sample of 75 flights. If we took different samples of 75 flights, we would expect the statistics <span class="math inline">\(\hat{p}\)</span> and <span class="math inline">\(\bar{x}\)</span> to vary from sample to sample.</p>
<p>Here’s a different sample of 75 flights.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>S2 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(Flights_NY_CHI, <span class="dv">75</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Proportion arriving on time in second sample:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion arriving on time in second sample</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>num_ontime2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(S2<span class="sc">$</span>ontime <span class="sc">==</span> <span class="st">"Y"</span>) <span class="co"># count number of on-time arrivals</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>p_hat2 <span class="ot">&lt;-</span> num_ontime2<span class="sc">/</span><span class="dv">75</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>p_hat2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5066667</code></pre>
</div>
</div>
<p>Mean arrival delay in second sample:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean arrival delay in second sample</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>y_bar2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(S2<span class="sc">$</span>arr_delay)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>y_bar2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15.28</code></pre>
</div>
</div>
<p>Sample statistics will vary from sample to sample, thus it is not realistic to expect them to exactly match their corresponding population parameters.</p>
<p>Nevertheless we can use the sample to estimate the proportion of all flights in the population that arrive on time.</p>
<p>Let’s take 10,000 more random samples of 75 flights and record the proportion of on-time arrivals in each sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>nreps <span class="ot">&lt;-</span> <span class="dv">10000</span>  <span class="co"># number of repetitions</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>p_hat_val <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, nreps) <span class="co"># create vector to hold proportion of on-time arrivals</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>y_bar_val <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, nreps) <span class="co"># create vector to hold mean arrival delay</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>Sample <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>nreps</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nreps){</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(Flights_NY_CHI, <span class="dv">75</span>) <span class="co"># take sample of 75</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>N_ontime <span class="ot">&lt;-</span> <span class="fu">sum</span>(S<span class="sc">$</span>ontime <span class="sc">==</span> <span class="st">"Y"</span>) <span class="co"># count number of on-time arrivals</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>p_hat_val[i] <span class="ot">&lt;-</span> N_ontime<span class="sc">/</span><span class="dv">75</span> <span class="co"># record proportion on-time</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>y_bar_val[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(S<span class="sc">$</span>arr_delay) <span class="co"># record mean arrival delay</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>Samples_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Sample, p_hat_val, y_bar_val) <span class="co"># store results in a data frame</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The table shows the proportion of on-time arrivals in the first 20 samples of 75 flights.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Samples_df, <span class="dv">20</span>) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Sample</th>
<th style="text-align: right;">p_hat_val</th>
<th style="text-align: right;">y_bar_val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">6.16</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">10.75</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">12.41</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: right;">2.24</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">7.33</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">1.28</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">3.25</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">8.93</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">-3.16</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">5.73</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">12.32</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">8.79</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">5.53</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">10.55</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">5.40</td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">24.11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">15.93</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">4.45</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: right;">6.76</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">3.65</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The histogram below shows the distribution of the proportion of on-time arrivals in the 10,000 different samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Prop_Samp_Dist<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Samples_df, <span class="fu">aes</span>(<span class="at">x=</span>p_hat_val)) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"blue"</span>, <span class="at">fill=</span><span class="st">"blue"</span>, <span class="at">binwidth=</span><span class="fl">0.001</span>) <span class="sc">+</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Sampling Distribution for Proportion On Time"</span>) <span class="sc">+</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Prop. on time in sample"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>Prop_Samp_Dist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We notice that most of our 10,000 samples yielded proportions of on-time arrivals between 0.5 and 0.7, The distribution of proportion of on-time arrivals is roughly symmetric and bell-shaped.</p>
<p>The distribution shown in this histogram is called the <strong>sampling distribution for</strong> <span class="math inline">\(\hat{p}\)</span>. The sampling distribution for a statistic shows the distribution of the statistic over many samples.</p>
<p>We’ll calculate the mean of the sampling distribution for <span class="math inline">\(\hat{p}\)</span>. How does it compare to the true population parameter <span class="math inline">\(p\)</span>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Mean_p_hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(Samples_df<span class="sc">$</span>p_hat_val)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>Mean_p_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.60848</code></pre>
</div>
</div>
<p>We can gauge how much the proportion of on-time arrivals varies between samples by calculating the standard deviation of this sampling distribution. The standard deviation of a sampling distribution for a statistic is also called the <strong>standard error</strong> of the statistic. In this case it represents the standard error <span class="math inline">\(\hat{p}\)</span> (the proportion of on-time arrivals), and is denoted <span class="math inline">\(\text{SE}(\hat{p})\)</span>. This standard error is shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>SE_p_hat <span class="ot">&lt;-</span> <span class="fu">sd</span>(Samples_df<span class="sc">$</span>p_hat_val)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>SE_p_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05659102</code></pre>
</div>
</div>
<p>Now, we’ll examine the sampling distribution of the mean arrival time <span class="math inline">\(\bar{y}\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>Mean_Samp_Dist<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Samples_df, <span class="fu">aes</span>(<span class="at">x=</span>y_bar_val)) <span class="sc">+</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">fill=</span><span class="st">"blue"</span>, <span class="at">binwidth=</span><span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Sampling Distribution for Mean Arrival Delay"</span>) <span class="sc">+</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Mean Arrival Delay"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>Mean_Samp_Dist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>How does the sampling distribution for mean arrival delays compare to the distribution of arrival delays for individual flights? Think about the shape and the variability of the distributions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>mean_y_bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(Samples_df<span class="sc">$</span>y_bar_val)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mean_y_bar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.081397</code></pre>
</div>
</div>
<p>The standard error of the mean, <span class="math inline">\(SE(\bar{y})\)</span> is shown calculated below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>SE_y_bar <span class="ot">&lt;-</span> <span class="fu">sd</span>(Samples_df<span class="sc">$</span>y_bar_val)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>SE_y_bar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.563925</code></pre>
</div>
</div>
<p>What does this standard error represent? How is it different than the the standard deviation of flight times, which we previously saw was 60.1 minutes?</p>
<p><strong>Vocabulary:</strong></p>
<ul>
<li>The <strong>sampling distribution</strong> of a statistic is the distribution of values the statistic takes on across many different samples of a given size.<br>
</li>
<li>The <strong>standard error</strong> of a statistic is the standard deviation of that statistic’s sampling distribution. It measures how much the statistic varies between different samples of a given size.</li>
</ul>
</section>
<section id="sample-size-and-standard-error" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="sample-size-and-standard-error"><span class="header-section-number">3.1.3</span> Sample Size and Standard Error</h3>
<p><strong>Question:</strong></p>
<p>Suppose the sample consisted of 10, or 30, or 500 flights, instead of 75? Would you expect the standard deviation of individual flight times to increase, decrease or stay about the same? What about the standard error of the mean delay?</p>
<p>The histogram shows the distribution of individual flight delays in random samples of each size.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<p>For each sample, most of the flights have delays slightly below or above 0, though a small percentage of the flights in each sample have much larger delays. The variability in delays is about the same, regardless of sample size.</p>
<p>The table shows the standard deviation in each of the samples.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Sample_Size</th>
<th style="text-align: right;">SD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">45.38673</td>
</tr>
<tr class="even">
<td style="text-align: right;">30</td>
<td style="text-align: right;">40.64390</td>
</tr>
<tr class="odd">
<td style="text-align: right;">75</td>
<td style="text-align: right;">43.40787</td>
</tr>
<tr class="even">
<td style="text-align: right;">200</td>
<td style="text-align: right;">48.01117</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Sample size does not impact the amount of variability between individual flights. Standard deviation in delay times does not systematically increase or decrease based on sample size (of course it varies a little based on the lakes randomly chosen in the sample).</p>
<p>Now, we’ll examine what happens to the standard error of the mean as the sample size changes.</p>
<p><strong>Distributions of Mean Between Different Samples</strong></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<p>Notice that as the sample size increases, the sampling distribution of the mean becomes more symmetric and bell-shaped, and also more concentrated around the population mean <span class="math inline">\(\mu\)</span>.</p>
<p>The table shows the standard error of the mean for samples of different size:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Sample_Size</th>
<th style="text-align: right;">SE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">15.027787</td>
</tr>
<tr class="even">
<td style="text-align: right;">30</td>
<td style="text-align: right;">8.832375</td>
</tr>
<tr class="odd">
<td style="text-align: right;">75</td>
<td style="text-align: right;">5.461011</td>
</tr>
<tr class="even">
<td style="text-align: right;">200</td>
<td style="text-align: right;">3.371757</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>As sample size increases, variability between means of different samples decreases. Standard error of the mean decreases. This is also true of standard errors for other statistics (i.e.&nbsp;difference in means, regression slopes, etc.)</p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="confidence-intervals" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="confidence-intervals"><span class="header-section-number">3.2</span> Confidence Intervals</h2>
<section id="constructing-confidence-intervals" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="constructing-confidence-intervals"><span class="header-section-number">3.2.1</span> Constructing Confidence Intervals</h3>
<p>We saw that while statistics calculated from individual samples deviate from population parameters, over many samples, they approximately average to the population parameter (assuming the samples are chosen randomly).</p>
<p>Thus, when we have only a single sample, we can use the sample statistic as an estimate of the population parameter, provided we allow for a certain margin of error. The question is how much margin of error do we need?</p>
<p>The sampling distribution for the proportion of on-time flights is shown again below. The true proportion of on-time flights (<span class="math inline">\(p=0.607984\)</span>) is marked by the green dotted line. The gold bar at the bottom of the histogram represents the range of sample proportions that lie within <span class="math inline">\(\pm 2\)</span> standard errors of the true population proportion of flights that arrived on time:</p>
<p>0.608 - 2(0.057) = 0.495 to 0.608 + 2(0.057) = 0.721</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>Prop_Samp_Dist <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept=</span>p, <span class="at">color=</span><span class="st">"green"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>, <span class="at">linewidth=</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>p <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_p_hat,<span class="at">xend=</span>p <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_p_hat, <span class="at">y=</span><span class="dv">50</span>, <span class="at">yend=</span><span class="dv">50</span>), <span class="at">color=</span><span class="st">"gold"</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">alpha=</span><span class="fl">0.01</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We calculate the proportion of samples whose proportion of on-time arrivals lies within <span class="math inline">\(\pm 2\)</span> standard errors of the true proportion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>Lower <span class="ot">&lt;-</span> p <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_p_hat</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>Upper <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_p_hat</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((Samples_df<span class="sc">$</span>p_hat_val <span class="sc">&gt;=</span>Lower) <span class="sc">&amp;</span> (Samples_df<span class="sc">$</span>p_hat_val <span class="sc">&lt;=</span> Upper))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9539</code></pre>
</div>
</div>
<p>Approximately 95% 10,000 samples produced proportions within <span class="math inline">\(\pm 2\)</span> standard errors of the true population proportion of on-time flights.</p>
<p>In a real situation, we won’t have access to the entire population of flights, only the flights in a single sample. For example, recall our original sample of 75 flights, in which we observed a proportion of on-time arrivals of <span class="math inline">\(\hat{p}=\)</span> 0.52.</p>
<p>Since we now know that 95% of all samples produce proportions that lie within two standard errors of the population proportion, we can obtain an estimate of the population proportion <span class="math inline">\(p\)</span> by adding and subtracting <span class="math inline">\(2\times \text{SE}(\hat{p})\)</span> from our observed sample proportion <span class="math inline">\(\hat{p}\)</span>.</p>
<p>Using probability theory, it can be shown generally that if the sampling distribution of a statistic is symmetric and bell shaped, then approximately 95% of all samples will produce sample statistics that lie within two standard errors of the corresponding population parameter. Such an interval is called an approximate 95% <strong>confidence interval</strong> for the population parameter.</p>
<p><strong>Approximate 95% confidence interval: If the sampling distribution of a statistic is symmetric and bell-shaped, a 95% confidence interval for the population parameter is:</strong></p>
<p><span class="math display">\[
\text{Statistic} \pm 2\times \text{Standard Error},
\]</span></p>
<p>More generally, if we want to use a level of confidence that is different than 95%, we can adjust the value we multiply the standard error by. In general, a standard error confidence interval has the form:</p>
<p><span class="math display">\[
\text{Statistic } \pm m\times \text{Standard Error},
\]</span></p>
<p>where the value of <span class="math inline">\(m\)</span> depends on the desired level of confidence.</p>
<p>Confidence intervals that are calculated by adding and subtracting a certain number of standard errors from the sample statistic are called <strong>standard error confidence intervals</strong>. This approach works as long as the sampling distribution is symmetric and bell-shaped. Probability theory tells us that in a symmetric and bell-shaped distribution, approximately 95% of the area lies within two standard errors of the center of the distribution, given by the true parameter value. We will, however, see that this approach will not work in all cases. Not all statistics produce sampling distributions that are symmetric and bell-shaped, and we will need an alternative way to calculate confidence intervals in these situations.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Emp_Rule.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Image from https://openintro-ims.netlify.app/foundations-mathematical</figcaption>
</figure>
</div>
</div>
</div>
<section id="example-95-confidence-interval-for-p" class="level4" data-number="3.2.1.1">
<h4 data-number="3.2.1.1" class="anchored" data-anchor-id="example-95-confidence-interval-for-p"><span class="header-section-number">3.2.1.1</span> Example: 95% Confidence Interval for <span class="math inline">\(p\)</span></h4>
<p>We’ll calculate a 95% confidence interval for the proportion of on-time flights, using our original sample where <span class="math inline">\(\hat{p}\)</span> = 0.52. The 95% confidence interval is:</p>
<p><span class="math display">\[
\begin{aligned}
&amp; \hat{p} \pm 2\times \text{SE}(\hat{p}) \\
&amp; = 0.52 \pm 2(0.056591)
\end{aligned}
\]</span></p>
<p>The confidence interval is calculated below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(p_hat <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_p_hat, p_hat <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_p_hat) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.406818 0.633182</code></pre>
</div>
</div>
<p>Based on our sample of 75 flights, we can be 95% confident that the true proportion of on-time arrivals among all 2013 flights from New York to Chicago is between 0.407 and 0.633.</p>
</section>
<section id="example-95-confidence-interval-for-mu" class="level4" data-number="3.2.1.2">
<h4 data-number="3.2.1.2" class="anchored" data-anchor-id="example-95-confidence-interval-for-mu"><span class="header-section-number">3.2.1.2</span> Example: 95% Confidence Interval for <span class="math inline">\(\mu\)</span></h4>
<p>Likewise, we calculate a 95% confidence interval for average arrival delay using the formula:</p>
<p><span class="math display">\[
\begin{aligned}
\bar{y} \pm 2\times \text{SE}(\bar{y}) \\
&amp; = 19.2 \pm 2(5.5639246)
\end{aligned}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(y_bar <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_y_bar, y_bar <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_y_bar) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  8.072151 30.327849</code></pre>
</div>
</div>
<p>Based on our sample of 75 flights, we can be 95% confident that the mean arrival delay among all 2013 flights from New York to Chicago is between 8.1 and 30.3 minutes.</p>
<p>Note that this is a statement about what we think is true of the mean overall flight time, not the time of an individual flight. It would be incorrect to say that we are 95% confident that an individual flight would be expected to have a delay in this interval. You might think about whether the interval for the delay time of an individual flight should be wider or narrower than this. We’ll talk about such an interval later in the term.</p>
</section>
</section>
<section id="what-does-95-confidence-mean" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="what-does-95-confidence-mean"><span class="header-section-number">3.2.2</span> What does 95% Confidence Mean?</h3>
<p>Knowing what we do about the true value of the population parameters <span class="math inline">\(p\)</span> and <span class="math inline">\(\mu\)</span>, we can see that our interval for <span class="math inline">\(p\)</span>, which was (0.407, 0.633) does indeed contain the true population value of <span class="math inline">\(p=\)</span> 0.6079841. However, the interval for <span class="math inline">\(\mu\)</span>, which was (8.1, 30.3) does not contain the true value of <span class="math inline">\(\mu=\)</span> 7.144772.</p>
<p>Does this mean we did something wrong when we calculated the interval for <span class="math inline">\(\mu\)</span>, the average flight delay among all flights in the population? The answer is “no”. Notice we claimed to be only “95%” confident that our interval contains the true value of the population parameter <span class="math inline">\(\mu\)</span>. This means that we should expect 5% of samples taken randomly to yield a sample mean <span class="math inline">\(\bar{y}\)</span> so different from the population mean <span class="math inline">\(\mu\)</span>, that the resulting confidence interval would not contain the true value of <span class="math inline">\(\mu\)</span>. This does not mean we did anything wrong, just that we obtained an unusual sample just by chance. Since our procedure, namely adding and subtracting two standard errors, is designed to work 95% of the time, we can expect such samples to be rare.</p>
<p>In a real situation, we won’t know the true value of the population parameter, so we won’t know for sure whether or not our confidence interval contains this true parameter value.</p>
<p>To further understand the meaning of “95% confidence”, let’s explore what happens when we calculate confidence intervals based on estimates <span class="math inline">\(\bar{y}\)</span> obtained from many different samples. For each of our 10,000 different samples taken from our population, we’ll add and subtract two standard errors from the sample proportion <span class="math inline">\(\hat{p}\)</span> corresponding to that sample.</p>
<p>The table below displays the value of <span class="math inline">\(\hat{p}\)</span>, for the first 20 samples we took, along with the lower and upper bounds of the confidence interval, and whether or not the confidence interval contains the true parameter value <span class="math inline">\(p\)</span> (either 1=<code>TRUE</code> or 0=<code>FALSE</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>Samples_df_p <span class="ot">&lt;-</span> Samples_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Lower =</span> p_hat_val <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_p_hat, </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Upper =</span> p_hat_val <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_p_hat,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Containsp =</span> p <span class="sc">&gt;=</span> Lower <span class="sc">&amp;</span> p <span class="sc">&lt;=</span> Upper) <span class="sc">|&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">select</span>(Sample, p_hat_val, Lower, Upper, Containsp)  </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Samples_df_p <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>), <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Sample</th>
<th style="text-align: right;">p_hat_val</th>
<th style="text-align: right;">Lower</th>
<th style="text-align: right;">Upper</th>
<th style="text-align: right;">Containsp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The graphic below visualizes the confidence intervals produced using the estimates from the first 100 samples. The green dotted line indicates the true value of <span class="math inline">\(p\)</span>. The black dots indicate the value of <span class="math inline">\(\hat{p}\)</span> for each sample. Intervals that do in fact contain the true value of <span class="math inline">\(p\)</span> are shown in blue, and intervals that do not contain the true value of <span class="math inline">\(p\)</span> are shown in green.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Samples_df_p[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,], <span class="fu">aes</span>(<span class="at">y=</span>Sample, <span class="at">x=</span>p_hat_val)) <span class="sc">+</span>    </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> Lower, <span class="at">xmax =</span> Upper, <span class="at">color=</span>Containsp))  <span class="sc">+</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Confidence Interval"</span>) <span class="sc">+</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Sample"</span>) <span class="sc">+</span> </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> p, <span class="at">color=</span><span class="st">"green"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"100 Different Confidence Intervals for p"</span>) <span class="sc">+</span> </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Out of these 100 samples, 93 contain the true value of the population parameter <span class="math inline">\(p\)</span>. This is close to the desired 95% confidence level.</p>
<p>The picture shows confidence intervals produced by the first 100 samples, but we actually took 10,000 different samples of 75 flights. Let’s calculate how many of these samples produced confidence intervals that contain the true value of <span class="math inline">\(p\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(Samples_df_p<span class="sc">$</span>Contains <span class="sc">==</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9539</code></pre>
</div>
</div>
<p>Again, notice that close to 95% of the samples produced confidence intervals contain the true population parameter <span class="math inline">\(p\)</span>. Note that for the red intervals that do not contain <span class="math inline">\(p\)</span> nothing was done incorrectly. The sample was taken at random, and the confidence interval was calculated using the correct formula. It just happened that by chance, we obtained a sample proportion <span class="math inline">\(\hat{p}\)</span> that was unusually high or low, leading to an interval that did not capture the true population parameter. This, of course, happens rarely, and approximately 95% of the samples do, in fact, result in intervals that contain the true value of <span class="math inline">\(p\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>Samples_df_mu <span class="ot">&lt;-</span> Samples_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Lower =</span> y_bar_val <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_y_bar, </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Upper =</span> y_bar_val <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_y_bar,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Containsmu =</span> mu <span class="sc">&gt;=</span> Lower <span class="sc">&amp;</span> mu <span class="sc">&lt;=</span> Upper) <span class="sc">|&gt;</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">select</span>(Sample, y_bar_val, Lower, Upper, Containsmu)  </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Samples_df_mu <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>), <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Sample</th>
<th style="text-align: right;">y_bar_val</th>
<th style="text-align: right;">Lower</th>
<th style="text-align: right;">Upper</th>
<th style="text-align: right;">Containsmu</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.16</td>
<td style="text-align: right;">-4.97</td>
<td style="text-align: right;">17.29</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">10.75</td>
<td style="text-align: right;">-0.38</td>
<td style="text-align: right;">21.87</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">12.41</td>
<td style="text-align: right;">1.29</td>
<td style="text-align: right;">23.54</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2.24</td>
<td style="text-align: right;">-8.89</td>
<td style="text-align: right;">13.37</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.33</td>
<td style="text-align: right;">-3.79</td>
<td style="text-align: right;">18.46</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1.28</td>
<td style="text-align: right;">-9.85</td>
<td style="text-align: right;">12.41</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">3.25</td>
<td style="text-align: right;">-7.87</td>
<td style="text-align: right;">14.38</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">8.93</td>
<td style="text-align: right;">-2.19</td>
<td style="text-align: right;">20.06</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">-3.16</td>
<td style="text-align: right;">-14.29</td>
<td style="text-align: right;">7.97</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">5.73</td>
<td style="text-align: right;">-5.39</td>
<td style="text-align: right;">16.86</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">12.32</td>
<td style="text-align: right;">1.19</td>
<td style="text-align: right;">23.45</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">8.79</td>
<td style="text-align: right;">-2.34</td>
<td style="text-align: right;">19.91</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: right;">5.53</td>
<td style="text-align: right;">-5.59</td>
<td style="text-align: right;">16.66</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: right;">10.55</td>
<td style="text-align: right;">-0.58</td>
<td style="text-align: right;">21.67</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: right;">5.40</td>
<td style="text-align: right;">-5.73</td>
<td style="text-align: right;">16.53</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td style="text-align: right;">24.11</td>
<td style="text-align: right;">12.98</td>
<td style="text-align: right;">35.23</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: right;">15.93</td>
<td style="text-align: right;">4.81</td>
<td style="text-align: right;">27.06</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">4.45</td>
<td style="text-align: right;">-6.67</td>
<td style="text-align: right;">15.58</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: right;">6.76</td>
<td style="text-align: right;">-4.37</td>
<td style="text-align: right;">17.89</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: right;">3.65</td>
<td style="text-align: right;">-7.47</td>
<td style="text-align: right;">14.78</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The graphic below visualizes the confidence intervals produced using the estimates from the first 100 samples. The green dotted line indicates the true value of <span class="math inline">\(p\)</span>. The black dots indicate the value of <span class="math inline">\(\hat{p}\)</span> for each sample. Intervals that do in fact contain the true value of <span class="math inline">\(p\)</span> are shown in blue, and intervals that do not contain the true value of <span class="math inline">\(p\)</span> are shown in green.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Samples_df_mu[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,], <span class="fu">aes</span>(<span class="at">y=</span>Sample, <span class="at">x=</span>y_bar_val)) <span class="sc">+</span>    </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> Lower, <span class="at">xmax =</span> Upper, <span class="at">color=</span>Containsmu))  <span class="sc">+</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Confidence Interval"</span>) <span class="sc">+</span> </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Sample"</span>) <span class="sc">+</span> </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> mu, <span class="at">color=</span><span class="st">"green"</span>, <span class="at">linetype=</span><span class="st">"dotted"</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"100 Different Confidence Intervals for "</span>, mu))) <span class="sc">+</span> </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Out of these 100 samples, 92 contain the true value of the population parameter <span class="math inline">\(\mu\)</span>.</p>
<p>Out of all 10,000 samples, the proportion containing the true population value of <span class="math inline">\(\mu\)</span> is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(Samples_df_mu<span class="sc">$</span>Containsmu <span class="sc">==</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9570</code></pre>
</div>
</div>
<p>This brings us back to the question “what does 95% confidence mean?”. An approximate 95% confidence interval means that if we take a large number of samples and calculate confidence intervals from each of them, then approximately 95% of the samples will produce intervals containing the true population parameter. In reality, we’ll only have on sample, and won’t know whether or not our interval contains the true parameter value. Assuming we have taken the sample and calculated the interval correctly, we can rest assured in the knowledge that that 95% of all intervals taken would contain the true parameter value, and hope that ours is among that 95%.</p>
<p>It might be tempting to say that “there is approximately a 95% chance” that the population parameter lies within the confidence interval, but this is incorrect. In the statistical framework used here (known as classical, or frequentist statistics), the population parameter is assumed to be a fixed, but (typically) unknown number. It either is within the interval, or it isn’t. We just (typically) don’t know which. There’s nothing random about whether or not the parameter value is in our interval, so it doesn’t make sense to speak of it in terms of chance or randomness. Randomness comes into play due to the fact that we selected a random sample, which will produce a statistic likely to differ from the population parameter due to sampling variability. A different statistical framework, known as <em>Bayesian statistics</em> approaches this differently, and would allow us to use randomness and chance to describe our beliefs about any uncertain quantity, including a population proportion. In this class, however, we’ll stick to the classical frequentist interpretation.</p>
<p>Of course, you might ask why we needed to calculate a confidence interval for the proportion of on-time flights in the first place, since we actually have data on all 20,591 flights in the population and already know the true proportion of on-time arrivals and mean arrival delay. The answer is that we don’t. But, in most real situations, we will only have data from a single sample, not the entire population, and we won’t know the true population parameter. We’ll be able to build on the ideas of sampling distributions and standard error that we learned about in this section to calculate confidence intervals in those scenarios.</p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="bootstrapping" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="bootstrapping"><span class="header-section-number">3.3</span> Bootstrapping</h2>
<section id="mercury-concentration-in-florida-lakes" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="mercury-concentration-in-florida-lakes"><span class="header-section-number">3.3.1</span> Mercury Concentration in Florida Lakes</h3>
<p>A 2004 study by Lange, T., Royals, H. and Connor, L. examined Mercury accumulation in large-mouth bass, taken from a sample of 53 Florida Lakes. If Mercury accumulation exceeds 0.5 ppm, then there are environmental concerns. In fact, the legal safety limit in Canada is 0.5 ppm, although it is 1 ppm in the United States.</p>
<p>In our sample, we have data on 53 lakes, out of more than 30,000 lakes in the the state of Florida. We’ll attempt to draw conclusions about the entire population, consisting of all lakes in Florida, using data from our sample of 53. It is not clear how the lakes in this sample of 53 were selected, or how representative they are of all lakes in the state of Florida. Let’s assume for our purposes that the lakes in the sample can be reasonably thought of as being representative of all lakes in Florida.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Bass.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">https://www.maine.gov/ifw/fish-wildlife/fisheries/species-information/largemouth-bass.html</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"FloridaLakes"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(FloridaLakes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 53
Columns: 12
$ ID                &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…
$ Lake              &lt;chr&gt; "Alligator", "Annie", "Apopka", "Blue Cypress", "Bri…
$ Alkalinity        &lt;dbl&gt; 5.9, 3.5, 116.0, 39.4, 2.5, 19.6, 5.2, 71.4, 26.4, 4…
$ pH                &lt;dbl&gt; 6.1, 5.1, 9.1, 6.9, 4.6, 7.3, 5.4, 8.1, 5.8, 6.4, 5.…
$ Calcium           &lt;dbl&gt; 3.0, 1.9, 44.1, 16.4, 2.9, 4.5, 2.8, 55.2, 9.2, 4.6,…
$ Chlorophyll       &lt;dbl&gt; 0.7, 3.2, 128.3, 3.5, 1.8, 44.1, 3.4, 33.7, 1.6, 22.…
$ AvgMercury        &lt;dbl&gt; 1.23, 1.33, 0.04, 0.44, 1.20, 0.27, 0.48, 0.19, 0.83…
$ NumSamples        &lt;int&gt; 5, 7, 6, 12, 12, 14, 10, 12, 24, 12, 12, 12, 7, 43, …
$ MinMercury        &lt;dbl&gt; 0.85, 0.92, 0.04, 0.13, 0.69, 0.04, 0.30, 0.08, 0.26…
$ MaxMercury        &lt;dbl&gt; 1.43, 1.90, 0.06, 0.84, 1.50, 0.48, 0.72, 0.38, 1.40…
$ ThreeYrStdMercury &lt;dbl&gt; 1.53, 1.33, 0.04, 0.44, 1.33, 0.25, 0.45, 0.16, 0.72…
$ AgeData           &lt;int&gt; 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1…</code></pre>
</div>
</div>
<p>We are interested in whether mercury levels are higher or lower, on average, in Northern Florida compared to Southern Florida.</p>
<p>We’ll divide the state along route 50, which runs East-West, passing through Northern Orlando.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Florida.png" class="img-fluid figure-img" style="width:30.0%"></p>
<figcaption class="figure-caption">from Google Maps</figcaption>
</figure>
</div>
</div>
</div>
<p>We add a variable indicating whether each lake lies in the northern or southern part of the state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Lock5Data)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(FloridaLakes)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Location relative to rt. 50</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>FloridaLakes<span class="sc">$</span>Location <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>))</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>FloridaLakes <span class="ot">&lt;-</span> FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Mercury =</span> AvgMercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our data come from a sample of 53 lakes, out of more then 30,000 in the entire state of Florida. The mercury levels of the 53 lakes in the sample are shown in the table below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print.data.frame</span>(<span class="fu">data.frame</span>(FloridaLakes<span class="sc">%&gt;%</span> <span class="fu">select</span>(Lake, Location, Mercury)), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Lake Location Mercury
         Alligator        S    1.23
             Annie        S    1.33
            Apopka        N    0.04
      Blue Cypress        S    0.44
             Brick        S    1.20
            Bryant        N    0.27
            Cherry        N    0.48
          Crescent        N    0.19
        Deer Point        N    0.83
              Dias        N    0.81
              Dorr        N    0.71
              Down        S    0.50
             Eaton        N    0.49
 East Tohopekaliga        S    1.16
           Farm-13        N    0.05
            George        N    0.15
           Griffin        N    0.19
            Harney        N    0.77
              Hart        S    1.08
        Hatchineha        S    0.98
           Iamonia        N    0.63
         Istokpoga        S    0.56
           Jackson        N    0.41
         Josephine        S    0.73
          Kingsley        N    0.34
         Kissimmee        S    0.59
         Lochloosa        N    0.34
            Louisa        S    0.84
        Miccasukee        N    0.50
          Minneola        N    0.34
            Monroe        N    0.28
           Newmans        N    0.34
        Ocean Pond        N    0.87
      Ocheese Pond        N    0.56
        Okeechobee        S    0.17
            Orange        N    0.18
       Panasoffkee        N    0.19
            Parker        S    0.04
            Placid        S    0.49
            Puzzle        N    1.10
            Rodman        N    0.16
          Rousseau        N    0.10
           Sampson        N    0.48
             Shipp        S    0.21
           Talquin        N    0.86
            Tarpon        S    0.52
      Tohopekaliga        S    0.65
          Trafford        S    0.27
             Trout        S    0.94
      Tsala Apopka        N    0.40
              Weir        N    0.43
           Wildcat        N    0.25
              Yale        N    0.27</code></pre>
</div>
</div>
<p>The histogram shows the distribution of mercury levels in the 53 lakes in the sample. Lakes exceeding the US standard of 1 ppm are shown in red.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>Lakes_Hist <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>FloridaLakes, <span class="fu">aes</span>(<span class="at">x=</span>Mercury)) <span class="sc">+</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">fill=</span>Mercury<span class="sc">&lt;=</span><span class="dv">1</span>), <span class="at">color=</span><span class="st">"white"</span>, <span class="at">binwidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Mercury Levels in Sample of 53 Florida Lakes"</span>) <span class="sc">+</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Mercury Level"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>Lakes_Hist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The proportion of lakes with mercury levels exceeding 1 ppm is calculated below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>p_hat <span class="ot">&lt;-</span> <span class="fu">sum</span>(FloridaLakes<span class="sc">$</span>Mercury <span class="sc">&gt;</span> <span class="dv">1</span>)<span class="sc">/</span><span class="dv">53</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>p_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1132075</code></pre>
</div>
</div>
<p>We see that in our sample of 53 lakes, approximately 11% have mercury levels exceeding the US standard of 1 ppm. Suppose we want to estimate the proportion of all Florida Lakes whose mercury level exceeds this standard. As we saw in the previous section, we would not expect the population proportion to exactly match the sample, due to random variability between samples. We can use the sample proportion as an estimate (<span class="math inline">\(\hat{p} = 0.1132\)</span>), and construct a confidence interval for the unknown population proportion <span class="math inline">\(p\)</span>.</p>
<p>In order to construct the confidence interval, we need to know how much the sample proportion of lakes exceeding 1 ppm <span class="math inline">\(\hat{p}\)</span> could vary between different samples of size 53. That is, we need to know the standard error of <span class="math inline">\(\hat{p}\)</span>. In the previous section, we calculated the standard error by taking 10,000 different samples of the same size as ours from the population, calculating the proportion for each sample, and then calculating the standard deviation of the proportions obtained from these 10,000 different samples. This procedure will not work here, however, because unlike the previous example where we really did have data on the entire population of all flights from New York to Chicago, we do not have data on all 30,000+ lakes in Florida. We cannot take a lot of different samples of size 53 from the population of all lakes, and thus, cannot obtain the sampling distribution for the the proportion of lakes exceeding 1 ppm, or estimate the standard error of <span class="math inline">\(\hat{p}\)</span>.</p>
</section>
<section id="bootstrap-sampling" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="bootstrap-sampling"><span class="header-section-number">3.3.2</span> Bootstrap Sampling</h3>
<p>All we have is a single sample of 53 lakes. We need to figure out how much the proportion of lakes with mercury levels exceeding 1 ppm would vary between different samples of size 53, using only the information contained in our one sample.</p>
<p>To do this, we’ll implement a popular simulation-based strategy, known as <strong>bootstrapping</strong>.</p>
<p>Let’s assume our sample is representative of all Florida lakes. Then, we’ll duplicate the sample many times to create a large set that will look like the population of all Florida Lakes. We can then draw samples of 53 from that large population, and record the mean mercury level for each sample of 53.</p>
<p>An illustration of the bootstrapping procedure is shown below, using a sample of 12 colored dots, instead of the 53 lakes.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Bootstrap_Idea.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p>In fact, duplicating the sample many times and selecting new samples of size <span class="math inline">\(n\)</span> has the same effect as drawing samples of size <span class="math inline">\(n\)</span> from the original sample, by putting the item drawn back in each time, a procedure called <strong>sampling with replacement</strong>. Thus, we can skip the step of copying/pasting the sample many times, and instead draw our samples with replacement.</p>
<p>This means that in each new sample, some lakes will be drawn multiple times and others not at all. It also ensures that each sample is different, allowing us to estimate variability in the sample mean between the different samples of size 53.</p>
<p>An illustration of the concept of bootstrapping, using sampling with replacement is shown below.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Bootstrap.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p>The variability in sample means in our newly drawn samples is used to approximate the variability in proportion <span class="math inline">\(\hat{p}\)</span> that would occur between different samples of 53 lakes, drawn from the population of all Florida Lakes.</p>
<p>The point of bootstrapping is to observe how much a statistic (in this case the proportion of lakes with Mercury levels exceeding 1 ppm) varies between bootstrap samples. This can act as an estimate of how much that statistic would vary between different samples of size <span class="math inline">\(n\)</span>, drawn from the population.</p>
<p>The steps of bootstrap sampling can be summarized in the following algorithm.</p>
<p><strong>Bootstrap Algorithm</strong></p>
<p>For an original sample of size <span class="math inline">\(n\)</span>:</p>
<ol type="1">
<li><p>Take a sample size <span class="math inline">\(n\)</span> by randomly sampling from the original, with replacement. Thus, some observations will show up multiple times, and others not at all. This sample is called a <strong>bootstrap sample</strong>.</p></li>
<li><p>Calculate the statistic of interest in the bootstrap sample (in this case <span class="math inline">\(\hat{p}\)</span>, the proportion of lakes whose mercury levels exceed 1 ppm).</p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, keeping track of the statistic of interest that is calculated in each bootstrap sample.</p></li>
<li><p>Look at the distribution of the statistic across bootstrap samples. The variability in this bootstrap distribution can be used to approximate the variability in the sampling distribution for the statistic of interest.</p></li>
</ol>
</section>
<section id="bootstrap-samples-of-lakes" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="bootstrap-samples-of-lakes"><span class="header-section-number">3.3.3</span> Bootstrap Samples of Lakes</h3>
<p>The <code>sample_n()</code> function samples the specified number rows from a data frame, with or without replacement.</p>
<p>The lakes in the first sample are shown below. Notice that some lakes occur multiple times, and others not at all.</p>
<p><strong>Bootstrap Sample 1</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample1 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes, <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Lake)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>BootstrapSample1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, Lake, Mercury) <span class="sc">|&gt;</span> <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">ID</th>
<th style="text-align: left;">Lake</th>
<th style="text-align: right;">Mercury</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Apopka</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Blue Cypress</td>
<td style="text-align: right;">0.44</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Blue Cypress</td>
<td style="text-align: right;">0.44</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Brick</td>
<td style="text-align: right;">1.20</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Brick</td>
<td style="text-align: right;">1.20</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Brick</td>
<td style="text-align: right;">1.20</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">Bryant</td>
<td style="text-align: right;">0.27</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">Bryant</td>
<td style="text-align: right;">0.27</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">Cherry</td>
<td style="text-align: right;">0.48</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">Dias</td>
<td style="text-align: right;">0.81</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">Dias</td>
<td style="text-align: right;">0.81</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">Dias</td>
<td style="text-align: right;">0.81</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: left;">Eaton</td>
<td style="text-align: right;">0.49</td>
</tr>
<tr class="even">
<td style="text-align: right;">17</td>
<td style="text-align: left;">Griffin</td>
<td style="text-align: right;">0.19</td>
</tr>
<tr class="odd">
<td style="text-align: right;">18</td>
<td style="text-align: left;">Harney</td>
<td style="text-align: right;">0.77</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: left;">Harney</td>
<td style="text-align: right;">0.77</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: left;">Hart</td>
<td style="text-align: right;">1.08</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: left;">Hatchineha</td>
<td style="text-align: right;">0.98</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22</td>
<td style="text-align: left;">Istokpoga</td>
<td style="text-align: right;">0.56</td>
</tr>
<tr class="even">
<td style="text-align: right;">22</td>
<td style="text-align: left;">Istokpoga</td>
<td style="text-align: right;">0.56</td>
</tr>
<tr class="odd">
<td style="text-align: right;">23</td>
<td style="text-align: left;">Jackson</td>
<td style="text-align: right;">0.41</td>
</tr>
<tr class="even">
<td style="text-align: right;">25</td>
<td style="text-align: left;">Kingsley</td>
<td style="text-align: right;">0.34</td>
</tr>
<tr class="odd">
<td style="text-align: right;">25</td>
<td style="text-align: left;">Kingsley</td>
<td style="text-align: right;">0.34</td>
</tr>
<tr class="even">
<td style="text-align: right;">26</td>
<td style="text-align: left;">Kissimmee</td>
<td style="text-align: right;">0.59</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27</td>
<td style="text-align: left;">Lochloosa</td>
<td style="text-align: right;">0.34</td>
</tr>
<tr class="even">
<td style="text-align: right;">30</td>
<td style="text-align: left;">Minneola</td>
<td style="text-align: right;">0.34</td>
</tr>
<tr class="odd">
<td style="text-align: right;">32</td>
<td style="text-align: left;">Newmans</td>
<td style="text-align: right;">0.34</td>
</tr>
<tr class="even">
<td style="text-align: right;">33</td>
<td style="text-align: left;">Ocean Pond</td>
<td style="text-align: right;">0.87</td>
</tr>
<tr class="odd">
<td style="text-align: right;">34</td>
<td style="text-align: left;">Ocheese Pond</td>
<td style="text-align: right;">0.56</td>
</tr>
<tr class="even">
<td style="text-align: right;">35</td>
<td style="text-align: left;">Okeechobee</td>
<td style="text-align: right;">0.17</td>
</tr>
<tr class="odd">
<td style="text-align: right;">37</td>
<td style="text-align: left;">Panasoffkee</td>
<td style="text-align: right;">0.19</td>
</tr>
<tr class="even">
<td style="text-align: right;">37</td>
<td style="text-align: left;">Panasoffkee</td>
<td style="text-align: right;">0.19</td>
</tr>
<tr class="odd">
<td style="text-align: right;">38</td>
<td style="text-align: left;">Parker</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="even">
<td style="text-align: right;">38</td>
<td style="text-align: left;">Parker</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="odd">
<td style="text-align: right;">40</td>
<td style="text-align: left;">Puzzle</td>
<td style="text-align: right;">1.10</td>
</tr>
<tr class="even">
<td style="text-align: right;">40</td>
<td style="text-align: left;">Puzzle</td>
<td style="text-align: right;">1.10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">40</td>
<td style="text-align: left;">Puzzle</td>
<td style="text-align: right;">1.10</td>
</tr>
<tr class="even">
<td style="text-align: right;">41</td>
<td style="text-align: left;">Rodman</td>
<td style="text-align: right;">0.16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">41</td>
<td style="text-align: left;">Rodman</td>
<td style="text-align: right;">0.16</td>
</tr>
<tr class="even">
<td style="text-align: right;">42</td>
<td style="text-align: left;">Rousseau</td>
<td style="text-align: right;">0.10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">43</td>
<td style="text-align: left;">Sampson</td>
<td style="text-align: right;">0.48</td>
</tr>
<tr class="even">
<td style="text-align: right;">43</td>
<td style="text-align: left;">Sampson</td>
<td style="text-align: right;">0.48</td>
</tr>
<tr class="odd">
<td style="text-align: right;">44</td>
<td style="text-align: left;">Shipp</td>
<td style="text-align: right;">0.21</td>
</tr>
<tr class="even">
<td style="text-align: right;">44</td>
<td style="text-align: left;">Shipp</td>
<td style="text-align: right;">0.21</td>
</tr>
<tr class="odd">
<td style="text-align: right;">45</td>
<td style="text-align: left;">Talquin</td>
<td style="text-align: right;">0.86</td>
</tr>
<tr class="even">
<td style="text-align: right;">51</td>
<td style="text-align: left;">Tohopekaliga</td>
<td style="text-align: right;">0.65</td>
</tr>
<tr class="odd">
<td style="text-align: right;">51</td>
<td style="text-align: left;">Tohopekaliga</td>
<td style="text-align: right;">0.65</td>
</tr>
<tr class="even">
<td style="text-align: right;">51</td>
<td style="text-align: left;">Tohopekaliga</td>
<td style="text-align: right;">0.65</td>
</tr>
<tr class="odd">
<td style="text-align: right;">48</td>
<td style="text-align: left;">Trout</td>
<td style="text-align: right;">0.94</td>
</tr>
<tr class="even">
<td style="text-align: right;">48</td>
<td style="text-align: left;">Trout</td>
<td style="text-align: right;">0.94</td>
</tr>
<tr class="odd">
<td style="text-align: right;">52</td>
<td style="text-align: left;">Wildcat</td>
<td style="text-align: right;">0.25</td>
</tr>
<tr class="even">
<td style="text-align: right;">52</td>
<td style="text-align: left;">Wildcat</td>
<td style="text-align: right;">0.25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">53</td>
<td style="text-align: left;">Yale</td>
<td style="text-align: right;">0.27</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We calculate the proportion of lakes with mercury levels exceeding 1 ppm in this bootstrap sample. Note that if a lake shows up more than once in the bootstrap sample, then it is counted however many times it shows up.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(BootstrapSample1<span class="sc">$</span>Mercury <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">53</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1320755</code></pre>
</div>
</div>
<p><strong>Bootstrap Sample #2</strong></p>
<p>We take a second bootstrap sample. We display only the first 10 lakes, though the bootstrap sample still has 53 lakes.</p>
<p>Notice that the lakes chosen and omitted differ from the first sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample2 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes, <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Lake)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>BootstrapSample2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, Lake, Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 3
      ID Lake         Mercury
   &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;
 1     1 Alligator       1.23
 2     3 Apopka          0.04
 3     4 Blue Cypress    0.44
 4     5 Brick           1.2 
 5     6 Bryant          0.27
 6     7 Cherry          0.48
 7     9 Deer Point      0.83
 8    10 Dias            0.81
 9    10 Dias            0.81
10    11 Dorr            0.71
# ℹ 43 more rows</code></pre>
</div>
</div>
<p>Proportion exceeding 1 ppm:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(BootstrapSample2<span class="sc">$</span>Mercury <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">53</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0754717</code></pre>
</div>
</div>
<p><strong>Bootstrap Sample #3</strong></p>
<p>We’ll take one more bootstrap sample and calculate the proportion of lakes with mercury levels exceeding 1 ppm. The first 10 lakes in this third sample are shown.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample3 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes, <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Lake)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>BootstrapSample3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, Lake, Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 3
      ID Lake       Mercury
   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
 1     1 Alligator     1.23
 2     3 Apopka        0.04
 3     3 Apopka        0.04
 4     5 Brick         1.2 
 5     5 Brick         1.2 
 6     7 Cherry        0.48
 7     7 Cherry        0.48
 8     8 Crescent      0.19
 9     9 Deer Point    0.83
10    10 Dias          0.81
# ℹ 43 more rows</code></pre>
</div>
</div>
<p>Proportion exceeding 1 ppm:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(BootstrapSample3<span class="sc">$</span>Mercury <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">53</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1132075</code></pre>
</div>
</div>
</section>
<section id="bootstrap-distribution" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="bootstrap-distribution"><span class="header-section-number">3.3.4</span> Bootstrap Distribution</h3>
<p>Now that we have seen how bootstrap sampling works, we’ll take a large number (10,000) different bootstrap samples and examine how the proportion of lakes with mercury levels exceeding 1 ppm varies between samples.</p>
<p>We’ll use a <code>for-loop</code> to take many different bootstrap samples and record the observed proportion in a vector called <code>p_hat_b</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>p_hat <span class="ot">&lt;-</span> <span class="fu">sum</span>(FloridaLakes<span class="sc">$</span>Mercury <span class="sc">&gt;</span> <span class="dv">1</span>)<span class="sc">/</span><span class="dv">53</span> <span class="co">#calculate sample statistic</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>Bootstrap_prop <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>)   <span class="co">#setup vector to hold bootstrap statistics</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>){</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>BootstrapSample <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes, <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="co">#take bootstrap sample</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>Bootstrap_prop[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(BootstrapSample<span class="sc">$</span>Mercury <span class="sc">&gt;</span> <span class="dv">1</span>)<span class="sc">/</span><span class="dv">53</span> <span class="co"># calc. prop exceeding 1</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Prop <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Bootstrap_prop)  <span class="co">#store values in a dataframe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The distribution of proportions observed in the 10,000 different bootstrap samples is shown below. This distribution is called the <strong>bootstrap distribution.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Prop_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Lakes_Bootstrap_Prop, <span class="fu">aes</span>(<span class="at">x=</span>Bootstrap_prop)) <span class="sc">+</span>  </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">binwidth=</span><span class="fl">0.02</span>) <span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Prop &gt; 1 in Bootstrap Sample "</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Bootstrap Distribution for Prop. of Lakes Exeeding 1 ppm Hg"</span>) <span class="sc">+</span> </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Prop_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The bootstrap distribution is meant to approximate the sampling distribution of the statistic of interest (in this case the proportion exceeding 1 ppm). Because it is based on the sample, the bootstrap distribution will be centered at the sample statistic (<span class="math inline">\(\hat{p}\)</span> in this case) while the sampling distribution would have been centered at the population parameter (<span class="math inline">\(p\)</span>), which is unknown. The important things, however, is that the variability in the bootstrap distribution gives a good approximation of the amount of variability in the sampling distribution, so we can use the standard deviation of the bootstrap distribution (called <strong>bootstrap standard error</strong>) in our confidence interval calculation.</p>
</section>
<section id="bootstrap-se-confidence-interval" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="bootstrap-se-confidence-interval"><span class="header-section-number">3.3.5</span> Bootstrap SE Confidence Interval</h3>
<p>We calculate the standard deviation of this bootstrap distribution, which is an estimate of the standard error of <span class="math inline">\(\hat{p}\)</span>. It measures how much the proportion of lakes exceeding 1 ppm varies between samples of size 53.</p>
<p><strong>Bootstrap Standard Error:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>SE_p_hat <span class="ot">&lt;-</span> <span class="fu">sd</span>(Lakes_Bootstrap_Prop<span class="sc">$</span>Bootstrap_prop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since the bootstrap distribution is roughly symmetric and bell-shaped, we can calculate a 95% confidence interval for the proportion of all Florida lakes with mercury levels exceeding 1 ppm, using bootstrap standard error confidence interval method.</p>
<p><span class="math display">\[
\hat{p} \pm 2\times\text{SE}(\hat{p})
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(p_hat <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_p_hat, p_hat <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_p_hat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02684273 0.19957237</code></pre>
</div>
</div>
<p>The gold bar at the bottom of the bootstrap distribution represents this 95% confidence interval.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Prop_plot <span class="sc">+</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>p_hat <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_p_hat,<span class="at">xend=</span>p_hat <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_p_hat, <span class="at">y=</span><span class="dv">50</span>, <span class="at">yend=</span><span class="dv">50</span>),</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">"gold"</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">alpha=</span><span class="fl">0.01</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We are 95% confident that the proportion of all Florida lakes with mercury levels exceeding 1 ppm is between 0.0268 and 0.1996.</p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="more-bootstrap-examples" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="more-bootstrap-examples"><span class="header-section-number">3.4</span> More Bootstrap Examples</h2>
<section id="bootstrapping-other-statistics" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="bootstrapping-other-statistics"><span class="header-section-number">3.4.1</span> Bootstrapping Other Statistics</h3>
<p>We’ve seen how to use bootstrapping to calculate confidence intervals for an unknown population parameter <span class="math inline">\(p\)</span>, using an estimate <span class="math inline">\(\hat{p}\)</span>, calculated from a sample of size <span class="math inline">\(n\)</span>. This procedure can be applied to calculate confidence intervals for a wide range of population parameters, using statistics calculated from a sample.</p>
<p>For example, we could calculate confidence intervals any of the following parameters, using the corresponding sample statistic.</p>
<table class="table">
<colgroup>
<col style="width: 36%">
<col style="width: 31%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Context</th>
<th>Parameter</th>
<th>Statistic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Proportion</td>
<td><span class="math inline">\(p\)</span></td>
<td><span class="math inline">\(\hat{p}\)</span></td>
</tr>
<tr class="even">
<td>Mean</td>
<td><span class="math inline">\(\mu\)</span></td>
<td><span class="math inline">\(\bar{x}\)</span></td>
</tr>
<tr class="odd">
<td>Standard Deviation</td>
<td><span class="math inline">\(\sigma\)</span></td>
<td><span class="math inline">\(s\)</span></td>
</tr>
<tr class="even">
<td>Median</td>
<td>no common abbreviations</td>
<td></td>
</tr>
<tr class="odd">
<td>Difference in Means</td>
<td><span class="math inline">\(\mu_2-\mu_1\)</span></td>
<td><span class="math inline">\(\bar{x}_2 - \bar{x}_1\)</span></td>
</tr>
<tr class="even">
<td>Regression Coefficient</td>
<td><span class="math inline">\(\beta_j\)</span></td>
<td><span class="math inline">\(b_j\)</span></td>
</tr>
<tr class="odd">
<td>Estimated Regression Response</td>
<td><span class="math inline">\(\beta_0 + \beta_1x_{i1} + \ldots + \beta_px_{ip}\)</span></td>
<td><span class="math inline">\(b_0 + b_1x_{i1} + \ldots + b_px_{ip}\)</span></td>
</tr>
</tbody>
</table>
<p>We follow the same algorithm as we did when working with a proportion, and simply calculate whatever statistic we are interested in step 2, in place of <span class="math inline">\(\hat{p}\)</span>, as we did previously.</p>
<p>The bootstrap algorithm is given again, below.</p>
<p><strong>Bootstrap Algorithm</strong></p>
<p>For an original sample of size <span class="math inline">\(n\)</span>:</p>
<ol type="1">
<li><p>Take a sample of size <span class="math inline">\(n\)</span> by randomly sampling from the original sample with replacement. (Thus some observations will show up multiple times and others not at all.)</p></li>
<li><p>Calculate the statistic of interest in the bootstrap sample.</p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, keeping track of the statistic of interest that is calculated in each bootstrap sample.</p></li>
<li><p>Look at the distribution of the statistic across bootstrap samples. The variability in this bootstrap distribution can be used to approximate the variability in the sampling distribution for the statistic of interest.</p></li>
</ol>
<p>We’ll now go through examples, calculating bootstrap confidence intervals for each of the parameters listed above.</p>
</section>
<section id="ci-for-mean" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="ci-for-mean"><span class="header-section-number">3.4.2</span> CI for Mean</h3>
<p>The histogram shows the distribution of mercury levels of the 53 lakes in our sample. The mean and standard deviation in mercury levels for these 53 lakes is shown.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>Lakes_Hist <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>FloridaLakes, <span class="fu">aes</span>(<span class="at">x=</span>Mercury)) <span class="sc">+</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">binwidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Mercury Levels in Sample of Florida Lakes"</span>) <span class="sc">+</span> </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Mercury Level"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>Lakes_Hist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We’ll calculate the mean and median mercury level for the 53 lakes in the sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>Lakes_Stats <span class="ot">&lt;-</span> FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">MeanHg =</span> <span class="fu">mean</span>(Mercury), </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">StDevHG =</span> <span class="fu">sd</span>(Mercury),</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">N=</span><span class="fu">n</span>())</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(Lakes_Stats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">MeanHg</th>
<th style="text-align: right;">StDevHG</th>
<th style="text-align: right;">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.5271698</td>
<td style="text-align: right;">0.3410356</td>
<td style="text-align: right;">53</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We want to calculate a 95% confidence interval for the mean mercury level among all Florida lakes. We’ll use bootstrapping again, this time using the sample mean, rather than the proportion exceeding 1 ppm, as our statistic of interest.</p>
<p><strong>Bootstrap Steps</strong></p>
<ol type="1">
<li><p>Take a sample of 53 lakes by randomly sampling from the original sample of 53 lakes, with replacement.</p></li>
<li><p>Calculate the mean mercury level in the bootstrap sample.</p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, keeping track of the mean mercury level in each bootstrap sample.</p></li>
<li><p>Look at the distribution of the mean across bootstrap samples. The variability in this bootstrap distribution can be used to approximate the variability in the sampling distribution for the mean mercury level.</p></li>
</ol>
<p>We’ll illustrate the procedure on 3 bootstrap samples.</p>
<p><strong>Bootstrap Sample 1</strong></p>
<p>The first 10 lakes in the bootstrap sample are shown below. Notice again that some lakes occur multiple times, and others not at all.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample1 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes, <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Lake)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>BootstrapSample1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, Lake, Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 3
      ID Lake       Mercury
   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
 1     1 Alligator     1.23
 2     2 Annie         1.33
 3     2 Annie         1.33
 4     3 Apopka        0.04
 5     3 Apopka        0.04
 6     3 Apopka        0.04
 7     3 Apopka        0.04
 8     6 Bryant        0.27
 9     9 Deer Point    0.83
10     9 Deer Point    0.83
# ℹ 43 more rows</code></pre>
</div>
</div>
<p>We calculate the mean mercury level among the lakes in the bootstrap sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(BootstrapSample1<span class="sc">$</span>Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4790566</code></pre>
</div>
</div>
<p><strong>Bootstrap Sample #2</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample2 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes, <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Lake)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>BootstrapSample2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, Lake, Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 3
      ID Lake       Mercury
   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
 1     1 Alligator     1.23
 2     1 Alligator     1.23
 3     1 Alligator     1.23
 4     2 Annie         1.33
 5     5 Brick         1.2 
 6     6 Bryant        0.27
 7     8 Crescent      0.19
 8     8 Crescent      0.19
 9     9 Deer Point    0.83
10     9 Deer Point    0.83
# ℹ 43 more rows</code></pre>
</div>
</div>
<p>Mean Mercury Level:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(BootstrapSample2<span class="sc">$</span>Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5479245</code></pre>
</div>
</div>
<p><strong>Bootstrap Sample #3</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample3 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes, <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Lake)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>BootstrapSample3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, Lake, Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 3
      ID Lake         Mercury
   &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;
 1     1 Alligator       1.23
 2     3 Apopka          0.04
 3     3 Apopka          0.04
 4     4 Blue Cypress    0.44
 5     5 Brick           1.2 
 6     5 Brick           1.2 
 7     6 Bryant          0.27
 8     7 Cherry          0.48
 9     8 Crescent        0.19
10     9 Deer Point      0.83
# ℹ 43 more rows</code></pre>
</div>
</div>
<p>Mean Mercury Level:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(BootstrapSample3<span class="sc">$</span>Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5437736</code></pre>
</div>
</div>
<p>Now, we’ll take 10,000 bootstrap samples, and record the mean mercury concentration in each sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(FloridaLakes<span class="sc">$</span>Mercury)  <span class="co">#calculate sample statistic</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>Bootstrap_Mean <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>) <span class="co"># setup vector to hold bootstrap statistics</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>){</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>BootstrapSample <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes, <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="co"># take bootstrap sample</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>Bootstrap_Mean[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(BootstrapSample<span class="sc">$</span>Mercury) <span class="co"># calculate mean in bootstrap sample</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Results_Mean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Bootstrap_Mean)  <span class="co">#store results in data frame</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The bootstrap distribution for the mean mercury level is shown below, along with its standard error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Mean_Plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Lakes_Bootstrap_Results_Mean, </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">aes</span>(<span class="at">x=</span>Bootstrap_Mean)) <span class="sc">+</span>  </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Mean Mercury in Bootstrap Sample "</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Bootstrap Distribution for Sample Mean in Florida Lakes"</span>) <span class="sc">+</span> </span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Mean_Plot </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Bootstrap Standard Error</strong></p>
<p>We’ll calculate the bootstrap standard error of the mean. This is a measure of how much the mean varies between samples of size 53.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>SE_mean <span class="ot">&lt;-</span> <span class="fu">sd</span>(Lakes_Bootstrap_Results_Mean<span class="sc">$</span>Bootstrap_Mean)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>SE_mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.04595372</code></pre>
</div>
</div>
<p>Notice that the standard error of the mean is much less than the sample standard deviation of 0.341.</p>
<p><strong>Interpretations of sample standard deviation and standard error of the mean</strong></p>
<ul>
<li><p>The sample standard deviation measures the amount of variability in mercury levels between the 53 individual lakes in our sample.</p></li>
<li><p>The standard error of the mean measures the amount of variability in sample mean mercury levels between different samples of size 53.</p></li>
</ul>
<p>There is more variability between mercury levels in individual lakes than there is between average mercury levels in different samples of size 53.</p>
<p>Since the bootstrap distribution is roughly symmetric and bell-shaped, we can use the bootstrap standard error method to calculate an approximate 95% confidence interval for the mean mercury level among all Florida lakes.</p>
<p><span class="math display">\[
\text{Statistic} \pm 2\times\text{Standard Error}
\]</span></p>
<p>In this case, the statistic of interest is the sample mean <span class="math inline">\(\bar{x}=0.527\)</span>. The confidence interval is</p>
<p><span class="math display">\[
\begin{aligned}
&amp; \bar{x} \pm 2\times\text{SE}(\bar{x}) \\
&amp; = 0.527 \pm 2\times\text{0.0459537}
\end{aligned}
\]</span></p>
<p>95% Confidence Interval:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(mean <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_mean, mean <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_mean) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4352624 0.6190773</code></pre>
</div>
</div>
<p>The 95% confidence interval is shown by the gold bar on the graph of the bootstrap distribution below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Mean_Plot <span class="sc">+</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>mean <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_mean,<span class="at">xend=</span>mean <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_mean, <span class="at">y=</span><span class="dv">50</span>, <span class="at">yend=</span><span class="dv">50</span>), </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">"gold"</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">alpha=</span><span class="fl">0.01</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We are 95% confident that the average mercury level among all Florida lakes is between 0.44 and 0.62 parts per million.</p>
<p>It is important to note that we are not saying that we are 95% confident that an individual lake lie in this range, or that 95% of all individual lakes lie in this range. We are only saying that we are confident that the <em>average</em> mercury level among all lakes lies in this range. A confidence interval is a statement about a population parameter (in this case the average mercury level), rather than about individual lakes in the population. Since there is more variability about individual lakes than overall averages, we’ll need to make a wider interval when talking about the mercury level for an individual lake.</p>
</section>
<section id="ci-for-standard-deviation" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="ci-for-standard-deviation"><span class="header-section-number">3.4.3</span> CI for Standard Deviation</h3>
<p>Now, we’ll calculate a confidence interval for the standard deviation in mercury levels among all Florida lakes. Recall that the sample standard deviation (<span class="math inline">\(s\)</span>) was:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>Sample_SD <span class="ot">&lt;-</span> <span class="fu">sd</span>(FloridaLakes<span class="sc">$</span>Mercury)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>Sample_SD</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3410356</code></pre>
</div>
</div>
<p>We’ll use this estimate to calculate a confidence interval for the population standard deviation <span class="math inline">\(\sigma\)</span>.</p>
<p>This time, our statistic of interest is the sample standard deviation <span class="math inline">\(s\)</span>.</p>
<p><strong>Bootstrap Steps</strong></p>
<ol type="1">
<li><p>Take a sample of 53 lakes by randomly sampling from the original sample of 53 lakes, with replacement.</p></li>
<li><p>Calculate the standard deviation in mercury level in the bootstrap sample.</p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, keeping track of the standard deviation mercury level in each bootstrap sample.</p></li>
<li><p>Look at the distribution of the standard deviations across bootstrap samples. The variability in this bootstrap distribution can be used to approximate the variability in the sampling distribution for the standard deviation in mercury level.</p></li>
</ol>
<p>We’ll illustrate the procedure on 3 bootstrap samples.</p>
<p><strong>Bootstrap Sample 1</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample1 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes, <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Lake)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>BootstrapSample1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, Lake, Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 3
      ID Lake         Mercury
   &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;
 1     1 Alligator       1.23
 2     3 Apopka          0.04
 3     4 Blue Cypress    0.44
 4     5 Brick           1.2 
 5     6 Bryant          0.27
 6     6 Bryant          0.27
 7     6 Bryant          0.27
 8     6 Bryant          0.27
 9     7 Cherry          0.48
10     8 Crescent        0.19
# ℹ 43 more rows</code></pre>
</div>
</div>
<p>We calculate the standard deviation in mercury levels among the lakes in the bootstrap sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(BootstrapSample1<span class="sc">$</span>Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3157289</code></pre>
</div>
</div>
<p><strong>Bootstrap Sample #2</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample2 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes, <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Lake)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>BootstrapSample2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, Lake, Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 3
      ID Lake         Mercury
   &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;
 1     1 Alligator       1.23
 2     1 Alligator       1.23
 3     3 Apopka          0.04
 4     4 Blue Cypress    0.44
 5     5 Brick           1.2 
 6     5 Brick           1.2 
 7     6 Bryant          0.27
 8     7 Cherry          0.48
 9     7 Cherry          0.48
10     8 Crescent        0.19
# ℹ 43 more rows</code></pre>
</div>
</div>
<p>Standard Deviation in Mercury Level:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(BootstrapSample2<span class="sc">$</span>Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3466327</code></pre>
</div>
</div>
<p><strong>Bootstrap Sample #3</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample3 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes, <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Lake)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>BootstrapSample3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, Lake, Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 3
      ID Lake       Mercury
   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
 1     2 Annie         1.33
 2     3 Apopka        0.04
 3     5 Brick         1.2 
 4     6 Bryant        0.27
 5     6 Bryant        0.27
 6     6 Bryant        0.27
 7     7 Cherry        0.48
 8     8 Crescent      0.19
 9     9 Deer Point    0.83
10     9 Deer Point    0.83
# ℹ 43 more rows</code></pre>
</div>
</div>
<p>Standard Deviation Mercury Level:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(BootstrapSample3<span class="sc">$</span>Mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3294457</code></pre>
</div>
</div>
<p>Now, we’ll take 10,000 bootstrap samples, and record the standard deviation in mercury concentration in each sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>Sample_SD <span class="ot">&lt;-</span> <span class="fu">sd</span>(FloridaLakes<span class="sc">$</span>Mercury)  <span class="co">#calculate sample statistic</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>Bootstrap_SD <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>) <span class="co"># setup vector to hold bootstrap statistics</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>){</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>BootstrapSample <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes, <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="co"># take bootstrap sample</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>Bootstrap_SD[i] <span class="ot">&lt;-</span> <span class="fu">sd</span>(BootstrapSample<span class="sc">$</span>Mercury) <span class="co"># calculate standard deviation in bootstrap sample</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Results_SD <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Bootstrap_SD)  <span class="co">#store results in data frame</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The bootstrap distribution for the mean mercury level is shown below, along with its standard error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_SD_Plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Lakes_Bootstrap_Results_SD, </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">aes</span>(<span class="at">x=</span>Bootstrap_SD)) <span class="sc">+</span>  </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SD in Mercury in Bootstrap Sample "</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Bootstrap Distribution for Sample SD in Florida Lakes"</span>) <span class="sc">+</span> </span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_SD_Plot </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Bootstrap Standard Error:</strong></p>
<p>We’ll calculate the bootstrap standard error of the standard deviation. This is a measure of how much the standard deviation varies between samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>SE_SD <span class="ot">&lt;-</span> <span class="fu">sd</span>(Lakes_Bootstrap_Results_SD<span class="sc">$</span>Bootstrap_SD)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>SE_SD</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02867548</code></pre>
</div>
</div>
<p>Since the bootstrap distribution is roughly symmetric and bell-shaped, we can use the bootstrap standard error method to calculate an approximate 95% confidence interval for the standard deviation in mercury levels among all Florida lakes.</p>
<p><span class="math display">\[
\text{Statistic} \pm 2\times\text{Standard Error}
\]</span></p>
<p>In this case, the statistic of interest is the sample standard deviation <span class="math inline">\(s=0.341\)</span>. The confidence interval is</p>
<p><span class="math display">\[
\begin{aligned}
&amp; s \pm 2\times\text{SE}(s) \\
&amp; = 0.341 \pm 2\times{0.029}
\end{aligned}
\]</span></p>
<p>95% Confidence Interval:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(Sample_SD <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_SD, Sample_SD <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_SD        ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2836847 0.3983866</code></pre>
</div>
</div>
<p>The 95% confidence interval is shown by the gold bar on the graph of the bootstrap distribution below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_SD_Plot <span class="sc">+</span> </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sample_SD <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_SD,<span class="at">xend=</span>Sample_SD <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_SD, <span class="at">y=</span><span class="dv">50</span>, <span class="at">yend=</span><span class="dv">50</span>), </span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">"gold"</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">alpha=</span><span class="fl">0.01</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We are 95% confident that the standard deviation in mercury levels among all Florida lakes is between 0.28 and 0.4 parts per million.</p>
</section>
<section id="ci-for-median" class="level3" data-number="3.4.4">
<h3 data-number="3.4.4" class="anchored" data-anchor-id="ci-for-median"><span class="header-section-number">3.4.4</span> CI for Median</h3>
<p>We already calculated a confidence interval for the mean mercury level among all Florida lakes. We could calculate a bootstrap confidence interval for the median mercury level as well, but since the distribution of mercury levels in the lakes is roughly symmetric, the mean is a reasonable measure of center, and there is not a clear reason for using the median instead.</p>
<p>When a distribution is skewed or contains large outliers, however, the median is a more robust measure of center than the mean. Recall the distribution of 100 Seattle house prices seen in Chapters 1 and 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Houses, <span class="fu">aes</span>(<span class="at">x=</span>price)) <span class="sc">+</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of House Prices"</span>) <span class="sc">+</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Price"</span>) <span class="sc">+</span> </span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>These 100 houses are a sample of all houses sold in Seattle in 2014 and 2015, so we can use statistics from our sample to draw conclusions about all houses sold in Seattle in this time period.</p>
<p>In this subsection, we’ll use bootstrapping to calculate a 95% confidence interval for the median price among all houses sold in Seattle in this time period.</p>
<p>We calculate the sample median price.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>Sample_Median <span class="ot">&lt;-</span> <span class="fu">median</span>(Houses<span class="sc">$</span>price)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>Sample_Median</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 507.5</code></pre>
</div>
</div>
<p><strong>Bootstrap Steps</strong></p>
<ol type="1">
<li><p>Take a sample of 100 houses by randomly sampling from the original sample of 100 houses, with replacement.</p></li>
<li><p>Calculate the median price in the bootstrap sample.</p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, keeping track of the median price in each bootstrap sample.</p></li>
<li><p>Look at the distribution of the median price across bootstrap samples. The variability in this bootstrap distribution can be used to approximate the variability in the sampling distribution for the median price.</p></li>
</ol>
<p>We’ll illustrate the procedure on 3 bootstrap samples.</p>
<p><strong>Bootstrap Sample 1</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample1 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(Houses, <span class="dv">100</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Id)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>BootstrapSample1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(Id, price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 2
      Id price
   &lt;int&gt; &lt;dbl&gt;
 1     2  885.
 2     3  385.
 3     4  253.
 4     4  253.
 5     5  468.
 6     6  310.
 7     8  485.
 8     9  315.
 9     9  315.
10    10  425 
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>We calculate the median price among the houses in the bootstrap sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(BootstrapSample1<span class="sc">$</span>price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 400</code></pre>
</div>
</div>
<p><strong>Bootstrap Sample #2</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample2 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(Houses, <span class="dv">100</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Id)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>BootstrapSample2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(Id, price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 2
      Id price
   &lt;int&gt; &lt;dbl&gt;
 1     1 1225 
 2     3  385.
 3     4  253.
 4     4  253.
 5     4  253.
 6     6  310.
 7     7  550.
 8     8  485.
 9     8  485.
10     9  315.
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>Median Price:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(BootstrapSample2<span class="sc">$</span>price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 427.5</code></pre>
</div>
</div>
<p><strong>Bootstrap Sample #3</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample3 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(Houses, <span class="dv">100</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Id)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>BootstrapSample3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(Id, price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 2
      Id price
   &lt;int&gt; &lt;dbl&gt;
 1     2  885.
 2     4  253.
 3     5  468.
 4     7  550.
 5    10  425 
 6    13 1325 
 7    16 3075 
 8    17  438 
 9    18  688.
10    19  995.
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>Median Price:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(BootstrapSample3<span class="sc">$</span>price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 488</code></pre>
</div>
</div>
<p>Now, we’ll take 10,000 bootstrap samples, and record the median price in each sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>Sample_Med <span class="ot">&lt;-</span> <span class="fu">median</span>(Houses<span class="sc">$</span>price)  <span class="co">#calculate sample median</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>Bootstrap_Med <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>) <span class="co"># setup vector to hold bootstrap statistics</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>){</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>BootstrapSample <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(Houses, <span class="dv">100</span>, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="co"># take bootstrap sample</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>Bootstrap_Med[i] <span class="ot">&lt;-</span> <span class="fu">median</span>(BootstrapSample<span class="sc">$</span>price) <span class="co"># calculate standard deviation in bootstrap sample</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Results_Med <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Bootstrap_Med)  <span class="co">#store results in data frame</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The bootstrap distribution for the median price is shown below, along with its standard error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Med_Plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Houses_Bootstrap_Results_Med, </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">aes</span>(<span class="at">x=</span>Bootstrap_Med)) <span class="sc">+</span>  </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Median Price in Bootstrap Sample "</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Bootstrap Distribution for Median Price in Seattle Houses"</span>) <span class="sc">+</span> </span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Med_Plot </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Bootstrap Standard Error:</strong></p>
<p>We’ll calculate the bootstrap standard error of the median. This is a measure of how much the median varies between samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>SE_Med <span class="ot">&lt;-</span> <span class="fu">sd</span>(Houses_Bootstrap_Results_Med<span class="sc">$</span>Bootstrap_Med)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>SE_Med</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 48.11411</code></pre>
</div>
</div>
<p>The standard error measures the amount of variability in median house price between different samples of size 100.</p>
<p>Note that this is different than the sample standard deviation, which represents the standard deviation in prices between the 100 different houses in the sample.</p>
<p>Notice that the bootstrap distribution for the median is not symmetric and bell-shaped. Thus, we cannot be assured that 95% of samples will produce a statistic within two standard errors of the mean, so the standard error confidence interval method is not appropriate here. Instead, we’ll calculate a confidence interval by taking the middle 95% of the values in the bootstrap distribution. A confidence interval calculated this way is called a <strong>percentile bootstrap interval</strong>.</p>
<p>We’ll calculate the 0.025 quantile and the 0.975 quantile of this bootstrap distribution. These are the points below which lie 2.5% and 97.5% of the medians in the bootstrap distribution. Thus, the middle 95% of the medians lie between these values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>q<span class="fl">.025</span> <span class="ot">&lt;-</span> <span class="fu">quantile</span>(Houses_Bootstrap_Results_Med<span class="sc">$</span>Bootstrap_Med, <span class="fl">0.025</span>)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>q<span class="fl">.025</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2.5% 
 410 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>q<span class="fl">.975</span> <span class="ot">&lt;-</span> <span class="fu">quantile</span>(Houses_Bootstrap_Results_Med<span class="sc">$</span>Bootstrap_Med, <span class="fl">0.975</span>)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>q<span class="fl">.975</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 97.5% 
600.05 </code></pre>
</div>
</div>
<p>The 95% confidence interval is shown by the gold bar on the graph of the bootstrap distribution below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Med_Plot <span class="sc">+</span> </span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>q<span class="fl">.025</span>,<span class="at">xend=</span>q<span class="fl">.975</span>, <span class="at">y=</span><span class="dv">50</span>, <span class="at">yend=</span><span class="dv">50</span>), </span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">"gold"</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">alpha=</span><span class="fl">0.01</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-99-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We are 95% confident that the median price among all houses that sold in Seattle between 2014 and 2015 is between 410 and 600 thousand dollars.</p>
</section>
<section id="ci-for-difference-in-means" class="level3" data-number="3.4.5">
<h3 data-number="3.4.5" class="anchored" data-anchor-id="ci-for-difference-in-means"><span class="header-section-number">3.4.5</span> CI for Difference in Means</h3>
<p>We previously calculated a confidence interval for the average mercury level among all lakes in Florida.</p>
<p>Now, we’ll calculate an interval for the difference in average mercury levels between lakes in Northern Florida, compared to Southern Florida.</p>
<p>The boxplot shows and table below describe the distribution of mercury levels for lakes in Northern Florida, compared to Southern Florida.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>LakesBP <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>FloridaLakes, <span class="fu">aes</span>(<span class="at">x=</span>Location, <span class="at">y=</span>Mercury, <span class="at">fill=</span>Location)) <span class="sc">+</span> </span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span>   <span class="fu">geom_jitter</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Mercury Levels in Florida Lakes"</span>) <span class="sc">+</span> </span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Location"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Mercury Level"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>LakesBP</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-101-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>LakesTable <span class="ot">&lt;-</span> FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Location) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">MeanHg=</span><span class="fu">mean</span>(Mercury), </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">StDevHg=</span><span class="fu">sd</span>(Mercury), </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">N=</span><span class="fu">n</span>())</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>LakesTable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  Location MeanHg StDevHg     N
  &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;
1 N         0.425   0.270    33
2 S         0.696   0.384    20</code></pre>
</div>
</div>
<p>In our sample of 33 Northern Lakes and 20 Southern Lakes, we saw a difference of 0.27 ppm. We’ll calculate a confidence interval to estimate how big or small this difference could be among all Florida lakes.</p>
<p>We’ll use a statistical model to calculate the average mercury levels in Northern and Southern Florida.</p>
<p><span class="math inline">\(\widehat{\text{Mercury}} = b_0 +b_1\times{\text{South}}\)</span></p>
<ul>
<li><span class="math inline">\(b_0\)</span> represents the mean mercury level for lakes in North Florida, and<br>
</li>
<li><span class="math inline">\(b_1\)</span> represents the mean difference in mercury level for lakes in South Florida, compared to North Florida</li>
</ul>
<p>The estimates for corresponding to the original sample are shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>FloridaLakes, Mercury<span class="sc">~</span>Location)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>M</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Mercury ~ Location, data = FloridaLakes)

Coefficients:
(Intercept)    LocationS  
     0.4245       0.2720  </code></pre>
</div>
</div>
<p>Thus, we can obtain a confidence interval for the difference in average mercury levels by fitting a regression model to each of our bootstrap samples and recording the value of the sample statistic <span class="math inline">\(b_1\)</span>, which represents this difference. Alternatively, we could calculate the mean from each group separately and subtract.</p>
<p>When comparing groups, we make one modification in Step #1 of the bootstrap process. Rather than drawing a sample of size <span class="math inline">\(n\)</span> at random, with replacement, we’ll draw the same number of observations from each group as were in the original sample. In this case, we had 33 northern lakes, and 20 southern lakes.</p>
<p><strong>Bootstrap Steps</strong></p>
<ol type="1">
<li><p>Take a sample of 33 northern lakes and 20 southern lakes by randomly sampling from the original sample, with replacement.</p></li>
<li><p>Fit a regression model with location as the explanatory variable and record the value of <span class="math inline">\(b_1\)</span>, representing the difference between the means for each group (South-North).</p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, keeping track of the difference in means in each bootstrap sample.</p></li>
<li><p>Look at the distribution of the differences in means across bootstrap samples. The variability in this bootstrap distribution can be used to approximate the variability in the sampling distribution for the difference in means between mercury levels in Northern and Southern Florida.</p></li>
</ol>
<p>We’ll illustrate the procedure on 3 bootstrap samples.</p>
<p><strong>Bootstrap Sample 1</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>NLakes <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Location<span class="sc">==</span><span class="st">"N"</span>), <span class="dv">33</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)   <span class="do">## sample 33 northern lakes</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>SLakes <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Location<span class="sc">==</span><span class="st">"S"</span>), <span class="dv">20</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)   <span class="do">## sample 20 southern lakes</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>BootstrapSample1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(NLakes, SLakes) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Lake, Location, Mercury)   <span class="do">## combine Northern and Southern Lakes</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>BootstrapSample1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 4
      ID Lake         Location Mercury
   &lt;int&gt; &lt;chr&gt;        &lt;fct&gt;      &lt;dbl&gt;
 1     1 Alligator    S           1.23
 2     2 Annie        S           1.33
 3     2 Annie        S           1.33
 4     3 Apopka       N           0.04
 5     4 Blue Cypress S           0.44
 6     4 Blue Cypress S           0.44
 7     4 Blue Cypress S           0.44
 8     7 Cherry       N           0.48
 9     8 Crescent     N           0.19
10    10 Dias         N           0.81
# ℹ 43 more rows</code></pre>
</div>
</div>
<p>We fit a regression model to the bootstrap sample and calculate the regression coefficients. We’re interested in the second coefficient, <span class="math inline">\(b_1\)</span>, which represents the mean difference between lakes in Southern and Northern Florida</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>Mb1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample1, Mercury <span class="sc">~</span> Location) <span class="do">## fit linear model</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>Mb1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Mercury ~ Location, data = BootstrapSample1)

Coefficients:
(Intercept)    LocationS  
     0.3894       0.2471  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>NLakes <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Location<span class="sc">==</span><span class="st">"N"</span>), <span class="dv">33</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)   <span class="do">## sample 33 northern lakes</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>SLakes <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Location<span class="sc">==</span><span class="st">"S"</span>), <span class="dv">20</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)   <span class="do">## sample 20 southern lakes</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>BootstrapSample2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(NLakes, SLakes) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Lake, Location, Mercury)   <span class="do">## combine Northern and Southern Lakes</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>BootstrapSample2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 4
      ID Lake         Location Mercury
   &lt;int&gt; &lt;chr&gt;        &lt;fct&gt;      &lt;dbl&gt;
 1     1 Alligator    S           1.23
 2     1 Alligator    S           1.23
 3     1 Alligator    S           1.23
 4     1 Alligator    S           1.23
 5     3 Apopka       N           0.04
 6     3 Apopka       N           0.04
 7     3 Apopka       N           0.04
 8     4 Blue Cypress S           0.44
 9     4 Blue Cypress S           0.44
10     4 Blue Cypress S           0.44
# ℹ 43 more rows</code></pre>
</div>
</div>
<p><strong>Bootstrap Sample 2</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>Mb2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample2, Mercury <span class="sc">~</span> Location) <span class="do">## fit linear model</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>Mb2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Mercury ~ Location, data = BootstrapSample2)

Coefficients:
(Intercept)    LocationS  
     0.4585       0.2755  </code></pre>
</div>
</div>
<p><strong>Bootstrap Sample 3</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>NLakes <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Location<span class="sc">==</span><span class="st">"N"</span>), <span class="dv">33</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)   <span class="do">## sample 33 northern lakes</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>SLakes <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Location<span class="sc">==</span><span class="st">"S"</span>), <span class="dv">20</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)   <span class="do">## sample 20 southern lakes</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>BootstrapSample3 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(NLakes, SLakes) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Lake, Location, Mercury)   <span class="do">## combine Northern and Southern Lakes</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>BootstrapSample3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 4
      ID Lake      Location Mercury
   &lt;int&gt; &lt;chr&gt;     &lt;fct&gt;      &lt;dbl&gt;
 1     1 Alligator S           1.23
 2     1 Alligator S           1.23
 3     2 Annie     S           1.33
 4     2 Annie     S           1.33
 5     2 Annie     S           1.33
 6     2 Annie     S           1.33
 7     3 Apopka    N           0.04
 8     3 Apopka    N           0.04
 9     6 Bryant    N           0.27
10     6 Bryant    N           0.27
# ℹ 43 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>Mb3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample3, Mercury <span class="sc">~</span> Location) <span class="do">## fit linear model</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>Mb3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Mercury ~ Location, data = BootstrapSample3)

Coefficients:
(Intercept)    LocationS  
     0.3342       0.4178  </code></pre>
</div>
</div>
<p>We’ll now take 10,000 different bootstrap samples and look at the bootstrap distribution for <span class="math inline">\(b_1\)</span>, the difference in mean mercury levels between lakes in Southern and Northern Florida</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>FloridaLakes, Mercury<span class="sc">~</span>Location) <span class="co">#fit model to original sample</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>Sample_b1 <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record b1 value (second coefficient)</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>Bootstrap_b1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>)  <span class="co">#vector to store b1 values</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>){</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>NLakes <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Location<span class="sc">==</span><span class="st">"N"</span>), <span class="dv">33</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)   <span class="do">## sample 33 northern lakes</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>SLakes <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Location<span class="sc">==</span><span class="st">"S"</span>), <span class="dv">20</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)   <span class="do">## sample 20 southern lakes</span></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>BootstrapSample <span class="ot">&lt;-</span> <span class="fu">rbind</span>(NLakes, SLakes)   <span class="do">## combine Northern and Southern Lakes</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample, Mercury <span class="sc">~</span> Location) <span class="do">## fit linear model</span></span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>Bootstrap_b1[i] <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="do">## record b1 </span></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>NS_Lakes_Bootstrap_Results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Bootstrap_b1)  <span class="co">#save results as dataframe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The bootstrap distribution for the difference in means, <span class="math inline">\(b_1\)</span>, is shown below, along with the standard error for the difference.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>NS_Lakes_Bootstrap_Plot_b1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>NS_Lakes_Bootstrap_Results, <span class="fu">aes</span>(<span class="at">x=</span>Bootstrap_b1)) <span class="sc">+</span>  </span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>) <span class="sc">+</span> </span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Mean Difference (b1) in Bootstrap Sample"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Northern vs Southern Lakes: Bootstrap Distribution for b1"</span>) </span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>NS_Lakes_Bootstrap_Plot_b1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-111-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Bootstrap Standard Error:</strong></p>
<p>We’ll calculate the bootstrap standard error of the difference in means <span class="math inline">\(b_1\)</span>. This is a measure of how much the difference in means varies between samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>SE_b1 <span class="ot">&lt;-</span> <span class="fu">sd</span>(NS_Lakes_Bootstrap_Results<span class="sc">$</span>Bootstrap_b1)</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>SE_b1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09549244</code></pre>
</div>
</div>
<p>The bootstrap distribution is symmetric and bell-shaped, so we can use the standard error method to calculate a 95% confidence interval.</p>
<p><span class="math display">\[
\begin{aligned}
&amp; b_1 \pm 2\times\text{SE}(b_1) \\
&amp; = 0.271 \pm 2\times{0.095}
\end{aligned}
\]</span></p>
<p>95% Confidence Interval:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(Sample_b1 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_b1, Sample_b1 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_b1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> LocationS  LocationS 
0.08096967 0.46293942 </code></pre>
</div>
</div>
<p>The 95% confidence interval is shown by the gold bar on the graph of the bootstrap distribution below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>NS_Lakes_Bootstrap_Plot_b1 <span class="sc">+</span> </span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sample_b1 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_b1,<span class="at">xend=</span>Sample_b1 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_b1, <span class="at">y=</span><span class="dv">50</span>, <span class="at">yend=</span><span class="dv">50</span>), </span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">"gold"</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">alpha=</span><span class="fl">0.01</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-114-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We are 95% confident that the mean mercury level among all lakes in Southern Florida is between 0.08 and 0.46 higher than the mean mercury level among all lakes in Northern Florida.</p>
</section>
<section id="ci-for-regression-slope" class="level3" data-number="3.4.6">
<h3 data-number="3.4.6" class="anchored" data-anchor-id="ci-for-regression-slope"><span class="header-section-number">3.4.6</span> CI for Regression Slope</h3>
<p>Now, we’ll examine the relationship between mercury concentration and pH in Florida lakes. The scatterplot displays these variables, along with the least squares regression line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>FloridaLakes, <span class="fu">aes</span>(<span class="at">y=</span>Mercury, <span class="at">x=</span>pH)) <span class="sc">+</span> </span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-115-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The regression equation is</p>
<p><span class="math display">\[
\widehat{\text{Mercury}} = b_0 + b_1\times\text{pH}
\]</span></p>
<p>Regression estimates <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> are shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>FloridaLakes, Mercury<span class="sc">~</span>pH)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>M</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Mercury ~ pH, data = FloridaLakes)

Coefficients:
(Intercept)           pH  
     1.5309      -0.1523  </code></pre>
</div>
</div>
<ul>
<li>On average, lakes with pH level 0 are expected to have a mercury level of 1.53 ppm.<br>
</li>
<li>For each one-unit increase in pH, mercury level is expected to decrease by 0.15 ppm.</li>
</ul>
<p>These estimates are sample statistics, calculated from our sample of 53 lakes. We can think of our regression equation estimates <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> as estimates of parameters <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>, which pertain to the slope and intercept of the regression line pertaining to the entire population of all lakes in Florida. We’ll use <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> to estimate <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> in the same way that we used sample proportion <span class="math inline">\(\hat{p}\)</span> to estimate population proportion <span class="math inline">\(p\)</span> and sample mean <span class="math inline">\(\bar{x}\)</span> to estimate population mean <span class="math inline">\(\mu\)</span>.</p>
<p>The intercept, <span class="math inline">\(\beta_0\)</span> has little meaning here, but the slope <span class="math inline">\(\beta_1\)</span> represents the average change in mercury level for each one-unit increase in pH, among all Florida lakes. We’ll use bootstrapping to find a confidence interval for this quantity.</p>
<p><strong>Bootstrap Steps</strong></p>
<ol type="1">
<li><p>Take a sample of 53 lakes by randomly sampling from the original sample, with replacement.</p></li>
<li><p>Fit a regression model with pH as the explanatory variable and record the value of slope <span class="math inline">\(b_1\)</span>.</p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, keeping track of slope of the regression line for each bootstrap sample.</p></li>
<li><p>Look at the distribution of the slopes across bootstrap samples. The variability in this bootstrap distribution can be used to approximate the variability in the sampling distribution for the slope relating mercury and pH levels.</p></li>
</ol>
<p>We’ll illustrate the procedure on 3 bootstrap samples.</p>
<p><strong>Bootstrap Sample 1</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample1 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes , <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)  <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Lake, pH, Mercury)   <span class="co"># take bootstrap sample</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>BootstrapSample1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 4
      ID Lake            pH Mercury
   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt;
 1     1 Alligator      6.1    1.23
 2     1 Alligator      6.1    1.23
 3     2 Annie          5.1    1.33
 4     2 Annie          5.1    1.33
 5     3 Apopka         9.1    0.04
 6     4 Blue Cypress   6.9    0.44
 7     5 Brick          4.6    1.2 
 8     9 Deer Point     5.8    0.83
 9     9 Deer Point     5.8    0.83
10    10 Dias           6.4    0.81
# ℹ 43 more rows</code></pre>
</div>
</div>
<p>We fit a regression model to the bootstrap sample and calculate the regression coefficients. We’re again interested in the second coefficient, <span class="math inline">\(b_1\)</span>, which now represents the slope of the regression line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>Mb1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample1, Mercury <span class="sc">~</span> pH) <span class="co"># fit linear model</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>Mb1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Mercury ~ pH, data = BootstrapSample1)

Coefficients:
(Intercept)           pH  
     1.7542      -0.1774  </code></pre>
</div>
</div>
<p><strong>Bootstrap Sample 2</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample2 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes , <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)  <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Lake, pH, Mercury)</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>BootstrapSample2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 4
      ID Lake         pH Mercury
   &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1     1 Alligator   6.1    1.23
 2     2 Annie       5.1    1.33
 3     2 Annie       5.1    1.33
 4     3 Apopka      9.1    0.04
 5     3 Apopka      9.1    0.04
 6     5 Brick       4.6    1.2 
 7     5 Brick       4.6    1.2 
 8     6 Bryant      7.3    0.27
 9     6 Bryant      7.3    0.27
10     7 Cherry      5.4    0.48
# ℹ 43 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>Mb2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample2, Mercury <span class="sc">~</span> pH) <span class="co"># fit linear model</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>Mb2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Mercury ~ pH, data = BootstrapSample2)

Coefficients:
(Intercept)           pH  
      1.752       -0.189  </code></pre>
</div>
</div>
<p><strong>Bootstrap Sample 3</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample3 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes , <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)  <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Lake, pH, Mercury)</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>BootstrapSample3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 4
      ID Lake                 pH Mercury
   &lt;int&gt; &lt;chr&gt;             &lt;dbl&gt;   &lt;dbl&gt;
 1     2 Annie               5.1    1.33
 2     5 Brick               4.6    1.2 
 3     6 Bryant              7.3    0.27
 4     7 Cherry              5.4    0.48
 5    10 Dias                6.4    0.81
 6    11 Dorr                5.4    0.71
 7    14 East Tohopekaliga   5.8    1.16
 8    14 East Tohopekaliga   5.8    1.16
 9    15 Farm-13             7.6    0.05
10    15 Farm-13             7.6    0.05
# ℹ 43 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>Mb3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample3, Mercury <span class="sc">~</span> pH) <span class="co"># fit linear model</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>Mb3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Mercury ~ pH, data = BootstrapSample3)

Coefficients:
(Intercept)           pH  
     1.2629      -0.1102  </code></pre>
</div>
</div>
<p>We’ll now take 10,000 different bootstrap samples and look at the bootstrap distribution for <span class="math inline">\(b_1\)</span>, the slope of the regression line relating mercury level and pH.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>FloridaLakes, Mercury<span class="sc">~</span>pH) <span class="co">#fit model to original sample</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>Sample_b1 <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record b1 value (second coefficient)</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>Bootstrap_b1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>)  <span class="co">#vector to store b1 values</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>){</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>BootstrapSample <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes , <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)   <span class="co">#take bootstrap sample</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample, Mercury <span class="sc">~</span> pH) <span class="co"># fit linear model</span></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>Bootstrap_b1[i] <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record b1 </span></span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Slope_Results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Bootstrap_b1)  <span class="co">#save results as dataframe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The bootstrap distribution for the slopes, <span class="math inline">\(b_1\)</span>, is shown below, along with the standard error for the difference.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Plot_Slope <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Lakes_Bootstrap_Slope_Results, <span class="fu">aes</span>(<span class="at">x=</span>Bootstrap_b1)) <span class="sc">+</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>) <span class="sc">+</span> </span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Slope in Bootstrap Sample"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Bootstrap Distribution for Slope"</span>) </span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Plot_Slope</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-124-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Bootstrap Standard Error:</strong></p>
<p>We’ll calculate the bootstrap standard error of the slope <span class="math inline">\(b_1\)</span>. This is a measure of how much the slope varies between samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>SE_b1 <span class="ot">&lt;-</span> <span class="fu">sd</span>(Lakes_Bootstrap_Slope_Results<span class="sc">$</span>Bootstrap_b1)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>SE_b1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02694529</code></pre>
</div>
</div>
<p>The bootstrap distribution is symmetric and bell-shaped, so we can use the standard error method to calculate a 95% confidence interval.</p>
<p><span class="math display">\[
\begin{aligned}
&amp; b_1 \pm 2\times\text{SE}(b_1) \\
&amp; = -0.1523 \pm 2\times{0.027}
\end{aligned}
\]</span></p>
<p>95% Confidence Interval:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(Sample_b1 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_b1, Sample_b1 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_b1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         pH          pH 
-0.20619145 -0.09841028 </code></pre>
</div>
</div>
<p>The 95% confidence interval is shown by the gold bar on the graph of the bootstrap distribution below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Plot_Slope <span class="sc">+</span> </span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sample_b1 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_b1,<span class="at">xend=</span>Sample_b1 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_b1, <span class="at">y=</span><span class="dv">50</span>, <span class="at">yend=</span><span class="dv">50</span>), </span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">"gold"</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">alpha=</span><span class="fl">0.01</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-127-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We are 95% confident that among all Florida lakes, for each 1 unit increase in pH, mercury level decreases between 0.2 and 0.1, on average.</p>
</section>
<section id="ci-for-regression-response" class="level3" data-number="3.4.7">
<h3 data-number="3.4.7" class="anchored" data-anchor-id="ci-for-regression-response"><span class="header-section-number">3.4.7</span> CI for Regression Response</h3>
<p>In addition to calculating a confidence interval for the slope of the regression line relating mercury and pH levels in a lake, we can also calculate a confidence interval for the average mercury level among all lakes with a given pH.</p>
<p>We’ll calculate a confidence interval for the average mercury level among all lakes with a neutral pH level of 7.</p>
<p>The regression equation is</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{\text{Mercury}} &amp; = b_0 + b_1\times\text{pH} \\
&amp; = 1.5309 - 0.1523\times\text{pH}
\end{aligned}
\]</span></p>
<p>so the expected mercury level among all lakes with <span class="math inline">\(\text{pH} = 7\)</span> is <span class="math inline">\(b_0+7b_1 = 1.5309-0.1523(7)=0.4648\)</span> ppm.</p>
<p>This quantity is a statistic calculated from a sample of 53 lakes, so we would not expect the average mercury level among all lakes in the population to be exactly equal to 0.4648. Again, we’ll use this sample statistic as an estimate of the population parameter, and use bootstrapping to estimate the variability associated with this statistic, in order to make a confidence interval.</p>
<p><strong>Bootstrap Steps</strong></p>
<ol type="1">
<li><p>Take a sample of 53 lakes by randomly sampling from the original sample, with replacement.</p></li>
<li><p>Fit a regression model with location as the explanatory variable and record the values of <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span>. Use these to calculate <span class="math inline">\(b_0+7b_1\)</span>.</p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, keeping track of <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span>, and calculating <span class="math inline">\(b_0+7b_1\)</span> in each bootstrap sample.</p></li>
<li><p>Look at the distribution of the expected response, <span class="math inline">\(b_0 + 7b_1\)</span>, across bootstrap samples. The variability in this bootstrap distribution can be used to approximate the variability in the sampling distribution for the expected mercury level among all lakes with pH level of 7.</p></li>
</ol>
<p>We’ll illustrate the procedure on 3 bootstrap samples.</p>
<p><strong>Bootstrap Sample 1</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample1 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes , <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)  <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Lake, pH, Mercury)   <span class="co"># take bootstrap sample</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>BootstrapSample1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 4
      ID Lake          pH Mercury
   &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;
 1     1 Alligator    6.1    1.23
 2     3 Apopka       9.1    0.04
 3     3 Apopka       9.1    0.04
 4     6 Bryant       7.3    0.27
 5     7 Cherry       5.4    0.48
 6     8 Crescent     8.1    0.19
 7     8 Crescent     8.1    0.19
 8     9 Deer Point   5.8    0.83
 9     9 Deer Point   5.8    0.83
10    10 Dias         6.4    0.81
# ℹ 43 more rows</code></pre>
</div>
</div>
<p>We fit a regression model to the bootstrap sample and calculate the regression coefficients. We’re interested in the second coefficient, <span class="math inline">\(b_1\)</span>, which represents the mean difference between lakes in Southern and Northern Florida</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>Mb1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample1, Mercury <span class="sc">~</span> pH) <span class="do">## fit linear model</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> Mb1<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># record value of b0 (first coefficient)</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> Mb1<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record value of b1 (second coefficient)</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>b0<span class="sc">+</span><span class="dv">7</span><span class="sc">*</span>b1 <span class="co">#calculate b0+7*b1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
  0.4353724 </code></pre>
</div>
</div>
<p><strong>Bootstrap Sample 2</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample2 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes , <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)  <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Lake, pH, Mercury)</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>BootstrapSample2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 4
      ID Lake            pH Mercury
   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt;
 1     2 Annie          5.1    1.33
 2     2 Annie          5.1    1.33
 3     3 Apopka         9.1    0.04
 4     4 Blue Cypress   6.9    0.44
 5     6 Bryant         7.3    0.27
 6     6 Bryant         7.3    0.27
 7    10 Dias           6.4    0.81
 8    10 Dias           6.4    0.81
 9    12 Down           7.2    0.5 
10    12 Down           7.2    0.5 
# ℹ 43 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>Mb2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample2, Mercury <span class="sc">~</span> pH) <span class="co"># fit linear model</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> Mb2<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># record value of b0 (first coefficient)</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> Mb2<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record value of b1 (second coefficient)</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>b0<span class="sc">+</span><span class="dv">7</span><span class="sc">*</span>b1 <span class="co">#calculate b0+7*b1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
  0.5738289 </code></pre>
</div>
</div>
<p><strong>Bootstrap Sample 3</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample3 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes , <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)  <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Lake, pH, Mercury)</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>BootstrapSample3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53 × 4
      ID Lake        pH Mercury
   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;
 1     2 Annie      5.1    1.33
 2     3 Apopka     9.1    0.04
 3     6 Bryant     7.3    0.27
 4     6 Bryant     7.3    0.27
 5     7 Cherry     5.4    0.48
 6     7 Cherry     5.4    0.48
 7     8 Crescent   8.1    0.19
 8    10 Dias       6.4    0.81
 9    10 Dias       6.4    0.81
10    10 Dias       6.4    0.81
# ℹ 43 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>Mb3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample3, Mercury <span class="sc">~</span> pH) <span class="co"># fit linear model</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> Mb3<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># record value of b0 (first coefficient)</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> Mb3<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record value of b1 (second coefficient)</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>b0<span class="sc">+</span><span class="dv">7</span><span class="sc">*</span>b1 <span class="co">#calculate b0+7*b1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
  0.4223812 </code></pre>
</div>
</div>
<p>We’ll now take 10,000 different bootstrap samples and record the values of <span class="math inline">\(b_0\)</span>, <span class="math inline">\(b_1\)</span>, which we’ll then use to calculate <span class="math inline">\(b_0+7b_1\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>FloridaLakes, Mercury<span class="sc">~</span>pH) <span class="co">#fit model to original sample</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>Sample_b0 <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># record b0 value (second coefficient)</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>Sample_b1 <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record b1 value (second coefficient)</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>Sample_Exp7 <span class="ot">&lt;-</span> Sample_b0 <span class="sc">+</span> <span class="dv">7</span><span class="sc">*</span>Sample_b1 <span class="co"># calculate sample expected mercury when pH=7</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>Bootstrap_b0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>)  <span class="co">#vector to store b1 values</span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>Bootstrap_b1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>)  <span class="co">#vector to store b1 values</span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>){</span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>BootstrapSample <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(FloridaLakes , <span class="dv">53</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)   <span class="co">#take bootstrap sample</span></span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample, Mercury <span class="sc">~</span> pH) <span class="co"># fit linear model</span></span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>Bootstrap_b0[i] <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># record b0 </span></span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a>Bootstrap_b1[i] <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record b1 </span></span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a>Bootstrap_Exp7 <span class="ot">&lt;-</span>  Bootstrap_b0 <span class="sc">+</span> <span class="dv">7</span><span class="sc">*</span>Bootstrap_b1 <span class="co"># calcualte expected response for each bootstrap sample</span></span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-17"><a href="#cb200-17" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Exp7_Results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Bootstrap_b0, Bootstrap_b1, Bootstrap_Exp7)  <span class="co">#save results as dataframe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The bootstrap distribution for the expected mercury level among all lakes with pH level 7, <span class="math inline">\(b_0+7b_1\)</span>, is shown below, along with the standard error for this quantity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Plot_Exp7 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Lakes_Bootstrap_Exp7_Results, <span class="fu">aes</span>(<span class="at">x=</span>Bootstrap_Exp7)) <span class="sc">+</span>  </span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>) <span class="sc">+</span> </span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Expected Mercury Level in Bootstrap Sample"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>( <span class="st">"Bootstrap Distribution for Exp. Mercury when pH=7"</span>) </span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Plot_Exp7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-135-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Bootstrap Standard Error:</strong></p>
<p>We’ll calculate the bootstrap standard error of expected mercury concentration <span class="math inline">\(b_0 + 7b_1\)</span>. This is a measure of how much the estimated expected concentration varies between samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>SE_Exp7 <span class="ot">&lt;-</span> <span class="fu">sd</span>(Lakes_Bootstrap_Exp7_Results<span class="sc">$</span>Bootstrap_Exp7)</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>SE_Exp7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03702503</code></pre>
</div>
</div>
<p>Again, the bootstrap distribution is symmetric and bell-shaped, so we can use the standard error method to calculate a 95% confidence interval.</p>
<p><span class="math display">\[
\begin{aligned}
&amp; b_1 \pm 2\times\text{SE}(b_1) \\
&amp; = 0.4648 \pm 2\times{0.037}
\end{aligned}
\]</span></p>
<p>95% Confidence Interval:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(Sample_Exp7 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_Exp7, Sample_Exp7 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_Exp7) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) (Intercept) 
  0.3907626   0.5388627 </code></pre>
</div>
</div>
<p>The 95% confidence interval is shown by the gold bar on the graph of the bootstrap distribution below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>Lakes_Bootstrap_Plot_Exp7 <span class="sc">+</span> </span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sample_Exp7 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_Exp7,<span class="at">xend=</span>Sample_Exp7 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_Exp7, <span class="at">y=</span><span class="dv">50</span>, <span class="at">yend=</span><span class="dv">50</span>), </span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">"gold"</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">alpha=</span><span class="fl">0.01</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-138-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We are 95% confident that average mercury level among all Florida lakes with pH level 7 is between 0.4 and 0.5 ppm.</p>
<p>Again, we are not saying that we think an individual like with a pH level of 7 will lie in this range, only that the average mercury level among all such lakes lies in this range.</p>
</section>
<section id="more-cis-in-regression" class="level3" data-number="3.4.8">
<h3 data-number="3.4.8" class="anchored" data-anchor-id="more-cis-in-regression"><span class="header-section-number">3.4.8</span> More CI’s in Regression</h3>
<p>We saw in the previous two examples how to calculate a confidence interval for the slope of a regression line, and for an expected response in regression. In fact, we can calculate confidence intervals for any function involving regression coefficients <span class="math inline">\(\beta_0, \beta_1, \ldots, \beta_p\)</span>, in a similar manner.</p>
<p>For example, let’s consider the model for Seattle house prices that involved square feet, whether or not the house was on the waterfront, and an interaction term between these variables.</p>
<p>The model is</p>
<p><span class="math display">\[
\widehat{Price} = b_0 + b_1\times\text{Sq. Ft.} + b_2\times\text{waterfront} + b_3\times\text{Sq.Ft}\times\text{Waterfront}
\]</span></p>
<p>We fit the model and obtain the parameter estimates shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Houses, price<span class="sc">~</span>sqft_living <span class="sc">+</span> waterfront <span class="sc">+</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>          sqft_living<span class="sc">:</span>waterfront) <span class="co">#fit model to original sample</span></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>Sample_b0 <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># record b0 value (second coefficient)</span></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>Sample_b1 <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record b1 value (second coefficient)</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>Sample_b2 <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">3</span>] <span class="co"># record b1 value (second coefficient)</span></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a>Sample_b3 <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">4</span>] <span class="co"># record b1 value (second coefficient)</span></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>M</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ sqft_living + waterfront + sqft_living:waterfront, 
    data = Houses)

Coefficients:
              (Intercept)                sqft_living  
                  67.3959                     0.2184  
            waterfrontYes  sqft_living:waterfrontYes  
                -364.5950                     0.4327  </code></pre>
</div>
</div>
<p>Consider the following quantities that we might be interested in estimating:</p>
<ol type="1">
<li>The expected price of a 2,000 square foot waterfront house.<br>
</li>
<li>The expected price of a 1,500 square foot non-waterfront house.<br>
</li>
<li>The difference between the expected price of a house 1,800 square foot house on the waterfront, compared to a house the same size that is not on the waterfront.<br>
</li>
<li>The difference in the rate of change in house prices for each additional 100 square feet for houses on the waterfront, compared to houses not on the waterfront.</li>
</ol>
<p>Each of these quantities can be expressed as a linear function of our regression coefficients <span class="math inline">\(b_0, b_1, b_2, b_3\)</span>. We just need to find the appropriate function of the <span class="math inline">\(b_j\)</span>’s, and then calculate a bootstrap confidence interval for that quantity, using the same steps we’ve seen in the previous examples.</p>
<p>Substituting into the regression equation, we see that:</p>
<ol type="1">
<li>The expected price of a 2,000 square foot waterfront house is given by <span class="math display">\[b_0 + 2000b_1 + b_2 + 2000b_3\]</span></li>
</ol>
<p>We calculate this estimate from the model, based on our sample of 100 houses:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2000</span><span class="sc">*</span>Sample_b1 <span class="sc">+</span>Sample_b2<span class="sc">+</span><span class="dv">2000</span><span class="sc">*</span>Sample_b3 <span class="co"># calculate b0+2000b1+b2+2000b3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sqft_living 
   937.4777 </code></pre>
</div>
</div>
<p>We estimate that the average price of all 2,000 square foot waterfront houses in Seattle is 937 thousand dollars.</p>
<ol start="2" type="1">
<li>The expected price of a 1,500 square foot non-waterfront house is given by <span class="math display">\[b_0 + 1500b_1\]</span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>Sample_b0 <span class="sc">+</span> <span class="dv">1500</span><span class="sc">*</span>Sample_b1 <span class="co"># calculate b0+1500b1+</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
   394.9499 </code></pre>
</div>
</div>
<p>We estimate that the average price of all 1,500 square foot non-waterfront houses in Seattle is 395 thousand dollars.</p>
<ol start="3" type="1">
<li>The difference between the expected price of a house 1,800 square foot house on the waterfront, compared to a house the same size that is not on the waterfront is given by:</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
&amp; (b_0 + 1800b_1 + b_2 + 1800b_3) - (b_0 + 1800b_1) \\
&amp; = b_2 +1800b_3
\end{aligned}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>Sample_b2<span class="sc">+</span><span class="dv">1800</span><span class="sc">*</span>Sample_b3 <span class="co"># calculate b2+1800b3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>waterfrontYes 
     414.2058 </code></pre>
</div>
</div>
<p>We estimate that on average a 1,800 square foot house on the waterfront will cost 414 thousand dollars more than a 1,800 square foot house not on the waterfront.</p>
<ol start="4" type="1">
<li>The difference in the rate of change in house prices for each additional 100 square feet for houses on the waterfront, compared to houses not on the waterfront.</li>
</ol>
<p>This question is asking about the difference in slopes of the regression lines relating price and square feet for houses on the waterfront, compared to those not on the waterfront.</p>
<p>For houses on the waterfront, the regression equation is</p>
<p><span class="math display">\[ \widehat{Price} = (b_0 + b_2) + (b_1 +b_3)\times\text{Sq. Ft.}, \]</span></p>
<p>so the slope is <span class="math inline">\(b_1 + b_3\)</span>.</p>
<p>For houses not on the waterfront, the regression equation is</p>
<p><span class="math display">\[ \widehat{Price} = b_0 + b_1 \times\text{Sq. Ft.}, \]</span></p>
<p>so the slope is <span class="math inline">\(b_1\)</span>.</p>
<p>These slope pertain to the expected change in price for each additional 1 square foot. So, for a 100-square foot increase, the price of a waterfront house is expected to increase by <span class="math inline">\(100(b_1+b_3)\)</span>, compared to an increase of <span class="math inline">\(100b_1\)</span> for a non-waterfront house. Thus, the difference in the rates of change is <span class="math inline">\(100b_3\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span><span class="sc">*</span>Sample_b3 <span class="co"># calculate 100b3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sqft_living:waterfrontYes 
                 43.26671 </code></pre>
</div>
</div>
<p>We estimate that the price of waterfront houses increases by 43 thousand dollars more for each additional 100 square feet than the price of non-waterfront houses.</p>
<p>These estimates calculated from the sample are statistics, which, like all the other statistics we’ve seen are likely to vary from the true values of the corresponding population parameters, due to variability between samples. We can use bootstrapping to calculate confidence intervals for the relevant population parameters, using these sample statistics (the functions of <span class="math inline">\(b_j\)</span>’s), just as we’ve done for the other statistics we’ve seen.</p>
<p><strong>Bootstrap Steps</strong></p>
<ol type="1">
<li><p>Take a sample of 100 houses by randomly sampling from the original sample, with replacement.</p></li>
<li><p>Fit a regression model with location as the explanatory variable and record the values of regression coefficients <span class="math inline">\(b_0, b_1, b_2, b_3\)</span>. Use these to calculate each of the four desired quantities (i.e.&nbsp;<span class="math inline">\(b_0 + 2000b_1 + b_2 +2000b_3\)</span>)</p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, keeping track of the regression coefficients and calculating the desired quantities in each bootstrap sample.</p></li>
<li><p>Look at the distribution of the quantities of interest, across bootstrap samples. The variability in this bootstrap distribution can be used to approximate the variability in the sampling distribution for each of these quantities.</p></li>
</ol>
<p>We’ll illustrate the procedure on 3 bootstrap samples.</p>
<p><strong>Bootstrap Sample 1</strong></p>
<p>We take the first bootstrap sample and fit a model with interaction. For brevity, we won’t list out the houses in each of the bootstrap samples, as the idea should be clear by now. Model coefficients are shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample1 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(Houses , <span class="dv">100</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)  <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Id) <span class="sc">%&gt;%</span> </span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Id, price, sqft_living, waterfront)   </span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>Mb1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample1, price <span class="sc">~</span> sqft_living <span class="sc">+</span> waterfront <span class="sc">+</span> sqft_living<span class="sc">:</span>waterfront) <span class="co"># fit linear model with interaction</span></span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> Mb1<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># record value of b0 (first coefficient)</span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> Mb1<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record value of b1 (second coefficient)</span></span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> Mb1<span class="sc">$</span>coefficients[<span class="dv">3</span>] <span class="co"># record value of b2 (third coefficient)</span></span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>b3 <span class="ot">&lt;-</span> Mb1<span class="sc">$</span>coefficients[<span class="dv">4</span>] <span class="co"># record value of b3 (fourth coefficient)</span></span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a>Mb1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ sqft_living + waterfront + sqft_living:waterfront, 
    data = BootstrapSample1)

Coefficients:
              (Intercept)                sqft_living  
                  69.4180                     0.2308  
            waterfrontYes  sqft_living:waterfrontYes  
                -444.1795                     0.4229  </code></pre>
</div>
</div>
<p>We calculate each of the four desired quantities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>b0<span class="sc">+</span><span class="dv">2000</span><span class="sc">*</span>b1 <span class="sc">+</span> b2 <span class="sc">+</span> <span class="dv">2000</span><span class="sc">*</span>b3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
   932.7184 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>b0<span class="sc">+</span><span class="dv">1500</span><span class="sc">*</span>b1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
   415.6311 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>b2<span class="sc">+</span><span class="dv">1800</span><span class="sc">*</span>b3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>waterfrontYes 
     317.0968 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span><span class="sc">*</span>b3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sqft_living:waterfrontYes 
                 42.29312 </code></pre>
</div>
</div>
<p><strong>Bootstrap Sample 2</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample2 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(Houses , <span class="dv">100</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)  <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Id) <span class="sc">%&gt;%</span> </span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Id, price, sqft_living, waterfront)   </span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>Mb2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample2, price <span class="sc">~</span> sqft_living <span class="sc">+</span> waterfront <span class="sc">+</span> sqft_living<span class="sc">:</span>waterfront) <span class="co"># fit linear model with interaction</span></span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> Mb2<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># record value of b0 (first coefficient)</span></span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> Mb2<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record value of b1 (second coefficient)</span></span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> Mb2<span class="sc">$</span>coefficients[<span class="dv">3</span>] <span class="co"># record value of b2 (third coefficient)</span></span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a>b3 <span class="ot">&lt;-</span> Mb2<span class="sc">$</span>coefficients[<span class="dv">4</span>] <span class="co"># record value of b3 (fourth coefficient)</span></span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a>Mb2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ sqft_living + waterfront + sqft_living:waterfront, 
    data = BootstrapSample2)

Coefficients:
              (Intercept)                sqft_living  
                 118.2805                     0.1840  
            waterfrontYes  sqft_living:waterfrontYes  
                -337.1774                     0.4875  </code></pre>
</div>
</div>
<p>We calculate each of the four desired quantities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>b0<span class="sc">+</span><span class="dv">2000</span><span class="sc">*</span>b1 <span class="sc">+</span> b2 <span class="sc">+</span> <span class="dv">2000</span><span class="sc">*</span>b3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
    1124.13 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>b0<span class="sc">+</span><span class="dv">1500</span><span class="sc">*</span>b1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
   394.2376 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>b2<span class="sc">+</span><span class="dv">1800</span><span class="sc">*</span>b3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>waterfrontYes 
     540.3978 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span><span class="sc">*</span>b3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sqft_living:waterfrontYes 
                 48.75418 </code></pre>
</div>
</div>
<p><strong>Bootstrap Sample 3</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>BootstrapSample3 <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(Houses , <span class="dv">100</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)  <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Id) <span class="sc">%&gt;%</span> </span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Id, price, sqft_living, waterfront)   </span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>Mb3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample3, price <span class="sc">~</span> sqft_living <span class="sc">+</span> waterfront <span class="sc">+</span> sqft_living<span class="sc">:</span>waterfront) <span class="co"># fit linear model with interaction</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> Mb3<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># record value of b0 (first coefficient)</span></span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> Mb3<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record value of b1 (second coefficient)</span></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> Mb3<span class="sc">$</span>coefficients[<span class="dv">3</span>] <span class="co"># record value of b2 (third coefficient)</span></span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a>b3 <span class="ot">&lt;-</span> Mb3<span class="sc">$</span>coefficients[<span class="dv">4</span>] <span class="co"># record value of b3 (fourth coefficient)</span></span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a>Mb3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ sqft_living + waterfront + sqft_living:waterfront, 
    data = BootstrapSample3)

Coefficients:
              (Intercept)                sqft_living  
                  52.4142                     0.2223  
            waterfrontYes  sqft_living:waterfrontYes  
                -260.6892                     0.3865  </code></pre>
</div>
</div>
<p>We calculate each of the four desired quantities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>b0<span class="sc">+</span><span class="dv">2000</span><span class="sc">*</span>b1 <span class="sc">+</span> b2 <span class="sc">+</span> <span class="dv">2000</span><span class="sc">*</span>b3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
    1009.22 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>b0<span class="sc">+</span><span class="dv">1500</span><span class="sc">*</span>b1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
    385.811 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>b2<span class="sc">+</span><span class="dv">1800</span><span class="sc">*</span>b3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>waterfrontYes 
     434.9802 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span><span class="sc">*</span>b3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sqft_living:waterfrontYes 
                  38.6483 </code></pre>
</div>
</div>
<p>We’ll now take 10,000 different bootstrap samples and record the values of <span class="math inline">\(b_0\)</span>, <span class="math inline">\(b_1\)</span>, <span class="math inline">\(b_3\)</span>, and <span class="math inline">\(b_4\)</span>, which we’ll then use to calculate each of our four desired quantities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Houses, price<span class="sc">~</span>sqft_living <span class="sc">+</span> waterfront <span class="sc">+</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>          sqft_living<span class="sc">:</span>waterfront) <span class="co">#fit model to original sample</span></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>Sample_b0 <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># record b0 value (second coefficient)</span></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>Sample_b1 <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record b1 value (second coefficient)</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>Sample_b2 <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">3</span>] <span class="co"># record b1 value (second coefficient)</span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>Sample_b3 <span class="ot">&lt;-</span> M<span class="sc">$</span>coefficients[<span class="dv">4</span>] <span class="co"># record b1 value (second coefficient)</span></span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a>Sample_Q1 <span class="ot">&lt;-</span> Sample_b0 <span class="sc">+</span> <span class="dv">2000</span><span class="sc">*</span>Sample_b1 <span class="sc">+</span>Sample_b2<span class="sc">+</span><span class="dv">2000</span><span class="sc">*</span>Sample_b3 <span class="co"># calculate b0+2000b1+b2+2000b3</span></span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a>Sample_Q2 <span class="ot">&lt;-</span> Sample_b0 <span class="sc">+</span> <span class="dv">1500</span><span class="sc">*</span>Sample_b1 <span class="co"># calculate b0+1500b1+</span></span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a>Sample_Q3 <span class="ot">&lt;-</span> Sample_b2<span class="sc">+</span><span class="dv">1800</span><span class="sc">*</span>Sample_b3 <span class="co"># calculate b2+1800b3</span></span>
<span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a>Sample_Q4 <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span>Sample_b3 <span class="co"># calculate 100b3</span></span>
<span id="cb247-11"><a href="#cb247-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-12"><a href="#cb247-12" aria-hidden="true" tabindex="-1"></a>Bootstrap_b0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>)  <span class="co">#vector to store b0 values</span></span>
<span id="cb247-13"><a href="#cb247-13" aria-hidden="true" tabindex="-1"></a>Bootstrap_b1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>)  <span class="co">#vector to store b1 values</span></span>
<span id="cb247-14"><a href="#cb247-14" aria-hidden="true" tabindex="-1"></a>Bootstrap_b2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>)  <span class="co">#vector to store b2 values</span></span>
<span id="cb247-15"><a href="#cb247-15" aria-hidden="true" tabindex="-1"></a>Bootstrap_b3 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>)  <span class="co">#vector to store b3 values</span></span>
<span id="cb247-16"><a href="#cb247-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-17"><a href="#cb247-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-18"><a href="#cb247-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>){</span>
<span id="cb247-19"><a href="#cb247-19" aria-hidden="true" tabindex="-1"></a>BootstrapSample <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(Houses, <span class="dv">1000</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)   <span class="co">#take bootstrap sample</span></span>
<span id="cb247-20"><a href="#cb247-20" aria-hidden="true" tabindex="-1"></a>Mb <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>BootstrapSample, price <span class="sc">~</span> sqft_living <span class="sc">+</span> </span>
<span id="cb247-21"><a href="#cb247-21" aria-hidden="true" tabindex="-1"></a>           waterfront <span class="sc">+</span> sqft_living<span class="sc">:</span>waterfront) <span class="co"># fit linear model with interaction</span></span>
<span id="cb247-22"><a href="#cb247-22" aria-hidden="true" tabindex="-1"></a>Bootstrap_b0[i] <span class="ot">&lt;-</span> Mb<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># record value of b0 (first coefficient)</span></span>
<span id="cb247-23"><a href="#cb247-23" aria-hidden="true" tabindex="-1"></a>Bootstrap_b1[i] <span class="ot">&lt;-</span> Mb<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># record value of b1 (second coefficient)</span></span>
<span id="cb247-24"><a href="#cb247-24" aria-hidden="true" tabindex="-1"></a>Bootstrap_b2[i] <span class="ot">&lt;-</span> Mb<span class="sc">$</span>coefficients[<span class="dv">3</span>] <span class="co"># record value of b2 (third coefficient)</span></span>
<span id="cb247-25"><a href="#cb247-25" aria-hidden="true" tabindex="-1"></a>Bootstrap_b3[i] <span class="ot">&lt;-</span> Mb<span class="sc">$</span>coefficients[<span class="dv">4</span>] <span class="co"># record value of b3 (fourth coefficient)</span></span>
<span id="cb247-26"><a href="#cb247-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb247-27"><a href="#cb247-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-28"><a href="#cb247-28" aria-hidden="true" tabindex="-1"></a>Bootstrap_Q1 <span class="ot">&lt;-</span>  Bootstrap_b0 <span class="sc">+</span> <span class="dv">2000</span><span class="sc">*</span>Bootstrap_b1 <span class="sc">+</span> Bootstrap_b2 <span class="sc">+</span> <span class="dv">2000</span><span class="sc">*</span>Bootstrap_b3</span>
<span id="cb247-29"><a href="#cb247-29" aria-hidden="true" tabindex="-1"></a>Bootstrap_Q2 <span class="ot">&lt;-</span>  Bootstrap_b0 <span class="sc">+</span> <span class="dv">1500</span><span class="sc">*</span>Bootstrap_b1 </span>
<span id="cb247-30"><a href="#cb247-30" aria-hidden="true" tabindex="-1"></a>Bootstrap_Q3 <span class="ot">&lt;-</span>  Bootstrap_b2 <span class="sc">+</span> <span class="dv">1800</span><span class="sc">*</span>Bootstrap_b3</span>
<span id="cb247-31"><a href="#cb247-31" aria-hidden="true" tabindex="-1"></a>Bootstrap_Q4 <span class="ot">&lt;-</span>  <span class="dv">100</span><span class="sc">*</span>Bootstrap_b3</span>
<span id="cb247-32"><a href="#cb247-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-33"><a href="#cb247-33" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Bootstrap_b0, Bootstrap_b1, Bootstrap_b2, Bootstrap_b3, Bootstrap_Q1, Bootstrap_Q2 , Bootstrap_Q3 , Bootstrap_Q4)  <span class="co">#save results as dataframe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Bootstrap Distribution for</strong> <span class="math inline">\(b_0 + 2000b_1 + b_2 + 2000b_3\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Plot_Q1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Houses_Bootstrap_Results, </span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">aes</span>(<span class="at">x=</span>Bootstrap_Q1)) <span class="sc">+</span>  </span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>) <span class="sc">+</span> </span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Expected Price of 2000 Sq. Ft. Waterfront House"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>( <span class="st">"Bootstrap Distribution b0+2000b1+b2+2000b3"</span>) </span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Plot_Q1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-160-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Standard Error:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>SE_Q1 <span class="ot">&lt;-</span> <span class="fu">sd</span>(Houses_Bootstrap_Results<span class="sc">$</span>Bootstrap_Q1)</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>SE_Q1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40.03112</code></pre>
</div>
</div>
<p>The bootstrap distribution is symmetric and bell-shaped, so we can use the standard error method to calculate a 95% confidence interval.</p>
<p>95% Confidence Interval:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(Sample_Q1 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_Q1, Sample_Q1 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_Q1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) (Intercept) 
   924.8114   1084.9359 </code></pre>
</div>
</div>
<p>The 95% confidence interval is shown by the gold bar on the graph of the bootstrap distribution below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Plot_Q1 <span class="sc">+</span> </span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sample_Q1 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_Q1,<span class="at">xend=</span>Sample_Q1 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_Q1, <span class="at">y=</span><span class="dv">50</span>, <span class="at">yend=</span><span class="dv">50</span>), </span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">"gold"</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">alpha=</span><span class="fl">0.01</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-163-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We are 95% confident that average price among all 2,000 square foot Seattle waterfront houses is between 924.8114379 and 1084.9359281 thousand dollars.</p>
<p><strong>Bootstrap Distribution for</strong> <span class="math inline">\(b_0 + 1500b_1\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Plot_Q2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Houses_Bootstrap_Results, </span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">aes</span>(<span class="at">x=</span>Bootstrap_Q2)) <span class="sc">+</span>  </span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>) <span class="sc">+</span> </span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Expected Price of 1500 Sq. Ft. Non-Waterfront House"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>( <span class="st">"Bootstrap Distribution b0+1500b1"</span>) </span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Plot_Q2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-164-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Standard Error:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>SE_Q2 <span class="ot">&lt;-</span> <span class="fu">sd</span>(Houses_Bootstrap_Results<span class="sc">$</span>Bootstrap_Q2)</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>SE_Q2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.812557</code></pre>
</div>
</div>
<p>The bootstrap distribution is symmetric and bell-shaped, so we can use the standard error method to calculate a 95% confidence interval.</p>
<p>95% Confidence Interval:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(Sample_Q2 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_Q2, Sample_Q2 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_Q2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) (Intercept) 
   383.3247    406.5750 </code></pre>
</div>
</div>
<p>The 95% confidence interval is shown by the gold bar on the graph of the bootstrap distribution below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Plot_Q2 <span class="sc">+</span> </span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sample_Q2 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_Q2,<span class="at">xend=</span>Sample_Q2 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_Q2, <span class="at">y=</span><span class="dv">50</span>, <span class="at">yend=</span><span class="dv">50</span>), </span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">"gold"</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">alpha=</span><span class="fl">0.01</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-167-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We are 95% confident that average price among all 1,500 square foot Seattle non-waterfront houses is between 383.3247413 and 406.5749705 thousand dollars.</p>
<p><strong>Bootstrap Distribution for</strong> <span class="math inline">\(b_2 + 1800b_3\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Plot_Q3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Houses_Bootstrap_Results, </span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">aes</span>(<span class="at">x=</span>Bootstrap_Q3)) <span class="sc">+</span>  </span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>) <span class="sc">+</span> </span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Expected Price Difference WF vs NWF for 1800 sq. Ft. House"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>( <span class="st">"Bootstrap Distribution b2+1800b3"</span>) </span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Plot_Q3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-168-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Standard Error:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>SE_Q3 <span class="ot">&lt;-</span> <span class="fu">sd</span>(Houses_Bootstrap_Results<span class="sc">$</span>Bootstrap_Q3)</span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>SE_Q3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40.38204</code></pre>
</div>
</div>
<p>The bootstrap distribution is symmetric and bell-shaped, so we can use the standard error method to calculate a 95% confidence interval.</p>
<p>95% Confidence Interval:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(Sample_Q3 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_Q3, Sample_Q3 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_Q3) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>waterfrontYes waterfrontYes 
     333.4417      494.9698 </code></pre>
</div>
</div>
<p>The 95% confidence interval is shown by the gold bar on the graph of the bootstrap distribution below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Plot_Q3 <span class="sc">+</span> </span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sample_Q3 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_Q3,<span class="at">xend=</span>Sample_Q3 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_Q3, <span class="at">y=</span><span class="dv">50</span>, <span class="at">yend=</span><span class="dv">50</span>), </span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">"gold"</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">alpha=</span><span class="fl">0.01</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-171-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We are 95% confident that the average price among all 1800 square feet waterfront houses in Seattle is between 333.441699 and 494.9698429 thousand dollars more than the average price among all non-waterfront houses of the same size.</p>
<p><strong>Bootstrap Distribution for</strong> <span class="math inline">\(100b_3\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Plot_Q4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Houses_Bootstrap_Results, </span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">aes</span>(<span class="at">x=</span>Bootstrap_Q4)) <span class="sc">+</span>  </span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>) <span class="sc">+</span> </span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Expected Difference per 100 square feet"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>( <span class="st">"Bootstrap Distribution 100b3"</span>) </span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Plot_Q4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-172-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Bootstrap Standard Error:</strong> We’ll calculate the bootstrap standard error of the slope <span class="math inline">\(100b_3\)</span>. This is a measure of how much the slope varies between samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>SE_Q4 <span class="ot">&lt;-</span> <span class="fu">sd</span>(Houses_Bootstrap_Results<span class="sc">$</span>Bootstrap_Q4)</span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>SE_Q4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.175838</code></pre>
</div>
</div>
<p>The bootstrap distribution is symmetric and bell-shaped, so we can use the standard error method to calculate a 95% confidence interval.</p>
<p>95% Confidence Interval:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(Sample_Q4 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_Q4, Sample_Q4 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_Q4) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sqft_living:waterfrontYes sqft_living:waterfrontYes 
                 38.91503                  47.61838 </code></pre>
</div>
</div>
<p>The 95% confidence interval is shown by the gold bar on the graph of the bootstrap distribution below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>Houses_Bootstrap_Plot_Q4 <span class="sc">+</span> </span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sample_Q4 <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>SE_Q4,<span class="at">xend=</span>Sample_Q4 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SE_Q4, <span class="at">y=</span><span class="dv">50</span>, <span class="at">yend=</span><span class="dv">50</span>), </span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">"gold"</span>, <span class="at">size=</span><span class="dv">10</span>, <span class="at">alpha=</span><span class="fl">0.01</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-175-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We are 95% confident that for each 100 square foot increase, the average price among all waterfront houses increases by between 38.9150334 and 47.6183836 thousand dollars more than the increase in average price among all non-waterfront.</p>
</section>
<section id="bootstrapping-cautions" class="level3" data-number="3.4.9">
<h3 data-number="3.4.9" class="anchored" data-anchor-id="bootstrapping-cautions"><span class="header-section-number">3.4.9</span> Bootstrapping Cautions</h3>
<p>While bootstrapping is a popular and robust procedure for calculating confidence intervals, it does have cautions and limitations. We should be sure to use the bootstrap procedure appropriate for our context. A standard-error bootstrap interval is appropriate when the sampling distribution for our statistic is roughly symmetric and bell-shaped. When this is not true, a percentile bootstrap interval can be used as long as there are no gaps or breaks in the bootstrap distribution. In situations where there are gaps and breaks in the bootstrap distribution, then the bootstrap distribution may not be a reasonable approximation of the sampling distribution we are interested in.</p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="hypothesis-testing" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="hypothesis-testing"><span class="header-section-number">3.5</span> Hypothesis Testing</h2>
<section id="mercury-levels-in-florida-lakes" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="mercury-levels-in-florida-lakes"><span class="header-section-number">3.5.1</span> Mercury Levels in Florida Lakes</h3>
<p>Recall the 2004 study by Lange, T., Royals, H. and Connor, L., which examined Mercury accumulation in large-mouth bass, taken from a sample of 53 Florida Lakes. If Mercury accumulation exceeds 0.5 ppm, then there are environmental concerns. In fact, the legal safety limit in Canada is 0.5 ppm, although it is 1 ppm in the United States.</p>
<p>In our sample, we have data on 53 lakes, out of more than 30,000 lakes in the the state of Florida.</p>
<p>We are interested in whether mercury levels are higher or lower, on average, in Northern Florida compared to Southern Florida.</p>
<p>We’ll divide the state along route 50, which runs East-West, passing through Northern Orlando.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Florida.png" class="img-fluid figure-img" style="width:30.0%"></p>
<figcaption class="figure-caption">from Google Maps</figcaption>
</figure>
</div>
</div>
</div>
<p>We add a variable indicating whether each lake lies in the northern or southern part of the state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Lock5Data)</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(FloridaLakes)</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Location relative to rt. 50</span></span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>FloridaLakes<span class="sc">$</span>Location <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"S"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>,<span class="st">"N"</span>))</span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>FloridaLakes <span class="ot">&lt;-</span> FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Mercury =</span> AvgMercury)</span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print.data.frame</span>(<span class="fu">data.frame</span>(FloridaLakes<span class="sc">%&gt;%</span> <span class="fu">select</span>(Lake, Location, Mercury)), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Lake Location Mercury
         Alligator        S    1.23
             Annie        S    1.33
            Apopka        N    0.04
      Blue Cypress        S    0.44
             Brick        S    1.20
            Bryant        N    0.27
            Cherry        N    0.48
          Crescent        N    0.19
        Deer Point        N    0.83
              Dias        N    0.81
              Dorr        N    0.71
              Down        S    0.50
             Eaton        N    0.49
 East Tohopekaliga        S    1.16
           Farm-13        N    0.05
            George        N    0.15
           Griffin        N    0.19
            Harney        N    0.77
              Hart        S    1.08
        Hatchineha        S    0.98
           Iamonia        N    0.63
         Istokpoga        S    0.56
           Jackson        N    0.41
         Josephine        S    0.73
          Kingsley        N    0.34
         Kissimmee        S    0.59
         Lochloosa        N    0.34
            Louisa        S    0.84
        Miccasukee        N    0.50
          Minneola        N    0.34
            Monroe        N    0.28
           Newmans        N    0.34
        Ocean Pond        N    0.87
      Ocheese Pond        N    0.56
        Okeechobee        S    0.17
            Orange        N    0.18
       Panasoffkee        N    0.19
            Parker        S    0.04
            Placid        S    0.49
            Puzzle        N    1.10
            Rodman        N    0.16
          Rousseau        N    0.10
           Sampson        N    0.48
             Shipp        S    0.21
           Talquin        N    0.86
            Tarpon        S    0.52
      Tohopekaliga        S    0.65
          Trafford        S    0.27
             Trout        S    0.94
      Tsala Apopka        N    0.40
              Weir        N    0.43
           Wildcat        N    0.25
              Yale        N    0.27</code></pre>
</div>
</div>
<p>We are interested in investigating whether average mercury levels are higher in either Northern Florida or Southern Florida than the other.</p>
<p>The boxplot and table below show the distribution of mercury levels among the 33 northern and 20 southern lakes in the sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>LakesBP <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>FloridaLakes, <span class="fu">aes</span>(<span class="at">x=</span>Location, <span class="at">y=</span>Mercury, <span class="at">fill=</span>Location)) <span class="sc">+</span> </span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span>   <span class="fu">geom_jitter</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Mercury Levels in Florida Lakes"</span>) <span class="sc">+</span> </span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Location"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Mercury Level"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">+</span> <span class="fu">coord_flip</span>() </span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>LakesBP</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-178-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>LakesTable <span class="ot">&lt;-</span> FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Location) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">MeanHg=</span><span class="fu">mean</span>(Mercury), <span class="at">StDevHg=</span><span class="fu">sd</span>(Mercury),  <span class="at">N=</span><span class="fu">n</span>())</span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(LakesTable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Location</th>
<th style="text-align: right;">MeanHg</th>
<th style="text-align: right;">StDevHg</th>
<th style="text-align: right;">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.4245455</td>
<td style="text-align: right;">0.2696652</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.6965000</td>
<td style="text-align: right;">0.3838760</td>
<td style="text-align: right;">20</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We see that on average mercury levels were higher among the southern lakes than the northern ones, a difference of <span class="math inline">\(0.697-0.445= 0.272\)</span> ppm.</p>
</section>
<section id="model-for-mercury-level" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="model-for-mercury-level"><span class="header-section-number">3.5.2</span> Model for Mercury Level</h3>
<p>We can use a statistical model to estimate a lake’s mercury level, using its location (N or S) as our explanatory variable.</p>
<p>The model equation is</p>
<p><span class="math inline">\(\widehat{\text{Hg}} = b_0 +b_1\times\text{South}\)</span></p>
<ul>
<li><span class="math inline">\(b_0\)</span> represents the mean mercury level for lakes in North Florida, and<br>
</li>
<li><span class="math inline">\(b_1\)</span> represents the mean difference in mercury level for lakes in South Florida, compared to North Florida</li>
</ul>
<p>Fitting the model in R, we obtain the estimates for <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>Lakes_M <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>FloridaLakes, Mercury <span class="sc">~</span> Location)</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>Lakes_M</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Mercury ~ Location, data = FloridaLakes)

Coefficients:
(Intercept)    LocationS  
     0.4245       0.2720  </code></pre>
</div>
</div>
<p><span class="math display">\[
\widehat{\text{Hg}} = 0.4245455+0.2719545\times\text{South}
\]</span></p>
<ul>
<li><p><span class="math inline">\(b_1 = 0.272= 0.6965 - 0.4245\)</span> is equal to the difference in mean mercury levels between Northern and Southern lakes. (We’ve already seen that for categorical variables, the least-squares estimate is the mean, so this makes sense.)</p></li>
<li><p>We can use <span class="math inline">\(b_1\)</span> to assess the size of the difference in mean mercury concentration levels.</p></li>
</ul>
</section>
<section id="hypotheses-and-key-question" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="hypotheses-and-key-question"><span class="header-section-number">3.5.3</span> Hypotheses and Key Question</h3>
<p>Since the lakes we observed are only a sample of 53 lakes out of more than 30,000, we cannot assume the difference in mercury concentration for <strong>all</strong> Northern vs Southern Florida lakes is exactly 0.272. Instead, we need to determine whether a difference of this size in our sample is large enough to provide evidence of a difference in average mercury level between <strong>all</strong> Northern and Southern lakes in Florida.</p>
<p>One possible explanation for us getting the results we did in our sample is that there really is no difference in average mercury levels between all lakes in Northern and Southern Florida, and we just happened, by chance, to select more lakes with higher mercury concentrations in Southern Florida than in Northern Florida. A different possible explanation is that there really is a difference in average mercury level between lakes in Northern and Southern Florida.</p>
<p>In a statistical investigation, the <strong>null hypothesis</strong> is the one that says there is no difference between groups , or no relationship between variables in the larger population, and that any difference/relationship observed in our sample occurred merely by chance. The <strong>alternative hypothesis</strong> contradicts the null hypothesis, stating that there is a difference/relationship.</p>
<p>Stated formally, the hypotheses are:</p>
<p><strong>Null Hypothesis:</strong> There is no difference in average mercury level between all lakes in Northern Florida and all lakes in Southern Florida.</p>
<p><strong>Alternative Hypothesis:</strong> There is a difference in average mercury level between all lakes in Northern Florida and all lakes in Southern Florida.</p>
<p>A statistician’s job is to determine whether the data provide strong enough evidence to rule out the null hypothesis.</p>
<p>The question we need to investigate is:</p>
<p>*“How likely is it that we would have observed a difference in means (i.e.&nbsp;a value of* <span class="math inline">\(b_1\)</span>) as extreme as 0.6965-0.4245 = 0.272 ppm, merely by chance, if there is really no relationship between location and mercury level?”</p>
</section>
<section id="permutation-test-for-difference-in-means" class="level3" data-number="3.5.4">
<h3 data-number="3.5.4" class="anchored" data-anchor-id="permutation-test-for-difference-in-means"><span class="header-section-number">3.5.4</span> Permutation Test for Difference in Means</h3>
<p>We can answer the key question using a procedure known as a <strong>permutation test</strong>. In a permutation test, we randomly permute (or shuffle) the values of our explanatory variable to simulate a situation where there is no relationship between our explanatory and response variable. We observe whether it is plausible to observe values of a statistic (in this case the difference in means) as extreme or more extreme than what we saw in the actual data.</p>
<p>We’ll simulate situations where there is no relationship between location and mercury level, and see how often we observe a difference in means (<span class="math inline">\(b_1\)</span>) as extreme as 0.272.</p>
<p><strong>Procedure:</strong></p>
<ol type="1">
<li><p>Randomly shuffle the locations of the lakes, so that any relationship between location and mercury level is due only to chance.</p></li>
<li><p>Calculate the difference in mean mercury levels (i.e.&nbsp;value of <span class="math inline">\(b_1\)</span>) in “Northern” and “Southern” lakes, using the shuffled data. The statistic used to measure the size of the difference or relationship in the sample is called the <strong>test statistic.</strong></p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, recording the test statistic (difference in means, <span class="math inline">\(b_1\)</span>) each time.</p></li>
<li><p>Analyze the distribution of the test statistic (mean difference), simulated under the assumption that there is no relationship between location and mercury level. Look whether the value of the test statistic we observed in the sample (0.272) is consistent with values simulated under the assumption that the null hypothesis is true.</p></li>
</ol>
<p>This simulation can be performed using this <a href="http://www.rossmanchance.com/applets/2021/anovashuffle/AnovaShuffle.htm?hideExtras=2">Rossman-Chance App</a>.</p>
</section>
<section id="five-permutations-in-r" class="level3" data-number="3.5.5">
<h3 data-number="3.5.5" class="anchored" data-anchor-id="five-permutations-in-r"><span class="header-section-number">3.5.5</span> Five Permutations in R</h3>
<p>We’ll use R to perform permutation test.</p>
<p><strong>First Permutation</strong></p>
<p>Recall these groups were randomly assigned, so the only differences in averages are due to random chance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>ShuffledLakes <span class="ot">&lt;-</span> FloridaLakes    <span class="co"># create copy of dataset</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>ShuffledLakes<span class="sc">$</span>Location <span class="ot">&lt;-</span> ShuffledLakes<span class="sc">$</span>Location[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledLakes))] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>Shuffle1df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(FloridaLakes<span class="sc">$</span>Lake, FloridaLakes<span class="sc">$</span>Location, </span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>                         FloridaLakes<span class="sc">$</span>Mercury, ShuffledLakes<span class="sc">$</span>Location)</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Shuffle1df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Lake"</span>, <span class="st">"Location"</span>, <span class="st">"Mercury"</span>, <span class="st">"Shuffled Location"</span>)</span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Shuffle1df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Lake</th>
<th style="text-align: left;">Location</th>
<th style="text-align: right;">Mercury</th>
<th style="text-align: left;">Shuffled Location</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alligator</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.23</td>
<td style="text-align: left;">S</td>
</tr>
<tr class="even">
<td style="text-align: left;">Annie</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Apopka</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="even">
<td style="text-align: left;">Blue Cypress</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: left;">S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brick</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bryant</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: left;">S</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Notice that the locations of the lakes have now been mixed up and assigned randomly. So, any relationship between location and mercury level will have occurred merely by chance.</p>
<p>We create a boxplot and calculate the difference in mean mercury levels for the shuffled data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>LakesPerm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Shuffle1df, <span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>, </span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">y=</span>Mercury, <span class="at">fill=</span><span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span>   <span class="fu">geom_jitter</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Mercury Levels in Florida Lakes"</span>) <span class="sc">+</span> </span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Location"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Mercury Level"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a>LakesPerm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-183-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>LakesPermTable <span class="ot">&lt;-</span> Shuffle1df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">MeanHg=</span><span class="fu">mean</span>(Mercury), <span class="at">StDevHg=</span><span class="fu">sd</span>(Mercury),  <span class="at">N=</span><span class="fu">n</span>())</span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(LakesPermTable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Shuffled Location</th>
<th style="text-align: right;">MeanHg</th>
<th style="text-align: right;">StDevHg</th>
<th style="text-align: right;">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.4978788</td>
<td style="text-align: right;">0.3536308</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.5755000</td>
<td style="text-align: right;">0.3220898</td>
<td style="text-align: right;">20</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Notice that the sample means are not identical. We observe a difference of -0.0776212 just by chance associated with the assignment of the lakes to their random location groups.</p>
<p>This difference is considerably smaller than the difference of 0.272 that we saw in the actual data, suggesting that perhaps a difference as big as 0.272 would not be likely to occur by chance. Before we can be sure of this, however, we should repeat our simulation many times to get a better sense for how big of a difference we might reasonable expect to occur just by chance.</p>
<p><strong>Second Permutation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>ShuffledLakes <span class="ot">&lt;-</span> FloridaLakes    <span class="do">## create copy of dataset</span></span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>ShuffledLakes<span class="sc">$</span>Location <span class="ot">&lt;-</span> ShuffledLakes<span class="sc">$</span>Location[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledLakes))] </span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Shuffle1df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Lake</th>
<th style="text-align: left;">Location</th>
<th style="text-align: right;">Mercury</th>
<th style="text-align: left;">Shuffled Location</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alligator</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.23</td>
<td style="text-align: left;">S</td>
</tr>
<tr class="even">
<td style="text-align: left;">Annie</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Apopka</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="even">
<td style="text-align: left;">Blue Cypress</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: left;">S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brick</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bryant</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: left;">S</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>Shuffle1df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(FloridaLakes<span class="sc">$</span>Lake, FloridaLakes<span class="sc">$</span>Location, FloridaLakes<span class="sc">$</span>Mercury, ShuffledLakes<span class="sc">$</span>Location)</span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Shuffle1df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Lake"</span>, <span class="st">"Location"</span>, <span class="st">"Mercury"</span>, <span class="st">"Shuffled Location"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>LakesPerm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Shuffle1df, <span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>, <span class="at">y=</span>Mercury, <span class="at">fill=</span><span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span>   <span class="fu">geom_jitter</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Mercury Levels in Florida Lakes"</span>) <span class="sc">+</span> </span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Location"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Mercury Level"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a>LakesPerm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-187-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>LakesPermTable <span class="ot">&lt;-</span> Shuffle1df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">MeanHg=</span><span class="fu">mean</span>(Mercury), <span class="at">StDevHg=</span><span class="fu">sd</span>(Mercury),  <span class="at">N=</span><span class="fu">n</span>())</span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(LakesPermTable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Shuffled Location</th>
<th style="text-align: right;">MeanHg</th>
<th style="text-align: right;">StDevHg</th>
<th style="text-align: right;">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.4866667</td>
<td style="text-align: right;">0.3676332</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.5940000</td>
<td style="text-align: right;">0.2883236</td>
<td style="text-align: right;">20</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Third Permutation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>ShuffledLakes <span class="ot">&lt;-</span> FloridaLakes    <span class="do">## create copy of dataset</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>ShuffledLakes<span class="sc">$</span>Location <span class="ot">&lt;-</span> ShuffledLakes<span class="sc">$</span>Location[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledLakes))] </span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Shuffle1df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Lake</th>
<th style="text-align: left;">Location</th>
<th style="text-align: right;">Mercury</th>
<th style="text-align: left;">Shuffled Location</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alligator</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.23</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="even">
<td style="text-align: left;">Annie</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Apopka</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="even">
<td style="text-align: left;">Blue Cypress</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: left;">S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brick</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: left;">S</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bryant</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: left;">N</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>Shuffle1df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(FloridaLakes<span class="sc">$</span>Lake, FloridaLakes<span class="sc">$</span>Location, FloridaLakes<span class="sc">$</span>Mercury, ShuffledLakes<span class="sc">$</span>Location)</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Shuffle1df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Lake"</span>, <span class="st">"Location"</span>, <span class="st">"Mercury"</span>, <span class="st">"Shuffled Location"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>LakesPerm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Shuffle1df, <span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>, <span class="at">y=</span>Mercury, <span class="at">fill=</span><span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span>   <span class="fu">geom_jitter</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Mercury Levels in Florida Lakes"</span>) <span class="sc">+</span> </span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Location"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Mercury Level"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>LakesPerm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-191-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>LakesPermTable <span class="ot">&lt;-</span> Shuffle1df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">MeanHg=</span><span class="fu">mean</span>(Mercury), <span class="at">StDevHg=</span><span class="fu">sd</span>(Mercury),  <span class="at">N=</span><span class="fu">n</span>())</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(LakesPermTable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Shuffled Location</th>
<th style="text-align: right;">MeanHg</th>
<th style="text-align: right;">StDevHg</th>
<th style="text-align: right;">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.4760606</td>
<td style="text-align: right;">0.3406514</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.6115000</td>
<td style="text-align: right;">0.3329339</td>
<td style="text-align: right;">20</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Fourth Permutation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>ShuffledLakes <span class="ot">&lt;-</span> FloridaLakes    <span class="do">## create copy of dataset</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>ShuffledLakes<span class="sc">$</span>Location <span class="ot">&lt;-</span> ShuffledLakes<span class="sc">$</span>Location[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledLakes))] </span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Shuffle1df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Lake</th>
<th style="text-align: left;">Location</th>
<th style="text-align: right;">Mercury</th>
<th style="text-align: left;">Shuffled Location</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alligator</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.23</td>
<td style="text-align: left;">S</td>
</tr>
<tr class="even">
<td style="text-align: left;">Annie</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: left;">S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Apopka</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="even">
<td style="text-align: left;">Blue Cypress</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: left;">S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brick</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bryant</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: left;">N</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>Shuffle1df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(FloridaLakes<span class="sc">$</span>Lake, FloridaLakes<span class="sc">$</span>Location, FloridaLakes<span class="sc">$</span>Mercury, ShuffledLakes<span class="sc">$</span>Location)</span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Shuffle1df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Lake"</span>, <span class="st">"Location"</span>, <span class="st">"Mercury"</span>, <span class="st">"Shuffled Location"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a>LakesPerm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Shuffle1df, <span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>, <span class="at">y=</span>Mercury, <span class="at">fill=</span><span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span>   <span class="fu">geom_jitter</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Mercury Levels in Florida Lakes"</span>) <span class="sc">+</span> </span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Location"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Mercury Level"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>LakesPerm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-195-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>LakesPermTable <span class="ot">&lt;-</span> Shuffle1df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">MeanHg=</span><span class="fu">mean</span>(Mercury), <span class="at">StDevHg=</span><span class="fu">sd</span>(Mercury),  <span class="at">N=</span><span class="fu">n</span>())</span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(LakesPermTable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Shuffled Location</th>
<th style="text-align: right;">MeanHg</th>
<th style="text-align: right;">StDevHg</th>
<th style="text-align: right;">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.5315152</td>
<td style="text-align: right;">0.3750343</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.5200000</td>
<td style="text-align: right;">0.2851961</td>
<td style="text-align: right;">20</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Fifth Permutation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>ShuffledLakes <span class="ot">&lt;-</span> FloridaLakes    <span class="do">## create copy of dataset</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>ShuffledLakes<span class="sc">$</span>Location <span class="ot">&lt;-</span> ShuffledLakes<span class="sc">$</span>Location[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledLakes))] </span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Shuffle1df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Lake</th>
<th style="text-align: left;">Location</th>
<th style="text-align: right;">Mercury</th>
<th style="text-align: left;">Shuffled Location</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alligator</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.23</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="even">
<td style="text-align: left;">Annie</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Apopka</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="even">
<td style="text-align: left;">Blue Cypress</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brick</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bryant</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: left;">N</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>Shuffle1df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(FloridaLakes<span class="sc">$</span>Lake, FloridaLakes<span class="sc">$</span>Location, FloridaLakes<span class="sc">$</span>Mercury, ShuffledLakes<span class="sc">$</span>Location)</span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Shuffle1df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Lake"</span>, <span class="st">"Location"</span>, <span class="st">"Mercury"</span>, <span class="st">"Shuffled Location"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a>LakesPerm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Shuffle1df, <span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>, <span class="at">y=</span>Mercury, <span class="at">fill=</span><span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span>   <span class="fu">geom_jitter</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Mercury Levels in Florida Lakes"</span>) <span class="sc">+</span> </span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Location"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Mercury Level"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a>LakesPerm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-199-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>LakesPermTable <span class="ot">&lt;-</span> Shuffle1df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Shuffled Location</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">MeanHg=</span><span class="fu">mean</span>(Mercury), <span class="at">StDevHg=</span><span class="fu">sd</span>(Mercury),  <span class="at">N=</span><span class="fu">n</span>())</span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(LakesPermTable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Shuffled Location</th>
<th style="text-align: right;">MeanHg</th>
<th style="text-align: right;">StDevHg</th>
<th style="text-align: right;">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.5054545</td>
<td style="text-align: right;">0.3339357</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.5630000</td>
<td style="text-align: right;">0.3582281</td>
<td style="text-align: right;">20</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="r-code-for-permutation-test" class="level3" data-number="3.5.6">
<h3 data-number="3.5.6" class="anchored" data-anchor-id="r-code-for-permutation-test"><span class="header-section-number">3.5.6</span> R Code for Permutation Test</h3>
<p>We’ll write a <code>for</code> loop to perform 10,000 permutations and record the value of <span class="math inline">\(b_1\)</span> (the difference in sample means) for each simulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> Lakes_M<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="do">## record value of b1 from actual data</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a><span class="do">## perform simulation</span></span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a>b1Sim <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>)          <span class="do">## vector to hold results</span></span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a>ShuffledLakes <span class="ot">&lt;-</span> FloridaLakes    <span class="do">## create copy of dataset</span></span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>){</span>
<span id="cb298-7"><a href="#cb298-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#randomly shuffle locations</span></span>
<span id="cb298-8"><a href="#cb298-8" aria-hidden="true" tabindex="-1"></a>ShuffledLakes<span class="sc">$</span>Location <span class="ot">&lt;-</span> ShuffledLakes<span class="sc">$</span>Location[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledLakes))] </span>
<span id="cb298-9"><a href="#cb298-9" aria-hidden="true" tabindex="-1"></a>ShuffledLakes_M<span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>ShuffledLakes, Mercury <span class="sc">~</span> Location)   <span class="co">#fit model to shuffled data</span></span>
<span id="cb298-10"><a href="#cb298-10" aria-hidden="true" tabindex="-1"></a>b1Sim[i] <span class="ot">&lt;-</span> ShuffledLakes_M<span class="sc">$</span>coef[<span class="dv">2</span>]  <span class="do">## record b1 from shuffled model</span></span>
<span id="cb298-11"><a href="#cb298-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb298-12"><a href="#cb298-12" aria-hidden="true" tabindex="-1"></a>NSLakes_SimulationResults <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(b1Sim)  <span class="co">#save results in dataframe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The histogram shows the distribution of differences in the group means observed in our simulation. The red lines indicate the difference we actually observed in the data (0.272), as well as an equally large difference in the opposite direction (-0.272).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>NSLakes_SimulationResultsPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>NSLakes_SimulationResults, </span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">aes</span>(<span class="at">x=</span>b1Sim)) <span class="sc">+</span> </span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fu">c</span>(b1, <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>b1), <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Lakes: Simulated Value of b1"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span> </span>
<span id="cb299-6"><a href="#cb299-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of b1 under assumption of no relationship"</span>)</span>
<span id="cb299-7"><a href="#cb299-7" aria-hidden="true" tabindex="-1"></a>NSLakes_SimulationResultsPlot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-202-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The red lines are quite extreme, relative to the simulated values shown in the histogram. Based on the simulation, it is rare to obtain a difference as extreme as the 0.272 value we saw in the actual data, by chance when there is actually no difference in average mercury levels between Northern and Southern Florida lakes.</p>
<p>We calculate the precise number of simulations (out of 10,000) resulting in difference in means more extreme than 0.27195.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">abs</span>(b1Sim) <span class="sc">&gt;</span> <span class="fu">abs</span>(b1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 39</code></pre>
</div>
</div>
<p>The proportion of simulations resulting in difference in means more extreme than 0.272 is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">abs</span>(b1Sim) <span class="sc">&gt;</span> <span class="fu">abs</span>(b1))<span class="sc">/</span><span class="dv">10000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0039</code></pre>
</div>
</div>
<p>We only observed a difference between the groups as extreme or more extreme than the 0.272 difference we saw in the sample in a proportion of 0.0039 of our simulations (less than 1%).</p>
<p>The probability of getting a difference in means as extreme or more extreme than 0.272 ppm by chance, when there is no relationship between location and mercury level is about 0.0039. In other words, it is very unlikely that we would have observed a result like we did by chance alone. Thus, we have strong evidence that there is a difference in average mercury level between lakes in Northern and Southern Florida. In this case, there is strong evidence that mercury level is higher in Southern Florida lakes than Northern Florida lakes.</p>
<p>Recall that in the previous chapter, we found that we could be 95% confident that the mean mercury level among all lakes in Southern Florida is between 0.08 and 0.46 higher than the mean mercury level among all lakes in Northern Florida.</p>
</section>
<section id="p-values" class="level3" data-number="3.5.7">
<h3 data-number="3.5.7" class="anchored" data-anchor-id="p-values"><span class="header-section-number">3.5.7</span> p-values</h3>
<p>The <strong>p-value</strong> represents the probability of getting a test statistic as extreme or more extreme than we did in our sample when the null hypothesis is true.</p>
<p>In this situation, the p-value represents the probability of observing a difference in sample means as extreme or more extreme than 0.272 if there is actually no difference in average mercury level among all lakes in Northern Florida, compared to Southern Florida.</p>
<p>In our study, the p-value was 0.0039, which is very low. This provides strong evidence against the null hypothesis that there is no difference in average mercury levels between all Northern and Southern Florida lakes.</p>
<p>A low p-value tells us that the difference in average Mercury levels that we saw in our sample is unlikely to have occurred by chance, providing evidence that there is indeed a difference in average Mercury levels between Northern and Southern lakes.</p>
<p>The p-value does not tell us anything about the size of the difference! If the difference is really small (say 0.001 ppm), perhaps there is no need to worry about it. It is possible to get a small p-value even when the true difference is very small (especially when our sample size is large). In addition to a p-value, we should consider whether a difference is big enough to be meaningful in a practical way, before making any policy decisions.</p>
<p>For now, we can use the difference in sample means of 0.272 ppm as an estimate of the size of the difference. Based on our limited knowledge of mercury levels, this does seem big enough to merit further investigation, and possible action.</p>
<p>At this point, a reasonable question is “how small must a p-value be in order to provide evidence against the null hypothesis?” While it is sometimes common to establish strict cutoffs for what counts as a small p-value (such as <span class="math inline">\(&lt;0.05\)</span>), the American Statistical Association does not recommend this. In reality, a p-value of 0.04 is practically no different than a p-value of 0.06. Rather than using strict cutoffs for what counts as small, it is better to interpreting p-values on a sliding scale, as illustrated in the diagram below. A p-value of 0.10 or less provides at least some evidence against a null hypothesis, and the smaller the p-value is, the stronger the evidence gets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"pvals.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="pvals.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="more-hypothesis-test-examples" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="more-hypothesis-test-examples"><span class="header-section-number">3.6</span> More Hypothesis Test Examples</h2>
<section id="other-test-statistics" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="other-test-statistics"><span class="header-section-number">3.6.1</span> Other Test Statistics</h3>
<p>The permutation test procedure can be used to test hypotheses involving lots of different test statistics, in addition to testing for a difference in means, as we saw seen in the previous section. For example we could test whether there is evidence of:</p>
<ol type="1">
<li><p>a difference in the median mercury level between lakes in Northern Florida, compared to southern Florida</p></li>
<li><p>a difference in the amount of variability in mercury levels between lakes in Northern Florida, compared to southern Florida<br>
</p></li>
<li><p>a difference in the proportion of lakes whose mercury level exceeds 1 ppm between lakes in Northern Florida, compared to southern Florida<br>
</p></li>
<li><p>a difference in mean price between King County houses in very good, good, and average or below conditions</p></li>
<li><p>a relationship between mercury level and pH level among all Florida lakes</p></li>
</ol>
<p>For each of these investigations, the null hypothesis will be that there is no difference or relationship among all lakes (that is, whatever difference or relationship occurred in the sample occurred just by random chance). We’ll need to find a test statistic that measures the quantity we’re interested in (for example, difference in means). Then, we use the permutation procedure to simulate a scenario where our null hypothesis is true, and see if test statistic we saw in our data is consistent with the ones we simulate under the null hypothesis.</p>
</section>
<section id="general-permutation-test-procedure" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="general-permutation-test-procedure"><span class="header-section-number">3.6.2</span> General Permutation Test Procedure</h3>
<p><strong>Procedure:</strong></p>
<ol type="1">
<li><p>Randomly shuffle the values or categories of the explanatory variable, so that any relationship between the explanatory and response variable occurs just by chance.</p></li>
<li><p>Calculate the test statistic on the shuffled data.</p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, recording the test statistic each time.</p></li>
<li><p>Analyze the distribution of the test statistic, simulated under the assumption that the null hypothesis is true. Look whether the value of the test statistic we observed in the sample is consistent with values simulated under the assumption that the null hypothesis is true. (We might calculate a p-value, which represents the proportion of simulations in which we observed a test statistic as extreme or more extreme than the one we saw in our actual sample.)</p></li>
</ol>
<p>Next, we’ll apply these steps to questions 2, 4, and 5 from the previous subsection.</p>
</section>
<section id="difference-in-standard-deviation" class="level3" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="difference-in-standard-deviation"><span class="header-section-number">3.6.3</span> Difference in Standard Deviation</h3>
<p>We’ll test whether there is evidence of a difference in variability between lakes in Northern Florida, compared to Southern Florida. Since standard deviation is a measure of variability, we’ll use the difference in standard deviation in Northern vs Southern lakes as our test statistic.</p>
<p>Recall that the standard deviation among the 53 Northern Florida Lakes in our sample was 0.270 ppm, which is lower than the 0.384 ppm in Southern Florida.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(LakesTable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Location</th>
<th style="text-align: right;">MeanHg</th>
<th style="text-align: right;">StDevHg</th>
<th style="text-align: right;">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">N</td>
<td style="text-align: right;">0.4245455</td>
<td style="text-align: right;">0.2696652</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.6965000</td>
<td style="text-align: right;">0.3838760</td>
<td style="text-align: right;">20</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The test statistic we observe in our sample is <span class="math inline">\(0.2696-0.3839 = -0.1142\)</span> ppm.</p>
<p>We need to determine whether a difference this large could have plausibly occurred in our sample, just by chance, if there is really no difference in standard deviation among all lakes in Northern Florida, compared to Southern Florida.</p>
<p><strong>Null Hypothesis:</strong> There is no difference in standard deviation of mercury levels between all lakes in Northern Florida and all lakes in Southern Florida.</p>
<p><strong>Alternative Hypothesis:</strong> There is a difference in standard deviation of mercury levels between all lakes in Northern Florida and all lakes in Southern Florida.</p>
<p>We’ll apply the general hypothesis testing procedure, using standard deviation as our test statistic.</p>
<p><strong>Procedure:</strong></p>
<ol type="1">
<li><p>Randomly shuffle the locations of the lakes, so that any relationship between the location and mercury level occurs just by chance.</p></li>
<li><p>Calculate the difference in standard deviation between lakes in the two samples of the shuffled data.</p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, recording the difference in standard deviations each time.</p></li>
<li><p>Analyze the distribution of difference in standard deviations, simulated under the assumption that there is no difference in standard deviations between North and South. Look whether the value of the test statistic we observed in the sample is consistent with values simulated under the assumption that there is no difference in standard deviations.</p></li>
</ol>
<p><strong>R Code for Permutation Test</strong></p>
<p>We’ll write a <code>for</code> loop to perform 10,000 permutations and record the value of <span class="math inline">\(b_1\)</span> (the difference in sample means) for each simulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>SDTab <span class="ot">&lt;-</span> FloridaLakes <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Location) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">SD=</span><span class="fu">sd</span>(Mercury))</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>DiffSD <span class="ot">&lt;-</span> SDTab<span class="sc">$</span>SD[<span class="dv">2</span>] <span class="sc">-</span> SDTab<span class="sc">$</span>SD[<span class="dv">1</span>] </span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a><span class="do">## perform simulation</span></span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a>DiffSim <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>)          <span class="do">## vector to hold results</span></span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a>ShuffledLakes <span class="ot">&lt;-</span> FloridaLakes    <span class="do">## create copy of dataset</span></span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>){</span>
<span id="cb306-8"><a href="#cb306-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#randomly shuffle locations</span></span>
<span id="cb306-9"><a href="#cb306-9" aria-hidden="true" tabindex="-1"></a>ShuffledLakes<span class="sc">$</span>Location <span class="ot">&lt;-</span> ShuffledLakes<span class="sc">$</span>Location[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledLakes))] </span>
<span id="cb306-10"><a href="#cb306-10" aria-hidden="true" tabindex="-1"></a>SDTabSim <span class="ot">&lt;-</span> ShuffledLakes <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Location) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">SD=</span><span class="fu">sd</span>(Mercury))</span>
<span id="cb306-11"><a href="#cb306-11" aria-hidden="true" tabindex="-1"></a>DiffSim[i] <span class="ot">&lt;-</span> SDTabSim<span class="sc">$</span>SD[<span class="dv">2</span>] <span class="sc">-</span> SDTabSim<span class="sc">$</span>SD[<span class="dv">1</span>] <span class="co">#record difference in SD for simulated data</span></span>
<span id="cb306-12"><a href="#cb306-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb306-13"><a href="#cb306-13" aria-hidden="true" tabindex="-1"></a>NSLakes_SDSimResults <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(DiffSim)  <span class="co">#save results in dataframe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The distribution of the simulated differences in standard deviation is shown below. Recall that these were simulated assuming that the null hypothesis, that there is no difference in standard deviation of mercury levels among all lakes in Northern Florida, compared to Southern Florida is true.</p>
<p>The red lines represent differences as extreme as -0.1142 that we saw in our sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>NSLakes_SDSimResultsPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>NSLakes_SDSimResults, <span class="fu">aes</span>(<span class="at">x=</span>DiffSim)) <span class="sc">+</span> </span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fu">c</span>(DiffSD, <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>DiffSD), <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Simulated Difference in SD's"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span> </span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of Difference in SD under assumption of no relationship"</span>)</span>
<span id="cb307-6"><a href="#cb307-6" aria-hidden="true" tabindex="-1"></a>NSLakes_SDSimResultsPlot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-208-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We calculate the number of simulations (out of 10,000) resulting in standard deviations greater the 0.1142.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">abs</span>(DiffSim) <span class="sc">&gt;</span> <span class="fu">abs</span>(DiffSD))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 614</code></pre>
</div>
</div>
<p><strong>p-value:</strong> Proportion of simulations (out of 10,000) resulting in difference in standard deviations greater the 0.1142.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">abs</span>(DiffSim) <span class="sc">&gt;</span> <span class="fu">abs</span>(DiffSD))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0614</code></pre>
</div>
</div>
<p>This p-value represents the probability of observing a difference in sample standard deviations as extreme as 0.1142 in a samples of size 33 and 20 by chance, if in fact, the standard deviation in mercury concentration levels is the same for lakes in Northern Florida as in Southern Florida.</p>
<p>Since the p-value is small, it is unlikely that we would observe a difference in standard deviations as extreme as 0.1142 by chance. There is evidence that lakes in Southern Florida exhibit more variability in mercury levels than lakes in Northern Florida (though the evidence is not as strong as it was when we were testing for a difference in means).</p>
<p>Note that we have avoided the fallacy of using 0.05 as a strict cutoff for rejecting the null hypothesis.</p>
<p>Although the difference in standard deviations is statistically discernible, it is hard to say whether it is practically meaningful. Without knowing a lot about mercury levels, and their impact on the ecosystem, it’s harder to tell whether an estimated difference in standard deviations of 0.11 ppm is meaningful or not. It would be good to consult a biologist before making any decisions based on these results.</p>
</section>
<section id="slope-of-regression-line" class="level3" data-number="3.6.4">
<h3 data-number="3.6.4" class="anchored" data-anchor-id="slope-of-regression-line"><span class="header-section-number">3.6.4</span> Slope of Regression Line</h3>
<p>In addition to the mercury levels of the Florida lakes, we have data on the pH level of each lake. pH level measures the acidity of a lake, ranging from 0 to 14, with 7 being neutral, and lower levels indicating more acidity. We plot the pH level against the mercury level in our sample of 53 lakes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>FloridaLakes, <span class="fu">aes</span>(<span class="at">y=</span>Mercury, <span class="at">x=</span>pH)) <span class="sc">+</span> </span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-211-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The regression equation is</p>
<p><span class="math display">\[
\widehat{\text{Mercury}} = b_0 + b_1\times\text{pH}
\]</span></p>
<p>Regression estimates <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> are shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a>Lakes_M_pH <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>FloridaLakes, Mercury<span class="sc">~</span>pH)</span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a>Lakes_M_pH</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Mercury ~ pH, data = FloridaLakes)

Coefficients:
(Intercept)           pH  
     1.5309      -0.1523  </code></pre>
</div>
</div>
<p>We can use the slope of the regression line <span class="math inline">\(b_1\)</span> to measure the strength relationship between Mercury and pH. Based on our sample, each one-unit increase in pH, mercury level is expected to decrease by 0.15 ppm.</p>
<p>If there was really no relationship, then the slope among all lakes would be 0. But, of course, we would not expect the slope in our sample to exactly match the slope for all lakes. Our question of interest is whether it is plausible that we could have randomly selected a sample resulting in a slope as extreme as 0.15 by chance, when there is actually no relationship between mercury and pH levels, among all lakes. In other words, could we plausible have drawn the sample of 53 lakes shown in blue from a population like the one in red, shown below?</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-213-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Key Question:</strong></p>
<ul>
<li>How likely is it that we would have observed a slope (i.e.&nbsp;a value of <span class="math inline">\(b_1\)</span>) as extreme as 0.15 by chance, if there is really no relationship between mercury level and pH?</li>
</ul>
<p><strong>Null Hypothesis:</strong> Among all Florida lakes, there is no relationship between mercury level and pH.</p>
<p><strong>Alternative Hypothesis:</strong> Among all Florida lakes, there is a relationship between mercury level and pH.</p>
<p><strong>Procedure:</strong></p>
<ol type="1">
<li><p>Randomly shuffle the pH values, so that any relationship between acceleration mercury and pH is due only to chance.</p></li>
<li><p>Fit a regression line to the shuffled data and record the slope of the regression line.</p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, recording the slope (i.e.&nbsp;value of <span class="math inline">\(b_1\)</span>) each time.</p></li>
<li><p>Analyze the distribution of slopes, simulated under the assumption that there is no relationship between mercury and pH. Look whether the actual slope we observed is consistent with the simulation results.</p></li>
</ol>
<p>We’ll illustrate the first three permutations.</p>
<p><strong>First Permutation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a>ShuffledLakes <span class="ot">&lt;-</span> FloridaLakes    <span class="do">## create copy of dataset</span></span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a>ShuffledLakes<span class="sc">$</span>pH <span class="ot">&lt;-</span> ShuffledLakes<span class="sc">$</span>pH[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledLakes))] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>Shuffle1df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(ShuffledLakes<span class="sc">$</span>Lake, FloridaLakes<span class="sc">$</span>Mercury, FloridaLakes<span class="sc">$</span>pH, ShuffledLakes<span class="sc">$</span>pH)</span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Shuffle1df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Lake"</span>, <span class="st">"Mercury"</span>, <span class="st">"pH"</span>, <span class="st">"Shuffled_pH"</span>)</span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Shuffle1df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Lake</th>
<th style="text-align: right;">Mercury</th>
<th style="text-align: right;">pH</th>
<th style="text-align: right;">Shuffled_pH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alligator</td>
<td style="text-align: right;">1.23</td>
<td style="text-align: right;">6.1</td>
<td style="text-align: right;">8.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Annie</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">7.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Apopka</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">9.1</td>
<td style="text-align: right;">6.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Blue Cypress</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">6.9</td>
<td style="text-align: right;">4.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brick</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">5.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bryant</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">7.3</td>
<td style="text-align: right;">7.8</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The red line indicates the slope of the regression line fit to the shuffled data. The blue line indicates the regression line for the actual lakes in the sampe, which has a slope of -0.15.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Shuffle1df, <span class="fu">aes</span>(<span class="at">x=</span>Shuffled_pH, <span class="at">y=</span>Mercury)) <span class="sc">+</span> </span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span>)) <span class="sc">+</span> </span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="sc">-</span><span class="fl">0.1523</span>, <span class="at">intercept=</span><span class="fl">1.5309</span>, <span class="at">color=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-216-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Slope of regression line from permuted data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>M_Lakes_Shuffle <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Shuffle1df, Mercury<span class="sc">~</span>Shuffled_pH)</span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(M_Lakes_Shuffle)<span class="sc">$</span>coef[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03934635</code></pre>
</div>
</div>
<p><strong>Second Permutation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>ShuffledLakes <span class="ot">&lt;-</span> FloridaLakes    <span class="do">## create copy of dataset</span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a>ShuffledLakes<span class="sc">$</span>pH <span class="ot">&lt;-</span> ShuffledLakes<span class="sc">$</span>pH[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledLakes))] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a>Shuffle2df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(ShuffledLakes<span class="sc">$</span>Lake, FloridaLakes<span class="sc">$</span>Mercury, FloridaLakes<span class="sc">$</span>pH, ShuffledLakes<span class="sc">$</span>pH)</span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Shuffle2df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Lake"</span>, <span class="st">"Mercury"</span>, <span class="st">"pH"</span>, <span class="st">"Shuffled_pH"</span>)</span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Shuffle2df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Lake</th>
<th style="text-align: right;">Mercury</th>
<th style="text-align: right;">pH</th>
<th style="text-align: right;">Shuffled_pH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alligator</td>
<td style="text-align: right;">1.23</td>
<td style="text-align: right;">6.1</td>
<td style="text-align: right;">4.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Annie</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">7.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Apopka</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">9.1</td>
<td style="text-align: right;">7.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Blue Cypress</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">6.9</td>
<td style="text-align: right;">5.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brick</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">7.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bryant</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">7.3</td>
<td style="text-align: right;">6.7</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Shuffle2df, <span class="fu">aes</span>(<span class="at">x=</span>Shuffled_pH, <span class="at">y=</span>Mercury)) <span class="sc">+</span> </span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span>)) <span class="sc">+</span> </span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="sc">-</span><span class="fl">0.1523</span>, <span class="at">intercept=</span><span class="fl">1.5309</span>, <span class="at">color=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-220-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Slope of regression line from permuted data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>M_Lakes_Shuffle <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Shuffle2df, Mercury<span class="sc">~</span>Shuffled_pH)</span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(M_Lakes_Shuffle)<span class="sc">$</span>coef[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.009030783</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a>ShuffledLakes <span class="ot">&lt;-</span> FloridaLakes    <span class="do">## create copy of dataset</span></span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a>ShuffledLakes<span class="sc">$</span>pH <span class="ot">&lt;-</span> ShuffledLakes<span class="sc">$</span>pH[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledLakes))] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>Shuffle3df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(ShuffledLakes<span class="sc">$</span>Lake, FloridaLakes<span class="sc">$</span>Mercury, FloridaLakes<span class="sc">$</span>pH, ShuffledLakes<span class="sc">$</span>pH)</span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Shuffle3df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Lake"</span>, <span class="st">"Mercury"</span>, <span class="st">"pH"</span>, <span class="st">"Shuffled_pH"</span>)</span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Shuffle3df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Lake</th>
<th style="text-align: right;">Mercury</th>
<th style="text-align: right;">pH</th>
<th style="text-align: right;">Shuffled_pH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alligator</td>
<td style="text-align: right;">1.23</td>
<td style="text-align: right;">6.1</td>
<td style="text-align: right;">7.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Annie</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">6.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Apopka</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">9.1</td>
<td style="text-align: right;">8.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Blue Cypress</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">6.9</td>
<td style="text-align: right;">7.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brick</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">6.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bryant</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">7.3</td>
<td style="text-align: right;">7.2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Shuffle3df, <span class="fu">aes</span>(<span class="at">x=</span>Shuffled_pH, <span class="at">y=</span>Mercury)) <span class="sc">+</span> </span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span>)) <span class="sc">+</span> </span>
<span id="cb327-4"><a href="#cb327-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="sc">-</span><span class="fl">0.1523</span>, <span class="at">intercept=</span><span class="fl">1.5309</span>, <span class="at">color=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-224-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Slope of regression line from permuted data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a>M_Lakes_Shuffle <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Shuffle3df, Mercury<span class="sc">~</span>Shuffled_pH)</span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(M_Lakes_Shuffle)<span class="sc">$</span>coef[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.003748437</code></pre>
</div>
</div>
<p>None of our three simulations resulted in a slope near as extreme as the -0.15 that we saw in the actual data. This seems to suggest that it is unlikely that we would have observed a slope as extreme as -0.15 if there is actually no relationship between mercury and pH among all lakes.</p>
<p>That said, we should repeat the simulation many more times to see whether getting a slope as extreme as -0.15 is plausible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> Lakes_M_pH<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="do">## record value of b1 from actual data</span></span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a><span class="do">## perform simulation</span></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a>b1Sim <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>)          <span class="do">## vector to hold results</span></span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true" tabindex="-1"></a>ShuffledLakes <span class="ot">&lt;-</span> FloridaLakes    <span class="do">## create copy of dataset</span></span>
<span id="cb330-6"><a href="#cb330-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>){</span>
<span id="cb330-7"><a href="#cb330-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#randomly shuffle acceleration times</span></span>
<span id="cb330-8"><a href="#cb330-8" aria-hidden="true" tabindex="-1"></a>ShuffledLakes<span class="sc">$</span>pH <span class="ot">&lt;-</span> ShuffledLakes<span class="sc">$</span>pH[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledLakes))] </span>
<span id="cb330-9"><a href="#cb330-9" aria-hidden="true" tabindex="-1"></a>ShuffledLakes_M<span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>ShuffledLakes, Mercury <span class="sc">~</span> pH)   <span class="co">#fit model to shuffled data</span></span>
<span id="cb330-10"><a href="#cb330-10" aria-hidden="true" tabindex="-1"></a>b1Sim[i] <span class="ot">&lt;-</span> ShuffledLakes_M<span class="sc">$</span>coef[<span class="dv">2</span>]  <span class="do">## record b1 from shuffled model</span></span>
<span id="cb330-11"><a href="#cb330-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb330-12"><a href="#cb330-12" aria-hidden="true" tabindex="-1"></a>Lakes_pHSimulationResults <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(b1Sim)  <span class="co">#save results in dataframe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> Lakes_M_pH<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="do">## record value of b1 from actual data</span></span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a>Lakes_pHSimulationResultsPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Lakes_pHSimulationResults, <span class="fu">aes</span>(<span class="at">x=</span>b1Sim)) <span class="sc">+</span> </span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fu">c</span>(b1, <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>b1), <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Simulated Value of b1"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span> </span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of b1 under assumption of no relationship"</span>)</span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a>Lakes_pHSimulationResultsPlot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-227-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>p-value:</strong> Proportion of simulations resulting in value of <span class="math inline">\(b_1\)</span> more extreme than -0.15</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">abs</span>(b1Sim) <span class="sc">&gt;</span> <span class="fu">abs</span>(b1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>The p-value represents the probability of observing a slope as extreme or more extreme than -0.15 by chance when there is actually no relationship between mercury level and pH.</p>
<p>It is extremely unlikely that we would observe a value of <span class="math inline">\(b_1\)</span> as extreme as -0.15 by chance, if there is really no relationship between mercury level and pH. In fact, this never happened in any of our 10,000 simulations!</p>
<p>There is very strong evidence of a relationship mercury level and pH.</p>
<p>A low p-value tells us only that there is evidence of a relationship, not that it is practically meaningful. We have seen that for each one-unit increase in pH, mercury level is expected to decrease by 0.15 ppm on average, which seems like a pretty meaningful decrease, especially considering that mercury levels typically stay between 0 and 1.</p>
<p>We used the slope as our test statistic to measure the evidence of the relationship between the explanatory and response variables. In fact, we could have also used the correlation coefficient <span class="math inline">\(r\)</span> as our test statistic, and we would have gotten the same p-value. Either slope or correlation may be used for a hypothesis test involving two quantitative variables, but we will use slope in this class.</p>
</section>
<section id="f-statistic" class="level3" data-number="3.6.5">
<h3 data-number="3.6.5" class="anchored" data-anchor-id="f-statistic"><span class="header-section-number">3.6.5</span> F-Statistic</h3>
<p>Recall when we examined the prices of houses in King County, WA, whose conditions were rated as either very good, good, or average or below. Suppose we want to test the hypotheses:</p>
<p><strong>Null Hypothesis:</strong> There is no difference in average prices between houses of the three different conditions, among all houses in King County, WA.</p>
<p><strong>Alternative Hypothesis:</strong> There is a difference in average prices between houses of the three different conditions, among all houses in King County, WA.</p>
<p>Comparative boxplots are shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Houses, <span class="fu">aes</span>(<span class="at">x=</span>condition, <span class="at">y=</span>price, <span class="at">fill=</span>condition)) <span class="sc">+</span> </span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Houses"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-229-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a>Cond_Tab <span class="ot">&lt;-</span> Houses <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(condition) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">Mean_Price =</span> <span class="fu">mean</span>(price), </span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">SD_Price=</span> <span class="fu">sd</span> (price), </span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">N=</span> <span class="fu">n</span>())</span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(Cond_Tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">condition</th>
<th style="text-align: right;">Mean_Price</th>
<th style="text-align: right;">SD_Price</th>
<th style="text-align: right;">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">average or below</td>
<td style="text-align: right;">700.6349</td>
<td style="text-align: right;">768.1179</td>
<td style="text-align: right;">61</td>
</tr>
<tr class="even">
<td style="text-align: left;">good</td>
<td style="text-align: right;">861.0000</td>
<td style="text-align: right;">1048.9521</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">very_good</td>
<td style="text-align: right;">551.8361</td>
<td style="text-align: right;">332.8597</td>
<td style="text-align: right;">9</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We notice differences in price. Surprisingly, houses in good condition cost more than 300 thousand dollars more than those in very good condition, on average.</p>
<p>If we were only comparing two groups, we could use the difference in average price between them as a test statistic. But since we’re comparing three, we need a statistic that can measure the size of differences between all three groups. An F-statistic can do this, so we’ll use the F-statistic as our test statistic here.</p>
<p>We calculated the F-statistic in Chapter 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a>M_House_Cond <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Houses, price<span class="sc">~</span>condition)</span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a>M0_House <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>Houses, price<span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(M_House_Cond, M0_House)<span class="sc">$</span>F[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6046888</code></pre>
</div>
</div>
<p>Our question of interest is “How likely is it to observe an F-statistic as extreme or more extreme than 0.605 if there is actually no difference in average price between houses of the three conditions?”</p>
<p>We’ll use a permutation-based hypothesis test to investigate this question.</p>
<p><strong>Procedure:</strong></p>
<ol type="1">
<li><p>Randomly shuffle the conditions of the houses, so that any relationship between condition and price is due only to chance.</p></li>
<li><p>Using the shuffled data, calculate an F-statistic for a predicting price, comparing a full model that uses condition as an explanatory variable, to a reduced model with no explanatory variables.</p></li>
<li><p>Repeat steps 1 and 2 many (say 10,000) times, recording the F-statistic each time.</p></li>
<li><p>Analyze the distribution of F-statistics, simulated under the assumption that there is no relationship between condition and price. Look whether the actual F-statistic we observed is consistent with the simulation results.</p></li>
</ol>
<p>We’ll illustrate the first three permutations.</p>
<p><strong>First Permutation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>ShuffledHouses <span class="ot">&lt;-</span> Houses    <span class="do">## create copy of dataset</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>ShuffledHouses<span class="sc">$</span>condition <span class="ot">&lt;-</span> ShuffledHouses<span class="sc">$</span>condition[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledHouses))] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>Shuffle1df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Houses<span class="sc">$</span>Id, Houses<span class="sc">$</span>price, Houses<span class="sc">$</span>condition, ShuffledHouses<span class="sc">$</span>condition)</span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Shuffle1df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Id"</span>, <span class="st">"price"</span>, <span class="st">"condition"</span>, <span class="st">"Shuffled_Condition"</span>)</span>
<span id="cb339-3"><a href="#cb339-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Shuffle1df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Id</th>
<th style="text-align: right;">price</th>
<th style="text-align: left;">condition</th>
<th style="text-align: left;">Shuffled_Condition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1225.0</td>
<td style="text-align: left;">average or below</td>
<td style="text-align: left;">average or below</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">885.0</td>
<td style="text-align: left;">average or below</td>
<td style="text-align: left;">average or below</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">385.0</td>
<td style="text-align: left;">good</td>
<td style="text-align: left;">average or below</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">252.7</td>
<td style="text-align: left;">average or below</td>
<td style="text-align: left;">good</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">468.0</td>
<td style="text-align: left;">good</td>
<td style="text-align: left;">good</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">310.0</td>
<td style="text-align: left;">good</td>
<td style="text-align: left;">average or below</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>ShuffledHouses, <span class="fu">aes</span>(<span class="at">x=</span>condition, <span class="at">y=</span>price, <span class="at">fill=</span>condition)) <span class="sc">+</span> </span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Shuffled Houses"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-234-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>We fit a model to predict price using condition, and compare it to one that predicts price without using condition, and calculate the F-statistic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb341"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a>M1_Shuffled_Houses <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>ShuffledHouses, price<span class="sc">~</span>condition)</span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a>M0_Shuffled_Houses <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>ShuffledHouses, price<span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(M1_Shuffled_Houses, M0_Shuffled_Houses)<span class="sc">$</span>F[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.831639</code></pre>
</div>
</div>
<p><strong>Second Permutation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a>ShuffledHouses <span class="ot">&lt;-</span> Houses    <span class="do">## create copy of dataset</span></span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a>ShuffledHouses<span class="sc">$</span>condition <span class="ot">&lt;-</span> ShuffledHouses<span class="sc">$</span>condition[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledHouses))] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a>Shuffle2df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Houses<span class="sc">$</span>Id, Houses<span class="sc">$</span>price, Houses<span class="sc">$</span>condition, ShuffledHouses<span class="sc">$</span>condition)</span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Shuffle2df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Id"</span>, <span class="st">"price"</span>, <span class="st">"condition"</span>, <span class="st">"Shuffled_Condition"</span>)</span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Shuffle2df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Id</th>
<th style="text-align: right;">price</th>
<th style="text-align: left;">condition</th>
<th style="text-align: left;">Shuffled_Condition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1225.0</td>
<td style="text-align: left;">average or below</td>
<td style="text-align: left;">good</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">885.0</td>
<td style="text-align: left;">average or below</td>
<td style="text-align: left;">average or below</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">385.0</td>
<td style="text-align: left;">good</td>
<td style="text-align: left;">good</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">252.7</td>
<td style="text-align: left;">average or below</td>
<td style="text-align: left;">average or below</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">468.0</td>
<td style="text-align: left;">good</td>
<td style="text-align: left;">average or below</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">310.0</td>
<td style="text-align: left;">good</td>
<td style="text-align: left;">average or below</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>ShuffledHouses, <span class="fu">aes</span>(<span class="at">x=</span>condition, <span class="at">y=</span>price, <span class="at">fill=</span>condition)) <span class="sc">+</span> </span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Shuffled Houses"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-238-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>We fit a model to predict price using condition, and compare it to one that predicts price without using condition, and calculate the F-statistic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a>M1_Shuffled_Houses <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>ShuffledHouses, price<span class="sc">~</span>condition)</span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a>M0_Shuffled_Houses <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>ShuffledHouses, price<span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(M1_Shuffled_Houses, M0_Shuffled_Houses)<span class="sc">$</span>F[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3999225</code></pre>
</div>
</div>
<p><strong>Third Permutation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a>ShuffledHouses <span class="ot">&lt;-</span> Houses    <span class="do">## create copy of dataset</span></span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a>ShuffledHouses<span class="sc">$</span>condition <span class="ot">&lt;-</span> ShuffledHouses<span class="sc">$</span>condition[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledHouses))] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb349"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a>Shuffle3df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Houses<span class="sc">$</span>Id, Houses<span class="sc">$</span>price, Houses<span class="sc">$</span>condition, ShuffledHouses<span class="sc">$</span>condition)</span>
<span id="cb349-2"><a href="#cb349-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Shuffle3df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Id"</span>, <span class="st">"price"</span>, <span class="st">"condition"</span>, <span class="st">"Shuffled_Condition"</span>)</span>
<span id="cb349-3"><a href="#cb349-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Shuffle1df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Id</th>
<th style="text-align: right;">price</th>
<th style="text-align: left;">condition</th>
<th style="text-align: left;">Shuffled_Condition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1225.0</td>
<td style="text-align: left;">average or below</td>
<td style="text-align: left;">average or below</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">885.0</td>
<td style="text-align: left;">average or below</td>
<td style="text-align: left;">average or below</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">385.0</td>
<td style="text-align: left;">good</td>
<td style="text-align: left;">average or below</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">252.7</td>
<td style="text-align: left;">average or below</td>
<td style="text-align: left;">good</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">468.0</td>
<td style="text-align: left;">good</td>
<td style="text-align: left;">good</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">310.0</td>
<td style="text-align: left;">good</td>
<td style="text-align: left;">average or below</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>ShuffledHouses, <span class="fu">aes</span>(<span class="at">x=</span>condition, <span class="at">y=</span>price, <span class="at">fill=</span>condition)) <span class="sc">+</span> </span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Shuffled Houses"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-242-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>We fit a model to predict price using condition, and compare it to one that predicts price without using condition, and calculate the F-statistic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb351"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a>M1_Shuffled_Houses <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>ShuffledHouses, price<span class="sc">~</span>condition)</span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a>M0_Shuffled_Houses <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>ShuffledHouses, price<span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(M1_Shuffled_Houses, M0_Shuffled_Houses)<span class="sc">$</span>F[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.55569</code></pre>
</div>
</div>
<p>We’ll simulate 10,000 permutations and record the F-statistic for each set of permuted data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a>Fstat <span class="ot">&lt;-</span> <span class="fu">anova</span>(M_House_Cond, M0_House)<span class="sc">$</span>F[<span class="dv">2</span>] <span class="do">## record value of F-statistic from actual data</span></span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a><span class="do">## perform simulation</span></span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a>FSim <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10000</span>)          <span class="do">## vector to hold results</span></span>
<span id="cb353-5"><a href="#cb353-5" aria-hidden="true" tabindex="-1"></a>ShuffledHouses <span class="ot">&lt;-</span> Houses    <span class="do">## create copy of dataset</span></span>
<span id="cb353-6"><a href="#cb353-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>){</span>
<span id="cb353-7"><a href="#cb353-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#randomly shuffle acceleration times</span></span>
<span id="cb353-8"><a href="#cb353-8" aria-hidden="true" tabindex="-1"></a>ShuffledHouses<span class="sc">$</span>condition <span class="ot">&lt;-</span> ShuffledHouses<span class="sc">$</span>condition[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ShuffledHouses))] </span>
<span id="cb353-9"><a href="#cb353-9" aria-hidden="true" tabindex="-1"></a>ShuffledHouses_M1<span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>ShuffledHouses, price <span class="sc">~</span> condition)  <span class="co">#fit full model to shuffled data</span></span>
<span id="cb353-10"><a href="#cb353-10" aria-hidden="true" tabindex="-1"></a>ShuffledHouses_M0<span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>ShuffledHouses, price <span class="sc">~</span> <span class="dv">1</span>)  <span class="co">#fit reduced model to shuffled data</span></span>
<span id="cb353-11"><a href="#cb353-11" aria-hidden="true" tabindex="-1"></a>FSim[i] <span class="ot">&lt;-</span> <span class="fu">anova</span>(ShuffledHouses_M1, ShuffledHouses_M0)<span class="sc">$</span>F[<span class="dv">2</span>]  <span class="do">## record F from shuffled model</span></span>
<span id="cb353-12"><a href="#cb353-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb353-13"><a href="#cb353-13" aria-hidden="true" tabindex="-1"></a>House_Cond_SimulationResults <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(FSim)  <span class="co">#save results in dataframe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The distribution of the F-statistics is shown below. Recall that these are simulated under the assumption that there is no difference in average price between houses of the three different conditions, i.e.&nbsp;no relationship between price and condition.</p>
<p>The red line shows the location of the F-statistic we saw in our data (0.60). Since F-statistics cannot be negative, we don’t need to worry about finding an F-statistic as extreme in the opposite direction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a>House_Cond_SimulationResults_Plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>House_Cond_SimulationResults, </span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">aes</span>(<span class="at">x=</span>FSim)) <span class="sc">+</span> </span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"white"</span>) <span class="sc">+</span>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fu">c</span>(Fstat), <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Simulated Value of F"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span>  <span class="fu">ggtitle</span>(<span class="st">"Distribution of F under assumption of no relationship"</span>)</span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a>House_Cond_SimulationResults_Plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ch3_files/figure-html/unnamed-chunk-245-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The F-statistic in our actual we observed does not appear to be very extreme.</p>
<p><strong>p-value:</strong> Proportion of simulations resulting in value of F more extreme than 0.60.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb355"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(FSim <span class="sc">&gt;</span> Fstat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5548</code></pre>
</div>
</div>
<p>The p-value represents the probability of observing an F-statistic as extreme as 0.60 by chance, in samples of size 61, 30, and 9, if in fact there is no relationship between price and size of car.</p>
<p>More than half of our simulations resulted in an F-statistic as extreme or more extreme than the one we saw in our actual data, even though the simulation was performed in a situation where there was no relationship between price and condition. Thus, it is very plausible that we would observe an F-statistic as extreme or more extreme than we saw in our data, even if there is no relationship between price and condition (or no difference in average price between the conditions), among all houses.</p>
<p>Since the p-value is large, we cannot reject the null hypothesis. We do not have evidence to say that average price differs between houses of the different condition types.</p>
<p>It is important to note that we are not saying that we believe the average price is the same for each condition. Recall that the average prices among the conditions in our sample differed by more than 300 thousand dollars! It’s just that given the size of our samples, and the amount of variability in our data, we cannot rule out the possibility that this difference occurred purely by chance.</p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="responsible-hypothesis-testing" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="responsible-hypothesis-testing"><span class="header-section-number">3.7</span> Responsible Hypothesis Testing</h2>
<p>While hypothesis tests are a powerful tool in statistics, they are also one that has been widely misused, to the detriment of scientific research. The hard caused by these misuses caused the American Statistical Association to release a <a href="https://www.amstat.org/asa/files/pdfs/p-valuestatement.pdf">2016 statement</a>, intended to provide guidance and clarification to scientists who use hypothesis testing and p-values in their research.</p>
<p>The statement provides the following six principles for responsible use of hypothesis tests and p-values.</p>
<ol type="1">
<li><p>P-values can indicate how incompatible the data are with a specified statistical model.</p></li>
<li><p>P-values do not measure the probability that the studied hypothesis is true, or the probability that the data were produced by random chance alone.</p></li>
<li><p>Scientific conclusions and business or policy decisions should not be based only on whether a p-value passes a specific threshold.</p></li>
<li><p>Proper inference requires full reporting and transparency.</p></li>
<li><p>A p-value, or statistical significance, does not measure the size of an effect or the importance of a result.</p></li>
<li><p>By itself, a p-value does not provide a good measure of evidence regarding a model or hypothesis.</p></li>
</ol>
<p>The statement provides important guidance for us to consider as we work with hypothesis testing in this class, as well as in future classes and potentially in our own research.</p>
<ul>
<li><p>A hypothesis test can only tell us the strength of evidence against the null hypothesis. The absence of evidence against the null hypothesis should not be interpreted as evidence for the null hypothesis.</p></li>
<li><p>We should never say that the data support/prove/confirm the null hypothesis.</p></li>
<li><p>We can only say that the data do not provide evidence against the null hypothesis.</p></li>
</ul>
<p><strong>What to conclude from p-values and what not to:</strong></p>
<ul>
<li><p>A low p-value provides evidence against the null hypothesis. It suggests the test statistic we observed is inconsistent with the null hypothesis.</p></li>
<li><p>A low p-value does <strong>not</strong> tell us that the difference or relationship we observed is meaningful in a practical sense. Researchers should look at the size of the difference or strength of the relationship in the sample before deciding whether it merits being acted upon.</p></li>
<li><p>A high p-value means that the data could have plausibly been obtained when the null hypothesis is true. The test statistic we observed is consistent with what we would have expected to see when the null hypothesis is true, and thus we cannot rule out the null hypothesis.</p></li>
<li><p>A high p-value does <strong>not</strong> mean that the null hypothesis is true or probably true. A p-value can only tell us the strength of evidence against the null hypothesis, and should never be interpreted as support for the null hypothesis.</p></li>
</ul>
<p>Just because our result is consistent with the null hypothesis does not mean that we should believe that null hypothesis is true. Lack of evidence against a claim does not necessarily mean that the claim is true.</p>
<p>In this scenario, we got a small p-value, but we should also be aware of what we should conclude if the p-value is large. Remember that the p-value only measures the strength of evidence <em>against</em> the null hypothesis. A large p-value means we lack evidence against the null hypothesis. This does not mean, however, that we have evidence <em>supporting</em> null hypothesis.</p>
<p>A hypothesis test can be thought of as being analogous to a courtroom trial, where the null hypothesis is that the defendant did not commit the crime. Suppose that after each side presents evidence, the jury remains unsure whether the defendant committed the crime. Since the jury does not have enough evidence to be sure, they must, under the law of the United States find the defendant “not guilty.” This does not mean that the jury thinks the defendant is innocent, only that they do not have enough evidence to be sure they are guilty. Similarly in a hypothesis test, a large p-value indicates a lack of evidence against the null hypothesis, rather than evidence supporting it. As such, we should avoid statements suggesting we “support”, “accept”, or “believe” the null hypothesis, and simply state that we lack evidence against it.</p>
<p><strong>Things to say when the p-value is large:</strong></p>
<ul>
<li>The data are consistent with the null hypothesis.<br>
</li>
<li>We do not have enough evidence against the null hypothesis.<br>
</li>
<li>We cannot reject the null hypothesis.<br>
</li>
<li>The null hypothesis is plausible.</li>
</ul>
<p><strong>Things NOT to say when the p-value is large:</strong></p>
<ul>
<li>The data support the null hypothesis.<br>
</li>
<li>The data provide evidence for the null hypothesis.<br>
</li>
<li>We accept the null hypothesis.<br>
</li>
<li>We conclude that the null hypothesis is true.</li>
</ul>
<p>Thus, if we had obtained a large p-value in the comparison in mercury levels between Northern and Southern lakes, the appropriate conclusion would be</p>
<p>“We do not have evidence that the average mercury level differs between lakes in Northern Florida, compared to Southern Florida.”</p>
<p>Even if we got a large p-value it would be incorrect to say “There is no difference in average mercury levels between lakes in Northern Florida and Southern Florida.”</p>
<p>We would just be saying that given the size of our sample and the amount of variability on the date, we cannot rule out the possibility of observing a difference like we did by chance, when there really is no difference.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ch2.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Statistical Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ch4.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Inference from Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>